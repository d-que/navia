



<!DOCTYPE html>
<html lang="en">
  
  <head>
    
      <meta charset="utf-8">
      <title>Navia v 0.2</title>
      
      
        
          
        
        
          
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.4.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.4.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.4.0.min.js"></script>
        <script type="text/javascript">
            Bokeh.set_log_level("info");
        </script>
        
      
      
    
  </head>
  
  
  <body>
    
      
        
          
          
            
              <div class="bk-root" id="efd7ed3a-268f-4475-a19c-44badee3a562" data-root-id="1261"></div>
            
          
        
      
      
        <script type="application/json" id="2889">
          {"8e84d265-9a16-4ac2-94bd-4eb3407e27c5":{"roots":{"references":[{"attributes":{"editor":{"id":"1291","type":"StringEditor"},"field":"stoichiometry","formatter":{"id":"1292","type":"StringFormatter"},"title":"Stoichiometry"},"id":"1239","type":"TableColumn"},{"attributes":{},"id":"1386","type":"UnionRenderers"},{"attributes":{},"id":"1350","type":"UnionRenderers"},{"attributes":{"format":"0,0.00"},"id":"1240","type":"NumberFormatter"},{"attributes":{},"id":"1387","type":"Selection"},{"attributes":{},"id":"1351","type":"Selection"},{"attributes":{"editor":{"id":"1293","type":"StringEditor"},"field":"mass","formatter":{"id":"1240","type":"NumberFormatter"},"title":"Mass of Combination"},"id":"1241","type":"TableColumn"},{"attributes":{},"id":"1388","type":"UnionRenderers"},{"attributes":{},"id":"1352","type":"UnionRenderers"},{"attributes":{"format":"0,0.00"},"id":"1243","type":"NumberFormatter"},{"attributes":{},"id":"1389","type":"Selection"},{"attributes":{},"id":"1353","type":"Selection"},{"attributes":{"editor":{"id":"1294","type":"StringEditor"},"field":"mass_diff","formatter":{"id":"1243","type":"NumberFormatter"},"title":"Difference to Measured Mass"},"id":"1244","type":"TableColumn"},{"attributes":{},"id":"1390","type":"UnionRenderers"},{"attributes":{},"id":"1354","type":"UnionRenderers"},{"attributes":{"columns":[{"id":"1239","type":"TableColumn"},{"id":"1241","type":"TableColumn"},{"id":"1244","type":"TableColumn"}],"height":280,"index_position":null,"name":"Complex table","source":{"id":"1236","type":"AjaxDataSource"},"view":{"id":"1247","type":"CDSView"},"width":534},"id":"1246","type":"DataTable"},{"attributes":{},"id":"1391","type":"Selection"},{"attributes":{},"id":"1355","type":"Selection"},{"attributes":{"source":{"id":"1236","type":"AjaxDataSource"}},"id":"1247","type":"CDSView"},{"attributes":{},"id":"1392","type":"UnionRenderers"},{"attributes":{},"id":"1356","type":"UnionRenderers"},{"attributes":{},"id":"1393","type":"Selection"},{"attributes":{"button_type":"success","callback":{"id":"1248","type":"CustomJS"},"height":30,"icon":null,"label":"Mass Matching","width":84},"id":"1249","type":"Button"},{"attributes":{},"id":"1357","type":"Selection"},{"attributes":{"args":{"SU_act":{"id":"1210","type":"AjaxDataSource"},"diff_match":{"id":"1238","type":"TextInput"},"ser_match":{"id":"1237","type":"Select"},"series_masses":{"id":"1091","type":"AjaxDataSource"},"stoich":{"id":"1236","type":"AjaxDataSource"}},"code":"SUs = SU_act.data;\nvar masses = series_masses.data\nvar act = ser_match.value\n\nind = []\n\nn_comb = 1\n\ni_act=0\n/// Find correct series index for calculing peak prediction\nfor (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n    if (masses['Series'][i_ms] == act){\n        i_act=i_ms\n    }\n}\n\nvar com_table= {'stoichiometry':[], 'mass':[], 'mass_diff':[]}\n\n\nfor (var i =  0; i &lt; SUs[\"min\"].length; i++) {\n\tn_comb *=  (Math.floor((SUs[\"max\"][i]-SUs[\"min\"][i])/SUs[\"stride\"][i]) + 1)\n\tind.push(Number(SUs[\"min\"][i]))\n}\nfor(i=0; i &lt; n_comb; i++){\n\tfor(j=0; j &lt; SUs[\"min\"].length; j++){\n\t\tif( (ind[j] + Number(SUs[\"stride\"][j])) &lt;= Number(SUs[\"max\"][j])){\n\t\t\tind[j] = ind[j] + Number(SUs[\"stride\"][j])\n\t\t\tcomb_mass=0.0\n\t\t\tfor(k=0; k &lt; SUs[\"min\"].length; k++){\n\t\t\t\tcomb_mass = comb_mass + SUs[\"mass\"][k]*ind[k]\n\t\t\t}\n\t\t\tdiff = comb_mass - masses['Mass'][i_act]\n\t\t\tif (diff*diff &lt; diff_match.value*diff_match.value){\n\t\t\t\tcom_table['mass'].push(comb_mass)\n\t\t\t\tcom_table['mass_diff'].push(diff)\n\t\t\t\tsotich_string=''\n\t\t\t\tfor(k=0; k &lt; SUs[\"min\"].length; k++){\n\t\t\t\t\tsotich_string= sotich_string + SUs[\"name\"][k] + ': ' + ind[k] + '   '\n\t\t\t\t} \n\t\t\t\tcom_table['stoichiometry'].push(sotich_string)\n\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\tind[j] = Number(SUs[\"min\"][j])\n\t\t}\n\t}\n}\nstoich.data = com_table"},"id":"1248","type":"CustomJS"},{"attributes":{},"id":"1394","type":"UnionRenderers"},{"attributes":{},"id":"1358","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1128","type":"Dropdown"},{"id":"1123","type":"Select"},{"id":"1125","type":"ColorPicker"},{"id":"1120","type":"Toggle"},{"id":"1129","type":"Toggle"},{"id":"1130","type":"Toggle"}]},"id":"1250","type":"Row"},{"attributes":{},"id":"1395","type":"Selection"},{"attributes":{},"id":"1359","type":"Selection"},{"attributes":{"children":[{"id":"1001","subtype":"Figure","type":"Plot"}]},"id":"1251","type":"Row"},{"attributes":{},"id":"1396","type":"UnionRenderers"},{"attributes":{},"id":"1360","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1199","type":"DataTable"},{"id":"1208","type":"DataTable"}]},"id":"1252","type":"Row"},{"attributes":{},"id":"1397","type":"Selection"},{"attributes":{},"id":"1361","type":"Selection"},{"attributes":{"children":[{"id":"1226","type":"TextInput"},{"id":"1227","type":"TextInput"},{"id":"1228","type":"TextInput"},{"id":"1229","type":"TextInput"},{"id":"1230","type":"TextInput"},{"id":"1234","type":"Column"}]},"id":"1253","type":"Row"},{"attributes":{},"id":"1398","type":"UnionRenderers"},{"attributes":{},"id":"1362","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1224","type":"DataTable"}]},"id":"1254","type":"Row"},{"attributes":{},"id":"1399","type":"Selection"},{"attributes":{},"id":"1363","type":"Selection"},{"attributes":{"children":[{"id":"1237","type":"Select"},{"id":"1238","type":"TextInput"},{"id":"1249","type":"Button"}]},"id":"1255","type":"Row"},{"attributes":{},"id":"1400","type":"UnionRenderers"},{"attributes":{},"id":"1364","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1246","type":"DataTable"}]},"id":"1256","type":"Row"},{"attributes":{},"id":"1401","type":"Selection"},{"attributes":{},"id":"1365","type":"Selection"},{"attributes":{"children":[{"id":"1235","type":"TextAreaInput"}]},"id":"1257","type":"Row"},{"attributes":{},"id":"1402","type":"UnionRenderers"},{"attributes":{},"id":"1366","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1250","type":"Row"},{"id":"1251","type":"Row"},{"id":"1252","type":"Row"}]},"id":"1258","type":"Column"},{"attributes":{},"id":"1403","type":"Selection"},{"attributes":{},"id":"1367","type":"Selection"},{"attributes":{"children":[{"id":"1253","type":"Row"},{"id":"1254","type":"Row"},{"id":"1255","type":"Row"},{"id":"1256","type":"Row"},{"id":"1257","type":"Row"}],"visible":false},"id":"1259","type":"Column"},{"attributes":{},"id":"1404","type":"UnionRenderers"},{"attributes":{},"id":"1368","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1259","type":"Column"}},"code":"other.visible = this.active"},"id":"1260","type":"CustomJS"},{"attributes":{},"id":"1405","type":"Selection"},{"attributes":{},"id":"1369","type":"Selection"},{"attributes":{"children":[{"id":"1258","type":"Column"},{"id":"1259","type":"Column"}]},"id":"1261","type":"Row"},{"attributes":{},"id":"1406","type":"UnionRenderers"},{"attributes":{},"id":"1370","type":"UnionRenderers"},{"attributes":{},"id":"1407","type":"Selection"},{"attributes":{},"id":"1371","type":"Selection"},{"attributes":{},"id":"1408","type":"UnionRenderers"},{"attributes":{},"id":"1372","type":"UnionRenderers"},{"attributes":{},"id":"1409","type":"Selection"},{"attributes":{"text":""},"id":"1262","type":"Title"},{"attributes":{"callback":null},"id":"1002","type":"DataRange1d"},{"attributes":{},"id":"1373","type":"Selection"},{"attributes":{},"id":"1410","type":"UnionRenderers"},{"attributes":{},"id":"1264","type":"BasicTickFormatter"},{"attributes":{},"id":"1374","type":"UnionRenderers"},{"attributes":{},"id":"1411","type":"Selection"},{"attributes":{},"id":"1266","type":"BasicTickFormatter"},{"attributes":{},"id":"1375","type":"Selection"},{"attributes":{},"id":"1412","type":"UnionRenderers"},{"attributes":{},"id":"1268","type":"Selection"},{"attributes":{},"id":"1376","type":"UnionRenderers"},{"attributes":{},"id":"1413","type":"Selection"},{"attributes":{},"id":"1269","type":"UnionRenderers"},{"attributes":{},"id":"1377","type":"Selection"},{"attributes":{},"id":"1414","type":"UnionRenderers"},{"attributes":{},"id":"1270","type":"StringEditor"},{"attributes":{},"id":"1378","type":"UnionRenderers"},{"attributes":{},"id":"1415","type":"Selection"},{"attributes":{},"id":"1271","type":"StringEditor"},{"attributes":{},"id":"1379","type":"Selection"},{"attributes":{},"id":"1416","type":"UnionRenderers"},{"attributes":{},"id":"1272","type":"StringEditor"},{"attributes":{},"id":"1380","type":"UnionRenderers"},{"attributes":{},"id":"1417","type":"Selection"},{"attributes":{},"id":"1273","type":"StringEditor"},{"attributes":{},"id":"1381","type":"Selection"},{"attributes":{},"id":"1418","type":"UnionRenderers"},{"attributes":{},"id":"1274","type":"StringFormatter"},{"attributes":{},"id":"1382","type":"UnionRenderers"},{"attributes":{},"id":"1419","type":"Selection"},{"attributes":{},"id":"1275","type":"Selection"},{"attributes":{},"id":"1383","type":"Selection"},{"attributes":{},"id":"1420","type":"UnionRenderers"},{"attributes":{},"id":"1276","type":"UnionRenderers"},{"attributes":{},"id":"1384","type":"UnionRenderers"},{"attributes":{},"id":"1421","type":"Selection"},{"attributes":{},"id":"1277","type":"StringEditor"},{"attributes":{},"id":"1385","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1387","type":"Selection"},"selection_policy":{"id":"1388","type":"UnionRenderers"}},"id":"1051","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1411","type":"Selection"},"selection_policy":{"id":"1412","type":"UnionRenderers"}},"id":"1087","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1309","type":"Selection"},"selection_policy":{"id":"1310","type":"UnionRenderers"}},"id":"1052","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1333","type":"Selection"},"selection_policy":{"id":"1334","type":"UnionRenderers"}},"id":"1088","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1349","type":"Selection"},"selection_policy":{"id":"1350","type":"UnionRenderers"}},"id":"1053","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1373","type":"Selection"},"selection_policy":{"id":"1374","type":"UnionRenderers"}},"id":"1089","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1389","type":"Selection"},"selection_policy":{"id":"1390","type":"UnionRenderers"}},"id":"1054","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1413","type":"Selection"},"selection_policy":{"id":"1414","type":"UnionRenderers"}},"id":"1090","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1311","type":"Selection"},"selection_policy":{"id":"1312","type":"UnionRenderers"}},"id":"1055","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1268","type":"Selection"},"selection_policy":{"id":"1269","type":"UnionRenderers"}},"id":"1092","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1351","type":"Selection"},"selection_policy":{"id":"1352","type":"UnionRenderers"}},"id":"1056","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1391","type":"Selection"},"selection_policy":{"id":"1392","type":"UnionRenderers"}},"id":"1057","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1415","type":"Selection"},"selection_policy":{"id":"1416","type":"UnionRenderers"}},"id":"1094","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1313","type":"Selection"},"selection_policy":{"id":"1314","type":"UnionRenderers"}},"id":"1058","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1417","type":"Selection"},"selection_policy":{"id":"1418","type":"UnionRenderers"}},"id":"1095","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1353","type":"Selection"},"selection_policy":{"id":"1354","type":"UnionRenderers"}},"id":"1059","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#1f77b4"},"name":"Series 1","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1096","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1393","type":"Selection"},"selection_policy":{"id":"1394","type":"UnionRenderers"}},"id":"1060","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#ff7f0e"},"name":"Series 2","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1097","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1315","type":"Selection"},"selection_policy":{"id":"1316","type":"UnionRenderers"}},"id":"1061","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#2ca02c"},"name":"Series 3","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1098","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1355","type":"Selection"},"selection_policy":{"id":"1356","type":"UnionRenderers"}},"id":"1062","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#d62728"},"name":"Series 4","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1099","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1395","type":"Selection"},"selection_policy":{"id":"1396","type":"UnionRenderers"}},"id":"1063","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#9467bd"},"name":"Series 5","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1100","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1317","type":"Selection"},"selection_policy":{"id":"1318","type":"UnionRenderers"}},"id":"1064","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#8c564b"},"name":"Series 6","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1101","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1357","type":"Selection"},"selection_policy":{"id":"1358","type":"UnionRenderers"}},"id":"1065","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#e377c2"},"name":"Series 7","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1102","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1397","type":"Selection"},"selection_policy":{"id":"1398","type":"UnionRenderers"}},"id":"1066","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#7f7f7f"},"name":"Series 8","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1103","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1319","type":"Selection"},"selection_policy":{"id":"1320","type":"UnionRenderers"}},"id":"1067","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#bcbd22"},"name":"Series 9","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1104","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1359","type":"Selection"},"selection_policy":{"id":"1360","type":"UnionRenderers"}},"id":"1068","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#17becf"},"name":"Series 10","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1105","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1399","type":"Selection"},"selection_policy":{"id":"1400","type":"UnionRenderers"}},"id":"1069","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#aec7e8"},"name":"Series 11","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1106","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1321","type":"Selection"},"selection_policy":{"id":"1322","type":"UnionRenderers"}},"id":"1070","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#ffbb78"},"name":"Series 12","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1107","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1361","type":"Selection"},"selection_policy":{"id":"1362","type":"UnionRenderers"}},"id":"1071","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#98df8a"},"name":"Series 13","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1108","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1401","type":"Selection"},"selection_policy":{"id":"1402","type":"UnionRenderers"}},"id":"1072","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#ff9896"},"name":"Series 14","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1109","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1323","type":"Selection"},"selection_policy":{"id":"1324","type":"UnionRenderers"}},"id":"1073","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#c5b0d5"},"name":"Series 15","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1110","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1363","type":"Selection"},"selection_policy":{"id":"1364","type":"UnionRenderers"}},"id":"1074","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#c49c94"},"name":"Series 16","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1111","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1403","type":"Selection"},"selection_policy":{"id":"1404","type":"UnionRenderers"}},"id":"1075","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#f7b6d2"},"name":"Series 17","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1112","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1325","type":"Selection"},"selection_policy":{"id":"1326","type":"UnionRenderers"}},"id":"1076","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#c7c7c7"},"name":"Series 18","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1113","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1365","type":"Selection"},"selection_policy":{"id":"1366","type":"UnionRenderers"}},"id":"1077","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#dbdb8d"},"name":"Series 19","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1114","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1405","type":"Selection"},"selection_policy":{"id":"1406","type":"UnionRenderers"}},"id":"1078","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#9edae5"},"name":"Series 20","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1115","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1327","type":"Selection"},"selection_policy":{"id":"1328","type":"UnionRenderers"}},"id":"1079","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1419","type":"Selection"},"selection_policy":{"id":"1420","type":"UnionRenderers"}},"id":"1118","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1367","type":"Selection"},"selection_policy":{"id":"1368","type":"UnionRenderers"}},"id":"1080","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#000000"},"name":"Background","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1117","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1407","type":"Selection"},"selection_policy":{"id":"1408","type":"UnionRenderers"}},"id":"1081","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1421","type":"Selection"},"selection_policy":{"id":"1422","type":"UnionRenderers"}},"id":"1119","type":"AjaxDataSource"},{"attributes":{"callback":null,"value":"1000.0","width":80},"id":"1238","type":"TextInput"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1329","type":"Selection"},"selection_policy":{"id":"1330","type":"UnionRenderers"}},"id":"1082","type":"AjaxDataSource"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1179","type":"CustomJS"},{"id":"1180","type":"CustomJS"}]},"label":"Peak prediction","width":150},"id":"1120","type":"Toggle"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1369","type":"Selection"},"selection_policy":{"id":"1370","type":"UnionRenderers"}},"id":"1083","type":"AjaxDataSource"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#1f77b4"},"line_width":{"value":2},"name":"pp_mean","xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1121","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1409","type":"Selection"},"selection_policy":{"id":"1410","type":"UnionRenderers"}},"id":"1084","type":"AjaxDataSource"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#1f77b4"},"line_dash":[6],"line_width":{"value":2},"name":"pp_std","xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1122","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1331","type":"Selection"},"selection_policy":{"id":"1332","type":"UnionRenderers"}},"id":"1085","type":"AjaxDataSource"},{"attributes":{"callback":null,"height":30,"js_property_callbacks":{"change:value":[{"id":"1126","type":"CustomJS"}]},"options":["Background","New Series"],"value":"Background","width":150},"id":"1123","type":"Select"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1371","type":"Selection"},"selection_policy":{"id":"1372","type":"UnionRenderers"}},"id":"1086","type":"AjaxDataSource"},{"attributes":{},"id":"1314","type":"UnionRenderers"},{"attributes":{"callback":{"id":"1124","type":"CustomJS"},"height":30,"width":50},"id":"1125","type":"ColorPicker"},{"attributes":{"args":{"pp_mean":{"id":"1121","type":"MultiLine"},"pp_std":{"id":"1122","type":"MultiLine"},"sel_lines":{"Background":{"id":"1117","type":"MultiLine"},"Series 1":{"id":"1096","type":"MultiLine"},"Series 10":{"id":"1105","type":"MultiLine"},"Series 11":{"id":"1106","type":"MultiLine"},"Series 12":{"id":"1107","type":"MultiLine"},"Series 13":{"id":"1108","type":"MultiLine"},"Series 14":{"id":"1109","type":"MultiLine"},"Series 15":{"id":"1110","type":"MultiLine"},"Series 16":{"id":"1111","type":"MultiLine"},"Series 17":{"id":"1112","type":"MultiLine"},"Series 18":{"id":"1113","type":"MultiLine"},"Series 19":{"id":"1114","type":"MultiLine"},"Series 2":{"id":"1097","type":"MultiLine"},"Series 20":{"id":"1115","type":"MultiLine"},"Series 3":{"id":"1098","type":"MultiLine"},"Series 4":{"id":"1099","type":"MultiLine"},"Series 5":{"id":"1100","type":"MultiLine"},"Series 6":{"id":"1101","type":"MultiLine"},"Series 7":{"id":"1102","type":"MultiLine"},"Series 8":{"id":"1103","type":"MultiLine"},"Series 9":{"id":"1104","type":"MultiLine"}},"ser_act":{"id":"1123","type":"Select"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"]},"code":"var act = ser_act.value;\nvar names = series_names;\nvar line = sel_lines[act]\nline.line_color.value = cb_obj.color;\npp_mean.line_color = cb_obj.color;\npp_std.line_color = cb_obj.color;\n"},"id":"1124","type":"CustomJS"},{"attributes":{},"id":"1315","type":"Selection"},{"attributes":{},"id":"1316","type":"UnionRenderers"},{"attributes":{"args":{"aser_data":{"id":"1092","type":"AjaxDataSource"},"bg_mz":{"id":"1095","type":"AjaxDataSource"},"plot_canvas":{"id":"1001","subtype":"Figure","type":"Plot"},"pp_mean_data":{"id":"1118","type":"AjaxDataSource"},"pp_std_data":{"id":"1119","type":"AjaxDataSource"},"raw_mz":{"id":"1094","type":"AjaxDataSource"},"sel_lines":{"Background":{"id":"1117","type":"MultiLine"},"Series 1":{"id":"1096","type":"MultiLine"},"Series 10":{"id":"1105","type":"MultiLine"},"Series 11":{"id":"1106","type":"MultiLine"},"Series 12":{"id":"1107","type":"MultiLine"},"Series 13":{"id":"1108","type":"MultiLine"},"Series 14":{"id":"1109","type":"MultiLine"},"Series 15":{"id":"1110","type":"MultiLine"},"Series 16":{"id":"1111","type":"MultiLine"},"Series 17":{"id":"1112","type":"MultiLine"},"Series 18":{"id":"1113","type":"MultiLine"},"Series 19":{"id":"1114","type":"MultiLine"},"Series 2":{"id":"1097","type":"MultiLine"},"Series 20":{"id":"1115","type":"MultiLine"},"Series 3":{"id":"1098","type":"MultiLine"},"Series 4":{"id":"1099","type":"MultiLine"},"Series 5":{"id":"1100","type":"MultiLine"},"Series 6":{"id":"1101","type":"MultiLine"},"Series 7":{"id":"1102","type":"MultiLine"},"Series 8":{"id":"1103","type":"MultiLine"},"Series 9":{"id":"1104","type":"MultiLine"}},"series_data":{"Series 1":{"id":"1031","type":"AjaxDataSource"},"Series 10":{"id":"1058","type":"AjaxDataSource"},"Series 11":{"id":"1061","type":"AjaxDataSource"},"Series 12":{"id":"1064","type":"AjaxDataSource"},"Series 13":{"id":"1067","type":"AjaxDataSource"},"Series 14":{"id":"1070","type":"AjaxDataSource"},"Series 15":{"id":"1073","type":"AjaxDataSource"},"Series 16":{"id":"1076","type":"AjaxDataSource"},"Series 17":{"id":"1079","type":"AjaxDataSource"},"Series 18":{"id":"1082","type":"AjaxDataSource"},"Series 19":{"id":"1085","type":"AjaxDataSource"},"Series 2":{"id":"1034","type":"AjaxDataSource"},"Series 20":{"id":"1088","type":"AjaxDataSource"},"Series 3":{"id":"1037","type":"AjaxDataSource"},"Series 4":{"id":"1040","type":"AjaxDataSource"},"Series 5":{"id":"1043","type":"AjaxDataSource"},"Series 6":{"id":"1046","type":"AjaxDataSource"},"Series 7":{"id":"1049","type":"AjaxDataSource"},"Series 8":{"id":"1052","type":"AjaxDataSource"},"Series 9":{"id":"1055","type":"AjaxDataSource"}},"series_masses":{"id":"1091","type":"AjaxDataSource"},"series_mz":{"Series 1":{"id":"1033","type":"AjaxDataSource"},"Series 10":{"id":"1060","type":"AjaxDataSource"},"Series 11":{"id":"1063","type":"AjaxDataSource"},"Series 12":{"id":"1066","type":"AjaxDataSource"},"Series 13":{"id":"1069","type":"AjaxDataSource"},"Series 14":{"id":"1072","type":"AjaxDataSource"},"Series 15":{"id":"1075","type":"AjaxDataSource"},"Series 16":{"id":"1078","type":"AjaxDataSource"},"Series 17":{"id":"1081","type":"AjaxDataSource"},"Series 18":{"id":"1084","type":"AjaxDataSource"},"Series 19":{"id":"1087","type":"AjaxDataSource"},"Series 2":{"id":"1036","type":"AjaxDataSource"},"Series 20":{"id":"1090","type":"AjaxDataSource"},"Series 3":{"id":"1039","type":"AjaxDataSource"},"Series 4":{"id":"1042","type":"AjaxDataSource"},"Series 5":{"id":"1045","type":"AjaxDataSource"},"Series 6":{"id":"1048","type":"AjaxDataSource"},"Series 7":{"id":"1051","type":"AjaxDataSource"},"Series 8":{"id":"1054","type":"AjaxDataSource"},"Series 9":{"id":"1057","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1032","type":"AjaxDataSource"},"Series 10":{"id":"1059","type":"AjaxDataSource"},"Series 11":{"id":"1062","type":"AjaxDataSource"},"Series 12":{"id":"1065","type":"AjaxDataSource"},"Series 13":{"id":"1068","type":"AjaxDataSource"},"Series 14":{"id":"1071","type":"AjaxDataSource"},"Series 15":{"id":"1074","type":"AjaxDataSource"},"Series 16":{"id":"1077","type":"AjaxDataSource"},"Series 17":{"id":"1080","type":"AjaxDataSource"},"Series 18":{"id":"1083","type":"AjaxDataSource"},"Series 19":{"id":"1086","type":"AjaxDataSource"},"Series 2":{"id":"1035","type":"AjaxDataSource"},"Series 20":{"id":"1089","type":"AjaxDataSource"},"Series 3":{"id":"1038","type":"AjaxDataSource"},"Series 4":{"id":"1041","type":"AjaxDataSource"},"Series 5":{"id":"1044","type":"AjaxDataSource"},"Series 6":{"id":"1047","type":"AjaxDataSource"},"Series 7":{"id":"1050","type":"AjaxDataSource"},"Series 8":{"id":"1053","type":"AjaxDataSource"},"Series 9":{"id":"1056","type":"AjaxDataSource"}}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max){\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        bg_mz.data=backg_mz;\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'])\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n\nnew_data = {'mz': [], 'Intensity': []}\n\nfor (i in series_names){\n    series_data[series_names[i]].data = {'x_low':[], 'x_upp':[],  'x_max':[],'max_int':[], 'charge':[]}\n    series_sele[series_names[i]].data = {'i_low':[], 'i_upp':[], 'i_max':[]}\n    series_mz[series_names[i]].data  = {'Intensity':[], 'mz':[]}\n}\n\nseries_masses.data = {'Series':[], 'Mass':[], 'Uncertainty':[]}\n\naser_data.data = {'x_low':[], 'x_upp':[],  'x_max':[], 'max_int':[], 'charge':[]}\n\n\n\nvar act =cb_obj.value;\nconsole.log(act)\nif(act== \"load_file\"){\n    var input = document.createElement('input');\n    input.type = 'file';\n    input.onchange = e =&gt; {\n\n    // getting a hold of the file reference\n    var file = e.target.files[0];\n\n    // setting up the reader\n    var reader = new FileReader();\n    reader.readAsText(file,'UTF-8');\n\n    // here we tell the reader what to do when it's done reading...\n    reader.onload = readerEvent =&gt; {\n        var content = readerEvent.target.result; // this is the content!\n        ///console.log( content );\n\n        var lines = content.split('\\n')\n\n        for(i=10; i &lt; lines.length; i++){\n            line = lines[i].split('\\t')\n            new_data['mz'].push(parseFloat(line[0]))\n            new_data['Intensity'].push(parseFloat(line[1]))\n        }\n\n          /// Find maximum and normalise data\n        max_int=0.0\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            if(new_data['Intensity'][i] &gt; max_int){\n                max_int = new_data['Intensity'][i];\n            }\n        }\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            new_data['Intensity'][i] = 100 * new_data['Intensity'][i] / max_int;\n        }\n        raw_mz.data=new_data\n        new_bg = {'mz': [new_data['mz']], 'Intensity': [new_data['Intensity']]}\n        bg_mz.data = new_bg\n        }\n    }\n    input.click();\n}\n\nif(act== \"load_clip\"){\n\n    var ms = prompt(\"Paste spectrum here\", \"\");\n    if (ms != null) {\n        var lines = ms.split('\\n')\n        for(i=10; i &lt; lines.length; i++){\n            line = lines[i].split('\\t')\n            new_data['mz'].push(parseFloat(line[0]))\n            new_data['Intensity'].push(parseFloat(line[1]))\n        }\n      \n        /// Find maximum and normalise data\n        max_int=0.0\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            if(new_data['Intensity'][i] &gt; max_int){\n                max_int = new_data['Intensity'][i];\n            }\n        }\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            new_data['Intensity'][i] = 100 * new_data['Intensity'][i] / max_int;\n        }\n        raw_mz.data=new_data\n        new_bg = {'mz': [new_data['mz']], 'Intensity': [new_data['Intensity']]}\n        bg_mz.data = new_bg\n    }\n\n}\n\nif (act == 'load_sess'){\n    var input = document.createElement('input');\n        input.type = 'file';\n        input.onchange = e =&gt; {\n\n        // getting a hold of the file reference\n        var file = e.target.files[0];\n\n        // setting up the reader\n        var reader = new FileReader();\n        reader.readAsText(file,'UTF-8');\n\n        // here we tell the reader what to do when it's done reading...\n        reader.onload = readerEvent =&gt; {\n            var content = readerEvent.target.result; // this is the content!\n            /// Line below is short for look in content for key data and put into left data (professional name object destructuring)\n            const {raw_data} = JSON.parse(content)\n            raw_mz.data = data\n        }\n    }\n    input.click();\n}\n\n\nif (act == 'save_sess'){\n    var raw_data =raw_mz.data;\n    var smooth_data =raw_mz.data;\n\n    let save_json = {  data, }\n\n    var jsonData = JSON.stringify(data);\n    function download(content, fileName, contentType) {\n        var a = document.createElement(\"a\");\n        var file = new Blob([content], {type: contentType});\n        a.href = URL.createObjectURL(file);\n        a.download = fileName;\n        a.click();\n    }\n    download(jsonData, 'json.navia', 'navia');\n}\n\n/// Save sessions regurlarly\n/*\nwindow.setInteval(function(){\n    let save_json = {  data, }\n    var jsonData = JSON.stringify(data);\n    try {\n        window.localStorage.setItem(\"curr_sess\", jsonData)\n    }},1000)\n*/"},"id":"1127","type":"CustomJS"},{"attributes":{},"id":"1317","type":"Selection"},{"attributes":{"args":{"aser_data":{"id":"1092","type":"AjaxDataSource"},"col":{"id":"1125","type":"ColorPicker"},"pp_mean":{"id":"1121","type":"MultiLine"},"pp_mean_data":{"id":"1118","type":"AjaxDataSource"},"pp_std":{"id":"1122","type":"MultiLine"},"pp_std_data":{"id":"1119","type":"AjaxDataSource"},"sel_lines":{"Background":{"id":"1117","type":"MultiLine"},"Series 1":{"id":"1096","type":"MultiLine"},"Series 10":{"id":"1105","type":"MultiLine"},"Series 11":{"id":"1106","type":"MultiLine"},"Series 12":{"id":"1107","type":"MultiLine"},"Series 13":{"id":"1108","type":"MultiLine"},"Series 14":{"id":"1109","type":"MultiLine"},"Series 15":{"id":"1110","type":"MultiLine"},"Series 16":{"id":"1111","type":"MultiLine"},"Series 17":{"id":"1112","type":"MultiLine"},"Series 18":{"id":"1113","type":"MultiLine"},"Series 19":{"id":"1114","type":"MultiLine"},"Series 2":{"id":"1097","type":"MultiLine"},"Series 20":{"id":"1115","type":"MultiLine"},"Series 3":{"id":"1098","type":"MultiLine"},"Series 4":{"id":"1099","type":"MultiLine"},"Series 5":{"id":"1100","type":"MultiLine"},"Series 6":{"id":"1101","type":"MultiLine"},"Series 7":{"id":"1102","type":"MultiLine"},"Series 8":{"id":"1103","type":"MultiLine"},"Series 9":{"id":"1104","type":"MultiLine"}},"series_data":{"Series 1":{"id":"1031","type":"AjaxDataSource"},"Series 10":{"id":"1058","type":"AjaxDataSource"},"Series 11":{"id":"1061","type":"AjaxDataSource"},"Series 12":{"id":"1064","type":"AjaxDataSource"},"Series 13":{"id":"1067","type":"AjaxDataSource"},"Series 14":{"id":"1070","type":"AjaxDataSource"},"Series 15":{"id":"1073","type":"AjaxDataSource"},"Series 16":{"id":"1076","type":"AjaxDataSource"},"Series 17":{"id":"1079","type":"AjaxDataSource"},"Series 18":{"id":"1082","type":"AjaxDataSource"},"Series 19":{"id":"1085","type":"AjaxDataSource"},"Series 2":{"id":"1034","type":"AjaxDataSource"},"Series 20":{"id":"1088","type":"AjaxDataSource"},"Series 3":{"id":"1037","type":"AjaxDataSource"},"Series 4":{"id":"1040","type":"AjaxDataSource"},"Series 5":{"id":"1043","type":"AjaxDataSource"},"Series 6":{"id":"1046","type":"AjaxDataSource"},"Series 7":{"id":"1049","type":"AjaxDataSource"},"Series 8":{"id":"1052","type":"AjaxDataSource"},"Series 9":{"id":"1055","type":"AjaxDataSource"}},"series_masses":{"id":"1091","type":"AjaxDataSource"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"]},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max){\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        bg_mz.data=backg_mz;\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'])\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\nvar names = series_names;\nvar sele_lines = {};\nvar masses = series_masses.data\nvar ser_data = {};\n\nif (cb_obj.value == \"New Series\"){\n        cb_obj.options.splice(cb_obj.options.length-1,1)\n        i = cb_obj.options.length\n        cb_obj.options.push(\"Series \" + i)\n        cb_obj.options.push(\"New Series\")\n        cb_obj.value=\"Series \" + i\n    }\n\nfor(i_ser in names){\n    sele_lines[names[i_ser]]=sel_lines[names[i_ser]];\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    }\nsele_lines['Background']=sel_lines['Background'];\n\n\nvar act = cb_obj.value;\n\npeakprediction(masses, ser_data, act);\n\nif(act != 'Background'){\n    col.color = sele_lines[act].line_color.value;\n\tpp_mean.line_color = sele_lines[act].line_color;\n\tpp_std.line_color = sele_lines[act].line_color;\n\taser_data.data = series_data[act].data;\n}\nelse{\n    col.color = sele_lines['Background'].line_color.value;\n    empty_aser={ 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    aser_data.data = empty_aser\n} \n\n"},"id":"1126","type":"CustomJS"},{"attributes":{},"id":"1318","type":"UnionRenderers"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:value":[{"id":"1127","type":"CustomJS"}]},"label":"File","menu":[["Load spectrum from file","load_file"],["Load spectrum from clipboard","load_clip"],null,["Save session","save_sess"],["Load session","load_sess"],null,["Load subunit table","load_suta"]],"width":200},"id":"1128","type":"Dropdown"},{"attributes":{},"id":"1319","type":"Selection"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1185","type":"CustomJS"}]},"label":"Mass Finder","width":150},"id":"1129","type":"Toggle"},{"attributes":{},"id":"1320","type":"UnionRenderers"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1260","type":"CustomJS"}]},"label":"Mass Matching &amp; Comment","width":200},"id":"1130","type":"Toggle"},{"attributes":{},"id":"1321","type":"Selection"},{"attributes":{"callback":{"id":"1131","type":"CustomJS"},"dimensions":"width","overlay":{"id":"1426","type":"BoxAnnotation"}},"id":"1132","type":"BoxSelectTool"},{"attributes":{},"id":"1322","type":"UnionRenderers"},{"attributes":{"args":{"aser_data":{"id":"1092","type":"AjaxDataSource"},"bg_mz":{"id":"1095","type":"AjaxDataSource"},"pp_mean_data":{"id":"1118","type":"AjaxDataSource"},"pp_std_data":{"id":"1119","type":"AjaxDataSource"},"raw_mz":{"id":"1094","type":"AjaxDataSource"},"ser_act":{"id":"1123","type":"Select"},"series_data":{"Series 1":{"id":"1031","type":"AjaxDataSource"},"Series 10":{"id":"1058","type":"AjaxDataSource"},"Series 11":{"id":"1061","type":"AjaxDataSource"},"Series 12":{"id":"1064","type":"AjaxDataSource"},"Series 13":{"id":"1067","type":"AjaxDataSource"},"Series 14":{"id":"1070","type":"AjaxDataSource"},"Series 15":{"id":"1073","type":"AjaxDataSource"},"Series 16":{"id":"1076","type":"AjaxDataSource"},"Series 17":{"id":"1079","type":"AjaxDataSource"},"Series 18":{"id":"1082","type":"AjaxDataSource"},"Series 19":{"id":"1085","type":"AjaxDataSource"},"Series 2":{"id":"1034","type":"AjaxDataSource"},"Series 20":{"id":"1088","type":"AjaxDataSource"},"Series 3":{"id":"1037","type":"AjaxDataSource"},"Series 4":{"id":"1040","type":"AjaxDataSource"},"Series 5":{"id":"1043","type":"AjaxDataSource"},"Series 6":{"id":"1046","type":"AjaxDataSource"},"Series 7":{"id":"1049","type":"AjaxDataSource"},"Series 8":{"id":"1052","type":"AjaxDataSource"},"Series 9":{"id":"1055","type":"AjaxDataSource"}},"series_masses":{"id":"1091","type":"AjaxDataSource"},"series_mz":{"Series 1":{"id":"1033","type":"AjaxDataSource"},"Series 10":{"id":"1060","type":"AjaxDataSource"},"Series 11":{"id":"1063","type":"AjaxDataSource"},"Series 12":{"id":"1066","type":"AjaxDataSource"},"Series 13":{"id":"1069","type":"AjaxDataSource"},"Series 14":{"id":"1072","type":"AjaxDataSource"},"Series 15":{"id":"1075","type":"AjaxDataSource"},"Series 16":{"id":"1078","type":"AjaxDataSource"},"Series 17":{"id":"1081","type":"AjaxDataSource"},"Series 18":{"id":"1084","type":"AjaxDataSource"},"Series 19":{"id":"1087","type":"AjaxDataSource"},"Series 2":{"id":"1036","type":"AjaxDataSource"},"Series 20":{"id":"1090","type":"AjaxDataSource"},"Series 3":{"id":"1039","type":"AjaxDataSource"},"Series 4":{"id":"1042","type":"AjaxDataSource"},"Series 5":{"id":"1045","type":"AjaxDataSource"},"Series 6":{"id":"1048","type":"AjaxDataSource"},"Series 7":{"id":"1051","type":"AjaxDataSource"},"Series 8":{"id":"1054","type":"AjaxDataSource"},"Series 9":{"id":"1057","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1032","type":"AjaxDataSource"},"Series 10":{"id":"1059","type":"AjaxDataSource"},"Series 11":{"id":"1062","type":"AjaxDataSource"},"Series 12":{"id":"1065","type":"AjaxDataSource"},"Series 13":{"id":"1068","type":"AjaxDataSource"},"Series 14":{"id":"1071","type":"AjaxDataSource"},"Series 15":{"id":"1074","type":"AjaxDataSource"},"Series 16":{"id":"1077","type":"AjaxDataSource"},"Series 17":{"id":"1080","type":"AjaxDataSource"},"Series 18":{"id":"1083","type":"AjaxDataSource"},"Series 19":{"id":"1086","type":"AjaxDataSource"},"Series 2":{"id":"1035","type":"AjaxDataSource"},"Series 20":{"id":"1089","type":"AjaxDataSource"},"Series 3":{"id":"1038","type":"AjaxDataSource"},"Series 4":{"id":"1041","type":"AjaxDataSource"},"Series 5":{"id":"1044","type":"AjaxDataSource"},"Series 6":{"id":"1047","type":"AjaxDataSource"},"Series 7":{"id":"1050","type":"AjaxDataSource"},"Series 8":{"id":"1053","type":"AjaxDataSource"},"Series 9":{"id":"1056","type":"AjaxDataSource"}}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max){\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        bg_mz.data=backg_mz;\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'])\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/// Get data source from Callback args\n\nvar data = raw_mz.data;\nvar act = ser_act.value;\n\nvar sele = {};\nvar ser_data={};\nvar act_data=aser_data.data;\nvar masses = series_masses.data;\n\nvar names = series_names;\n\n/// remember i in x gives ith element\nfor(i_ser in names){\n    sele[names[i_ser]]=series_sele[names[i_ser]].data;\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n}\n    \n/// get BoxSelectTool dimensions from cb_data parameter of Callback and find indices of lower/upper range marked\n\nvar geometry = cb_data['geometry'];\ni_low = closest(data['mz'], geometry['x0']);\ni_upp = closest(data['mz'], geometry['x1']);\n\n\n/// Boolean to decide whether to append new selection\n\nvar nopush = sele_logics(i_low, i_upp, sele, names, ser_data, act);\n\npush_sele(nopush, sele, data, i_low, i_upp, ser_data, act);\n\ndata2sources(names, sele, data);\n\nDoMacSED(masses, ser_data, names, series_masses)\n\npeakprediction(masses,ser_data, act);\n\ndata2active_table(ser_data[act], aser_data, act);\n\n    "},"id":"1131","type":"CustomJS"},{"attributes":{},"id":"1323","type":"Selection"},{"attributes":{"data_source":{"id":"1095","type":"AjaxDataSource"},"glyph":{"id":"1117","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1134","type":"CDSView"}},"id":"1133","type":"GlyphRenderer"},{"attributes":{},"id":"1324","type":"UnionRenderers"},{"attributes":{"source":{"id":"1095","type":"AjaxDataSource"}},"id":"1134","type":"CDSView"},{"attributes":{},"id":"1325","type":"Selection"},{"attributes":{"data_source":{"id":"1118","type":"AjaxDataSource"},"glyph":{"id":"1121","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1176","type":"CDSView"},"visible":false},"id":"1175","type":"GlyphRenderer"},{"attributes":{},"id":"1326","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1033","type":"AjaxDataSource"},"glyph":{"id":"1096","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1136","type":"CDSView"}},"id":"1135","type":"GlyphRenderer"},{"attributes":{},"id":"1327","type":"Selection"},{"attributes":{"source":{"id":"1033","type":"AjaxDataSource"}},"id":"1136","type":"CDSView"},{"attributes":{},"id":"1328","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1036","type":"AjaxDataSource"},"glyph":{"id":"1097","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1138","type":"CDSView"}},"id":"1137","type":"GlyphRenderer"},{"attributes":{},"id":"1329","type":"Selection"},{"attributes":{"source":{"id":"1036","type":"AjaxDataSource"}},"id":"1138","type":"CDSView"},{"attributes":{},"id":"1330","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1039","type":"AjaxDataSource"},"glyph":{"id":"1098","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1140","type":"CDSView"}},"id":"1139","type":"GlyphRenderer"},{"attributes":{},"id":"1331","type":"Selection"},{"attributes":{"source":{"id":"1039","type":"AjaxDataSource"}},"id":"1140","type":"CDSView"},{"attributes":{},"id":"1332","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1042","type":"AjaxDataSource"},"glyph":{"id":"1099","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1142","type":"CDSView"}},"id":"1141","type":"GlyphRenderer"},{"attributes":{},"id":"1333","type":"Selection"},{"attributes":{"source":{"id":"1042","type":"AjaxDataSource"}},"id":"1142","type":"CDSView"},{"attributes":{},"id":"1334","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1045","type":"AjaxDataSource"},"glyph":{"id":"1100","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1144","type":"CDSView"}},"id":"1143","type":"GlyphRenderer"},{"attributes":{},"id":"1335","type":"Selection"},{"attributes":{"source":{"id":"1045","type":"AjaxDataSource"}},"id":"1144","type":"CDSView"},{"attributes":{},"id":"1336","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1048","type":"AjaxDataSource"},"glyph":{"id":"1101","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1146","type":"CDSView"}},"id":"1145","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"Mass":[],"Series":[],"Uncertainty":[]},"selected":{"id":"1275","type":"Selection"},"selection_policy":{"id":"1276","type":"UnionRenderers"}},"id":"1091","type":"AjaxDataSource"},{"attributes":{},"id":"1337","type":"Selection"},{"attributes":{"source":{"id":"1048","type":"AjaxDataSource"}},"id":"1146","type":"CDSView"},{"attributes":{},"id":"1338","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1051","type":"AjaxDataSource"},"glyph":{"id":"1102","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1148","type":"CDSView"}},"id":"1147","type":"GlyphRenderer"},{"attributes":{},"id":"1339","type":"Selection"},{"attributes":{"source":{"id":"1051","type":"AjaxDataSource"}},"id":"1148","type":"CDSView"},{"attributes":{},"id":"1340","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1054","type":"AjaxDataSource"},"glyph":{"id":"1103","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1150","type":"CDSView"}},"id":"1149","type":"GlyphRenderer"},{"attributes":{},"id":"1341","type":"Selection"},{"attributes":{"source":{"id":"1054","type":"AjaxDataSource"}},"id":"1150","type":"CDSView"},{"attributes":{},"id":"1342","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1057","type":"AjaxDataSource"},"glyph":{"id":"1104","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1152","type":"CDSView"}},"id":"1151","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1347","type":"Selection"},"selection_policy":{"id":"1348","type":"UnionRenderers"}},"id":"1050","type":"AjaxDataSource"},{"attributes":{},"id":"1343","type":"Selection"},{"attributes":{"source":{"id":"1057","type":"AjaxDataSource"}},"id":"1152","type":"CDSView"},{"attributes":{},"id":"1344","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1105","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1154","type":"CDSView"}},"id":"1153","type":"GlyphRenderer"},{"attributes":{},"id":"1345","type":"Selection"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1154","type":"CDSView"},{"attributes":{},"id":"1346","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1063","type":"AjaxDataSource"},"glyph":{"id":"1106","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1156","type":"CDSView"}},"id":"1155","type":"GlyphRenderer"},{"attributes":{},"id":"1347","type":"Selection"},{"attributes":{"source":{"id":"1063","type":"AjaxDataSource"}},"id":"1156","type":"CDSView"},{"attributes":{},"id":"1348","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1066","type":"AjaxDataSource"},"glyph":{"id":"1107","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1158","type":"CDSView"}},"id":"1157","type":"GlyphRenderer"},{"attributes":{},"id":"1349","type":"Selection"},{"attributes":{"source":{"id":"1066","type":"AjaxDataSource"}},"id":"1158","type":"CDSView"},{"attributes":{"source":{"id":"1092","type":"AjaxDataSource"}},"id":"1200","type":"CDSView"},{"attributes":{},"id":"1278","type":"StringFormatter"},{"attributes":{},"id":"1422","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1069","type":"AjaxDataSource"},"glyph":{"id":"1108","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1160","type":"CDSView"}},"id":"1159","type":"GlyphRenderer"},{"attributes":{"callback":null},"id":"1004","type":"DataRange1d"},{"attributes":{},"id":"1279","type":"StringEditor"},{"attributes":{},"id":"1423","type":"Selection"},{"attributes":{"editor":{"id":"1277","type":"StringEditor"},"field":"Series","formatter":{"id":"1278","type":"StringFormatter"},"title":"Series"},"id":"1201","type":"TableColumn"},{"attributes":{"source":{"id":"1069","type":"AjaxDataSource"}},"id":"1160","type":"CDSView"},{"attributes":{},"id":"1006","type":"LinearScale"},{"attributes":{},"id":"1280","type":"StringEditor"},{"attributes":{},"id":"1424","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1072","type":"AjaxDataSource"},"glyph":{"id":"1109","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1162","type":"CDSView"}},"id":"1161","type":"GlyphRenderer"},{"attributes":{"format":"0,0.00"},"id":"1202","type":"NumberFormatter"},{"attributes":{},"id":"1008","type":"LinearScale"},{"attributes":{},"id":"1281","type":"Selection"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1425","type":"BoxAnnotation"},{"attributes":{"editor":{"id":"1279","type":"StringEditor"},"field":"Mass","formatter":{"id":"1202","type":"NumberFormatter"},"title":"Mass"},"id":"1203","type":"TableColumn"},{"attributes":{"source":{"id":"1072","type":"AjaxDataSource"}},"id":"1162","type":"CDSView"},{"attributes":{"axis_label":"m/z ","formatter":{"id":"1266","type":"BasicTickFormatter"},"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1010","type":"LinearAxis"},{"attributes":{},"id":"1282","type":"UnionRenderers"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1426","type":"BoxAnnotation"},{"attributes":{"data_source":{"id":"1075","type":"AjaxDataSource"},"glyph":{"id":"1110","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1164","type":"CDSView"}},"id":"1163","type":"GlyphRenderer"},{"attributes":{"format":"0,0.00"},"id":"1205","type":"NumberFormatter"},{"attributes":{},"id":"1011","type":"BasicTicker"},{"attributes":{},"id":"1283","type":"StringEditor"},{"attributes":{"editor":{"id":"1280","type":"StringEditor"},"field":"Uncertainty","formatter":{"id":"1205","type":"NumberFormatter"},"title":"Uncertainty"},"id":"1206","type":"TableColumn"},{"attributes":{"source":{"id":"1075","type":"AjaxDataSource"}},"id":"1164","type":"CDSView"},{"attributes":{"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1014","type":"Grid"},{"attributes":{},"id":"1284","type":"StringFormatter"},{"attributes":{"columns":[{"id":"1201","type":"TableColumn"},{"id":"1203","type":"TableColumn"},{"id":"1206","type":"TableColumn"}],"height":280,"index_position":null,"name":"Mass table","source":{"id":"1091","type":"AjaxDataSource"},"view":{"id":"1209","type":"CDSView"},"width":270},"id":"1208","type":"DataTable"},{"attributes":{"data_source":{"id":"1078","type":"AjaxDataSource"},"glyph":{"id":"1111","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1166","type":"CDSView"}},"id":"1165","type":"GlyphRenderer"},{"attributes":{"axis_label":"Rel. Abundance  [%]","formatter":{"id":"1264","type":"BasicTickFormatter"},"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1015","type":"LinearAxis"},{"attributes":{},"id":"1285","type":"StringEditor"},{"attributes":{"source":{"id":"1091","type":"AjaxDataSource"}},"id":"1209","type":"CDSView"},{"attributes":{"source":{"id":"1078","type":"AjaxDataSource"}},"id":"1166","type":"CDSView"},{"attributes":{},"id":"1016","type":"BasicTicker"},{"attributes":{},"id":"1286","type":"StringEditor"},{"attributes":{"data_source":{"id":"1081","type":"AjaxDataSource"},"glyph":{"id":"1112","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1168","type":"CDSView"}},"id":"1167","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"mass":[],"max":[],"min":[],"name":[],"stride":[]},"selected":{"id":"1281","type":"Selection"},"selection_policy":{"id":"1282","type":"UnionRenderers"}},"id":"1210","type":"AjaxDataSource"},{"attributes":{"dimension":1,"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1019","type":"Grid"},{"attributes":{},"id":"1287","type":"StringEditor"},{"attributes":{"editor":{"id":"1283","type":"StringEditor"},"field":"name","formatter":{"id":"1284","type":"StringFormatter"},"title":"Subunit"},"id":"1211","type":"TableColumn"},{"attributes":{"source":{"id":"1081","type":"AjaxDataSource"}},"id":"1168","type":"CDSView"},{"attributes":{"overlay":{"id":"1425","type":"BoxAnnotation"}},"id":"1020","type":"BoxZoomTool"},{"attributes":{},"id":"1288","type":"StringEditor"},{"attributes":{"data_source":{"id":"1084","type":"AjaxDataSource"},"glyph":{"id":"1113","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1170","type":"CDSView"}},"id":"1169","type":"GlyphRenderer"},{"attributes":{"format":"0,0.00"},"id":"1212","type":"NumberFormatter"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1295","type":"Selection"},"selection_policy":{"id":"1296","type":"UnionRenderers"}},"id":"1031","type":"AjaxDataSource"},{"attributes":{},"id":"1289","type":"Selection"},{"attributes":{"editor":{"id":"1285","type":"StringEditor"},"field":"mass","formatter":{"id":"1212","type":"NumberFormatter"},"title":"Mass"},"id":"1213","type":"TableColumn"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1335","type":"Selection"},"selection_policy":{"id":"1336","type":"UnionRenderers"}},"id":"1032","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1084","type":"AjaxDataSource"}},"id":"1170","type":"CDSView"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1020","type":"BoxZoomTool"},{"id":"1021","type":"ResetTool"},{"id":"1022","type":"SaveTool"},{"id":"1023","type":"PanTool"},{"id":"1024","type":"WheelZoomTool"},{"id":"1186","type":"HoverTool"},{"id":"1132","type":"BoxSelectTool"}]},"id":"1025","type":"Toolbar"},{"attributes":{},"id":"1290","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1087","type":"AjaxDataSource"},"glyph":{"id":"1114","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1172","type":"CDSView"}},"id":"1171","type":"GlyphRenderer"},{"attributes":{},"id":"1215","type":"NumberFormatter"},{"attributes":{},"id":"1021","type":"ResetTool"},{"attributes":{},"id":"1291","type":"StringEditor"},{"attributes":{"below":[{"id":"1010","type":"LinearAxis"}],"center":[{"id":"1014","type":"Grid"},{"id":"1019","type":"Grid"}],"left":[{"id":"1015","type":"LinearAxis"}],"plot_height":768,"plot_width":1366,"renderers":[{"id":"1133","type":"GlyphRenderer"},{"id":"1135","type":"GlyphRenderer"},{"id":"1137","type":"GlyphRenderer"},{"id":"1139","type":"GlyphRenderer"},{"id":"1141","type":"GlyphRenderer"},{"id":"1143","type":"GlyphRenderer"},{"id":"1145","type":"GlyphRenderer"},{"id":"1147","type":"GlyphRenderer"},{"id":"1149","type":"GlyphRenderer"},{"id":"1151","type":"GlyphRenderer"},{"id":"1153","type":"GlyphRenderer"},{"id":"1155","type":"GlyphRenderer"},{"id":"1157","type":"GlyphRenderer"},{"id":"1159","type":"GlyphRenderer"},{"id":"1161","type":"GlyphRenderer"},{"id":"1163","type":"GlyphRenderer"},{"id":"1165","type":"GlyphRenderer"},{"id":"1167","type":"GlyphRenderer"},{"id":"1169","type":"GlyphRenderer"},{"id":"1171","type":"GlyphRenderer"},{"id":"1173","type":"GlyphRenderer"},{"id":"1175","type":"GlyphRenderer"},{"id":"1177","type":"GlyphRenderer"},{"id":"1183","type":"GlyphRenderer"}],"title":{"id":"1262","type":"Title"},"toolbar":{"id":"1025","type":"Toolbar"},"x_range":{"id":"1002","type":"DataRange1d"},"x_scale":{"id":"1006","type":"LinearScale"},"y_range":{"id":"1004","type":"DataRange1d"},"y_scale":{"id":"1008","type":"LinearScale"}},"id":"1001","subtype":"Figure","type":"Plot"},{"attributes":{"editor":{"id":"1286","type":"StringEditor"},"field":"min","formatter":{"id":"1215","type":"NumberFormatter"},"title":"Minimum #"},"id":"1216","type":"TableColumn"},{"attributes":{"source":{"id":"1087","type":"AjaxDataSource"}},"id":"1172","type":"CDSView"},{"attributes":{},"id":"1022","type":"SaveTool"},{"attributes":{},"id":"1292","type":"StringFormatter"},{"attributes":{"data_source":{"id":"1090","type":"AjaxDataSource"},"glyph":{"id":"1115","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1174","type":"CDSView"}},"id":"1173","type":"GlyphRenderer"},{"attributes":{},"id":"1218","type":"NumberFormatter"},{"attributes":{},"id":"1023","type":"PanTool"},{"attributes":{},"id":"1293","type":"StringEditor"},{"attributes":{"editor":{"id":"1287","type":"StringEditor"},"field":"max","formatter":{"id":"1218","type":"NumberFormatter"},"title":"Maximum #"},"id":"1219","type":"TableColumn"},{"attributes":{"source":{"id":"1090","type":"AjaxDataSource"}},"id":"1174","type":"CDSView"},{"attributes":{},"id":"1024","type":"WheelZoomTool"},{"attributes":{},"id":"1294","type":"StringEditor"},{"attributes":{},"id":"1221","type":"NumberFormatter"},{"attributes":{"source":{"id":"1118","type":"AjaxDataSource"}},"id":"1176","type":"CDSView"},{"attributes":{},"id":"1295","type":"Selection"},{"attributes":{"editor":{"id":"1288","type":"StringEditor"},"field":"stride","formatter":{"id":"1221","type":"NumberFormatter"},"title":"Stride"},"id":"1222","type":"TableColumn"},{"attributes":{"data_source":{"id":"1119","type":"AjaxDataSource"},"glyph":{"id":"1122","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1178","type":"CDSView"},"visible":false},"id":"1177","type":"GlyphRenderer"},{"attributes":{},"id":"1296","type":"UnionRenderers"},{"attributes":{"columns":[{"id":"1211","type":"TableColumn"},{"id":"1213","type":"TableColumn"},{"id":"1216","type":"TableColumn"},{"id":"1219","type":"TableColumn"},{"id":"1222","type":"TableColumn"}],"editable":true,"height":280,"index_header":"Index","name":"Complex table","source":{"id":"1210","type":"AjaxDataSource"},"view":{"id":"1225","type":"CDSView"},"width":534},"id":"1224","type":"DataTable"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1375","type":"Selection"},"selection_policy":{"id":"1376","type":"UnionRenderers"}},"id":"1033","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1119","type":"AjaxDataSource"}},"id":"1178","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1297","type":"Selection"},"selection_policy":{"id":"1298","type":"UnionRenderers"}},"id":"1034","type":"AjaxDataSource"},{"attributes":{},"id":"1297","type":"Selection"},{"attributes":{"source":{"id":"1210","type":"AjaxDataSource"}},"id":"1225","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1175","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1179","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1337","type":"Selection"},"selection_policy":{"id":"1338","type":"UnionRenderers"}},"id":"1035","type":"AjaxDataSource"},{"attributes":{},"id":"1298","type":"UnionRenderers"},{"attributes":{"callback":null,"title":"Name ","value":"Subunit 1","width":80},"id":"1226","type":"TextInput"},{"attributes":{"args":{"other":{"id":"1177","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1180","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1377","type":"Selection"},"selection_policy":{"id":"1378","type":"UnionRenderers"}},"id":"1036","type":"AjaxDataSource"},{"attributes":{},"id":"1299","type":"Selection"},{"attributes":{"callback":null,"title":"Mass ","value":"1000.0","width":80},"id":"1227","type":"TextInput"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#002147"},"line_width":{"value":2},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1181","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1299","type":"Selection"},"selection_policy":{"id":"1300","type":"UnionRenderers"}},"id":"1037","type":"AjaxDataSource"},{"attributes":{},"id":"1300","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1423","type":"Selection"},"selection_policy":{"id":"1424","type":"UnionRenderers"}},"id":"1182","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1339","type":"Selection"},"selection_policy":{"id":"1340","type":"UnionRenderers"}},"id":"1038","type":"AjaxDataSource"},{"attributes":{},"id":"1301","type":"Selection"},{"attributes":{"callback":null,"title":"Min:","value":"0","width":80},"id":"1228","type":"TextInput"},{"attributes":{"data_source":{"id":"1182","type":"AjaxDataSource"},"glyph":{"id":"1181","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1184","type":"CDSView"},"visible":false},"id":"1183","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1379","type":"Selection"},"selection_policy":{"id":"1380","type":"UnionRenderers"}},"id":"1039","type":"AjaxDataSource"},{"attributes":{},"id":"1302","type":"UnionRenderers"},{"attributes":{"callback":null,"title":"Max:","value":"1","width":80},"id":"1229","type":"TextInput"},{"attributes":{"source":{"id":"1182","type":"AjaxDataSource"}},"id":"1184","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1301","type":"Selection"},"selection_policy":{"id":"1302","type":"UnionRenderers"}},"id":"1040","type":"AjaxDataSource"},{"attributes":{},"id":"1303","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1341","type":"Selection"},"selection_policy":{"id":"1342","type":"UnionRenderers"}},"id":"1041","type":"AjaxDataSource"},{"attributes":{},"id":"1304","type":"UnionRenderers"},{"attributes":{"callback":null,"title":"Stride:","value":"1","width":80},"id":"1230","type":"TextInput"},{"attributes":{"callback":null,"tooltips":[["m/z","$x{5.2f}"],["Abundance","$y %"]]},"id":"1186","type":"HoverTool"},{"attributes":{"args":{"mass_finder_data":{"id":"1182","type":"AjaxDataSource"},"mfl":{"id":"1183","type":"GlyphRenderer"}},"code":"if (cb_obj.active==true){\n\tvar mf_data = { \"xs\":[], \"ys\":[] }\n\tvar comp_mass = prompt(\"Mass of complex in Da\", \"10000.0\");\n\tvar mz_min = prompt(\"Lower m/z bound\", \"1000.0\");\n \tvar mz_max = prompt(\"Upper m/z bound\", \"2000.0\");\n\n\n\tvar z_max = Math.floor(parseFloat(comp_mass) / (parseFloat(mz_min)+0.1))\n \tvar z_min = Math.ceil(parseFloat(comp_mass) / (parseFloat(mz_max)+0.1))\n\n \tfor (z=z_min; z&lt;z_max; z++){\n \t \tmf_data[\"ys\"].push([0.0, 100.0])\n \t \tmf_data[\"xs\"].push([Number(comp_mass) / z , Number(comp_mass) / z])\n \t \t///console.log(Number(comp_mass) / z)\n \t}\n \tmfl.visible=true;\n \tmass_finder_data.data = mf_data;\n}\n\nelse{\n \t mfl.visible=false;\n \t var mf_data = { \"xs\":[], \"ys\":[] }\n \t mass_finder_data.data = mf_data;\n}"},"id":"1185","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1381","type":"Selection"},"selection_policy":{"id":"1382","type":"UnionRenderers"}},"id":"1042","type":"AjaxDataSource"},{"attributes":{},"id":"1305","type":"Selection"},{"attributes":{"button_type":"success","callback":{"id":"1231","type":"CustomJS"},"height":30,"icon":null,"label":"Add subunit","width":84},"id":"1232","type":"Button"},{"attributes":{"format":"0,0.00"},"id":"1189","type":"NumberFormatter"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1303","type":"Selection"},"selection_policy":{"id":"1304","type":"UnionRenderers"}},"id":"1043","type":"AjaxDataSource"},{"attributes":{},"id":"1306","type":"UnionRenderers"},{"attributes":{"args":{"SU_act":{"id":"1210","type":"AjaxDataSource"},"SU_mass":{"id":"1227","type":"TextInput"},"SU_max":{"id":"1229","type":"TextInput"},"SU_min":{"id":"1228","type":"TextInput"},"SU_name":{"id":"1226","type":"TextInput"},"SU_stride":{"id":"1230","type":"TextInput"}},"code":"complexes=SU_act.data\n\ncomplexes['name'].push(SU_name.value)\ncomplexes['mass'].push(SU_mass.value)\ncomplexes['min'].push(SU_min.value)\ncomplexes['max'].push(SU_max.value)\ncomplexes['stride'].push(SU_stride.value)\n\nSU_act.change.emit()"},"id":"1231","type":"CustomJS"},{"attributes":{"editor":{"id":"1270","type":"StringEditor"},"field":"x_low","formatter":{"id":"1189","type":"NumberFormatter"},"title":"Lower m/z"},"id":"1190","type":"TableColumn"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1343","type":"Selection"},"selection_policy":{"id":"1344","type":"UnionRenderers"}},"id":"1044","type":"AjaxDataSource"},{"attributes":{},"id":"1307","type":"Selection"},{"attributes":{"height":20,"width":84},"id":"1233","type":"Spacer"},{"attributes":{"format":"0,0.00"},"id":"1192","type":"NumberFormatter"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1383","type":"Selection"},"selection_policy":{"id":"1384","type":"UnionRenderers"}},"id":"1045","type":"AjaxDataSource"},{"attributes":{},"id":"1308","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1233","type":"Spacer"},{"id":"1232","type":"Button"}]},"id":"1234","type":"Column"},{"attributes":{"editor":{"id":"1271","type":"StringEditor"},"field":"x_upp","formatter":{"id":"1192","type":"NumberFormatter"},"title":"Upper m/z"},"id":"1193","type":"TableColumn"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1305","type":"Selection"},"selection_policy":{"id":"1306","type":"UnionRenderers"}},"id":"1046","type":"AjaxDataSource"},{"attributes":{},"id":"1309","type":"Selection"},{"attributes":{"callback":null,"height":200,"title":"Comment:","value":"Add comments on spectrum...","width":534},"id":"1235","type":"TextAreaInput"},{"attributes":{"format":"0,0.00"},"id":"1195","type":"NumberFormatter"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1345","type":"Selection"},"selection_policy":{"id":"1346","type":"UnionRenderers"}},"id":"1047","type":"AjaxDataSource"},{"attributes":{},"id":"1310","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"mass":[],"mass_diff":[],"stoichiometry":[]},"selected":{"id":"1289","type":"Selection"},"selection_policy":{"id":"1290","type":"UnionRenderers"}},"id":"1236","type":"AjaxDataSource"},{"attributes":{"editor":{"id":"1272","type":"StringEditor"},"field":"x_max","formatter":{"id":"1195","type":"NumberFormatter"},"title":"mz of Max"},"id":"1196","type":"TableColumn"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1385","type":"Selection"},"selection_policy":{"id":"1386","type":"UnionRenderers"}},"id":"1048","type":"AjaxDataSource"},{"attributes":{},"id":"1311","type":"Selection"},{"attributes":{"callback":null,"height":30,"options":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20","Background"],"value":"Series 1","width":150},"id":"1237","type":"Select"},{"attributes":{"editor":{"id":"1273","type":"StringEditor"},"field":"charge","formatter":{"id":"1274","type":"StringFormatter"},"title":"Charge"},"id":"1198","type":"TableColumn"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1307","type":"Selection"},"selection_policy":{"id":"1308","type":"UnionRenderers"}},"id":"1049","type":"AjaxDataSource"},{"attributes":{},"id":"1312","type":"UnionRenderers"},{"attributes":{"columns":[{"id":"1190","type":"TableColumn"},{"id":"1193","type":"TableColumn"},{"id":"1196","type":"TableColumn"},{"id":"1198","type":"TableColumn"}],"height":480,"index_position":null,"name":"Series 20","source":{"id":"1092","type":"AjaxDataSource"},"view":{"id":"1200","type":"CDSView"},"width":680},"id":"1199","type":"DataTable"},{"attributes":{},"id":"1313","type":"Selection"}],"root_ids":["1261"]},"title":"Bokeh Application","version":"1.4.0"}}
        </script>
        <script type="text/javascript">
          (function() {
            var fn = function() {
              Bokeh.safely(function() {
                (function(root) {
                  function embed_document(root) {
                    
                  var docs_json = document.getElementById('2889').textContent;
                  var render_items = [{"docid":"8e84d265-9a16-4ac2-94bd-4eb3407e27c5","roots":{"1261":"efd7ed3a-268f-4475-a19c-44badee3a562"}}];
                  root.Bokeh.embed.embed_items(docs_json, render_items);
                
                  }
                  if (root.Bokeh !== undefined) {
                    embed_document(root);
                  } else {
                    var attempts = 0;
                    var timer = setInterval(function(root) {
                      if (root.Bokeh !== undefined) {
                        clearInterval(timer);
                        embed_document(root);
                      } else {
                        attempts++;
                        if (attempts > 100) {
                          clearInterval(timer);
                          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                        }
                      }
                    }, 10, root)
                  }
                })(window);
              });
            };
            if (document.readyState != "loading") fn();
            else document.addEventListener("DOMContentLoaded", fn);
          })();
        </script>
    
  </body>
  
</html>