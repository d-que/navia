



<!DOCTYPE html>
<html lang="en">
  
  <head>
    
      <meta charset="utf-8">
      <title>Navia v 0.2</title>
      
      
        
          
        
        
          
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.4.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.4.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.4.0.min.js"></script>
        <script type="text/javascript">
            Bokeh.set_log_level("info");
        </script>
        
      
      
    
  </head>
  
  
  <body>
    
      
        
          
          
            
              <div class="bk-root" id="b1c10d3e-12a5-4574-93ed-2ca8f202b41b" data-root-id="1195"></div>
            
          
        
      
      
        <script type="application/json" id="2023">
          {"37928bb9-2812-4264-a4cb-db174f4cf504":{"roots":{"references":[{"attributes":{"editor":{"id":"1204","type":"StringEditor"},"field":"x_low","formatter":{"id":"1123","type":"NumberFormatter"},"title":"Lower m/z"},"id":"1124","type":"TableColumn"},{"attributes":{"callback":{"id":"1085","type":"CustomJS"},"dimensions":"width","overlay":{"id":"1260","type":"BoxAnnotation"}},"id":"1086","type":"BoxSelectTool"},{"attributes":{},"id":"1276","type":"Selection"},{"attributes":{"height":20,"width":84},"id":"1167","type":"Spacer"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1254","type":"Selection"},"selection_policy":{"id":"1253","type":"UnionRenderers"}},"id":"1051","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1061","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1088","type":"CDSView"}},"id":"1087","type":"GlyphRenderer"},{"attributes":{"format":"0,0.00"},"id":"1126","type":"NumberFormatter"},{"attributes":{},"id":"1277","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1167","type":"Spacer"},{"id":"1166","type":"Button"}]},"id":"1168","type":"Column"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1278","type":"Selection"},"selection_policy":{"id":"1277","type":"UnionRenderers"}},"id":"1052","type":"AjaxDataSource"},{"attributes":{"editor":{"id":"1205","type":"StringEditor"},"field":"x_upp","formatter":{"id":"1126","type":"NumberFormatter"},"title":"Upper m/z"},"id":"1127","type":"TableColumn"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1088","type":"CDSView"},{"attributes":{},"id":"1278","type":"Selection"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1062","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1090","type":"CDSView"}},"id":"1089","type":"GlyphRenderer"},{"attributes":{"format":"0,0.00"},"id":"1129","type":"NumberFormatter"},{"attributes":{},"id":"1279","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"mass":[],"mass_diff":[],"stoichiometry":[]},"selected":{"id":"1224","type":"Selection"},"selection_policy":{"id":"1223","type":"UnionRenderers"}},"id":"1170","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1256","type":"Selection"},"selection_policy":{"id":"1255","type":"UnionRenderers"}},"id":"1054","type":"AjaxDataSource"},{"attributes":{"editor":{"id":"1206","type":"StringEditor"},"field":"x_max","formatter":{"id":"1129","type":"NumberFormatter"},"title":"mz of Max"},"id":"1130","type":"TableColumn"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1090","type":"CDSView"},{"attributes":{},"id":"1280","type":"Selection"},{"attributes":{"callback":null,"height":30,"options":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10"],"value":"Series 1","width":150},"id":"1171","type":"Select"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1280","type":"Selection"},"selection_policy":{"id":"1279","type":"UnionRenderers"}},"id":"1055","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1063","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1092","type":"CDSView"}},"id":"1091","type":"GlyphRenderer"},{"attributes":{"editor":{"id":"1208","type":"StringEditor"},"field":"charge","formatter":{"id":"1207","type":"StringFormatter"},"title":"Charge"},"id":"1132","type":"TableColumn"},{"attributes":{"columns":[{"id":"1124","type":"TableColumn"},{"id":"1127","type":"TableColumn"},{"id":"1130","type":"TableColumn"},{"id":"1132","type":"TableColumn"}],"height":480,"index_position":null,"name":"Series 10","source":{"id":"1058","type":"AjaxDataSource"},"view":{"id":"1134","type":"CDSView"},"width":680},"id":"1133","type":"DataTable"},{"attributes":{"callback":null,"value":"1000.0","width":80},"id":"1172","type":"TextInput"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1092","type":"CDSView"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1064","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1094","type":"CDSView"}},"id":"1093","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1058","type":"AjaxDataSource"}},"id":"1134","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1203","type":"Selection"},"selection_policy":{"id":"1202","type":"UnionRenderers"}},"id":"1058","type":"AjaxDataSource"},{"attributes":{"editor":{"id":"1226","type":"StringEditor"},"field":"stoichiometry","formatter":{"id":"1225","type":"StringFormatter"},"title":"Stoichiometry"},"id":"1173","type":"TableColumn"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1230","type":"Selection"},"selection_policy":{"id":"1229","type":"UnionRenderers"}},"id":"1059","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1094","type":"CDSView"},{"attributes":{"format":"0,0.00"},"id":"1174","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1212","type":"StringEditor"},"field":"Series","formatter":{"id":"1211","type":"StringFormatter"},"title":"Series"},"id":"1135","type":"TableColumn"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1065","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1096","type":"CDSView"}},"id":"1095","type":"GlyphRenderer"},{"attributes":{"editor":{"id":"1227","type":"StringEditor"},"field":"mass","formatter":{"id":"1174","type":"NumberFormatter"},"title":"Mass of Combination"},"id":"1175","type":"TableColumn"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1232","type":"Selection"},"selection_policy":{"id":"1231","type":"UnionRenderers"}},"id":"1060","type":"AjaxDataSource"},{"attributes":{"format":"0,0.00"},"id":"1136","type":"NumberFormatter"},{"attributes":{"name":"Background","x":{"field":"Mass"},"y":{"field":"Background"}},"id":"1061","type":"Line"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1096","type":"CDSView"},{"attributes":{"format":"0,0.00"},"id":"1177","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1213","type":"StringEditor"},"field":"Mass","formatter":{"id":"1136","type":"NumberFormatter"},"title":"Mass"},"id":"1137","type":"TableColumn"},{"attributes":{"editor":{"id":"1228","type":"StringEditor"},"field":"mass_diff","formatter":{"id":"1177","type":"NumberFormatter"},"title":"Difference to Measured Mass"},"id":"1178","type":"TableColumn"},{"attributes":{"line_color":"#1f77b4","name":"Series 1","x":{"field":"Mass"},"y":{"field":"Series 1"}},"id":"1062","type":"Line"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1066","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1098","type":"CDSView"}},"id":"1097","type":"GlyphRenderer"},{"attributes":{"format":"0,0.00"},"id":"1139","type":"NumberFormatter"},{"attributes":{"columns":[{"id":"1173","type":"TableColumn"},{"id":"1175","type":"TableColumn"},{"id":"1178","type":"TableColumn"}],"height":280,"index_position":null,"name":"Complex table","source":{"id":"1170","type":"AjaxDataSource"},"view":{"id":"1181","type":"CDSView"},"width":534},"id":"1180","type":"DataTable"},{"attributes":{"line_color":"#ff7f0e","name":"Series 2","x":{"field":"Mass"},"y":{"field":"Series 2"}},"id":"1063","type":"Line"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1098","type":"CDSView"},{"attributes":{"editor":{"id":"1214","type":"StringEditor"},"field":"Uncertainty","formatter":{"id":"1139","type":"NumberFormatter"},"title":"Uncertainty"},"id":"1140","type":"TableColumn"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1067","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1100","type":"CDSView"}},"id":"1099","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1170","type":"AjaxDataSource"}},"id":"1181","type":"CDSView"},{"attributes":{"line_color":"#2ca02c","name":"Series 3","x":{"field":"Mass"},"y":{"field":"Series 3"}},"id":"1064","type":"Line"},{"attributes":{"columns":[{"id":"1135","type":"TableColumn"},{"id":"1137","type":"TableColumn"},{"id":"1140","type":"TableColumn"}],"height":280,"index_position":null,"name":"Mass table","source":{"id":"1057","type":"AjaxDataSource"},"view":{"id":"1143","type":"CDSView"},"width":270},"id":"1142","type":"DataTable"},{"attributes":{"line_color":"#d62728","name":"Series 4","x":{"field":"Mass"},"y":{"field":"Series 4"}},"id":"1065","type":"Line"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1100","type":"CDSView"},{"attributes":{"button_type":"success","callback":{"id":"1182","type":"CustomJS"},"height":30,"icon":null,"label":"Mass Matching","width":84},"id":"1183","type":"Button"},{"attributes":{"source":{"id":"1057","type":"AjaxDataSource"}},"id":"1143","type":"CDSView"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1068","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1102","type":"CDSView"}},"id":"1101","type":"GlyphRenderer"},{"attributes":{"args":{"SU_act":{"id":"1144","type":"AjaxDataSource"},"diff_match":{"id":"1172","type":"TextInput"},"ser_match":{"id":"1171","type":"Select"},"series_masses":{"id":"1057","type":"AjaxDataSource"},"stoich":{"id":"1170","type":"AjaxDataSource"}},"code":"SUs = SU_act.data;\nvar masses = series_masses.data\nvar act = ser_match.value\n\nind = []\n\nn_comb = 1\n\ni_act=0\n/// Find correct series index for calculing peak prediction\nfor (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n    if (masses['Series'][i_ms] == act){\n        i_act=i_ms\n    }\n}\n\nvar com_table= {'stoichiometry':[], 'mass':[], 'mass_diff':[]}\n\n\nfor (var i =  0; i &lt; SUs[\"min\"].length; i++) {\n\tn_comb *=  (Math.floor((SUs[\"max\"][i]-SUs[\"min\"][i])/SUs[\"stride\"][i]) + 1)\n\tind.push(Number(SUs[\"min\"][i]))\n}\nfor(i=0; i &lt; n_comb; i++){\n\tfor(j=0; j &lt; SUs[\"min\"].length; j++){\n\t\tif( (ind[j] + Number(SUs[\"stride\"][j])) &lt;= Number(SUs[\"max\"][j])){\n\t\t\tind[j] = ind[j] + Number(SUs[\"stride\"][j])\n\t\t\tcomb_mass=0.0\n\t\t\tfor(k=0; k &lt; SUs[\"min\"].length; k++){\n\t\t\t\tcomb_mass = comb_mass + SUs[\"mass\"][k]*ind[k]\n\t\t\t}\n\t\t\tdiff = comb_mass - masses['Mass'][i_act]\n\t\t\tif (diff*diff &lt; diff_match.value*diff_match.value){\n\t\t\t\tcom_table['mass'].push(comb_mass)\n\t\t\t\tcom_table['mass_diff'].push(diff)\n\t\t\t\tsotich_string=''\n\t\t\t\tfor(k=0; k &lt; SUs[\"min\"].length; k++){\n\t\t\t\t\tsotich_string= sotich_string + SUs[\"name\"][k] + ': ' + ind[k] + '   '\n\t\t\t\t} \n\t\t\t\tcom_table['stoichiometry'].push(sotich_string)\n\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\tind[j] = Number(SUs[\"min\"][j])\n\t\t}\n\t}\n}\nstoich.data = com_table"},"id":"1182","type":"CustomJS"},{"attributes":{"line_color":"#9467bd","name":"Series 5","x":{"field":"Mass"},"y":{"field":"Series 5"}},"id":"1066","type":"Line"},{"attributes":{"adapter":null,"callback":null,"data":{"mass":[],"max":[],"min":[],"name":[],"stride":[]},"selected":{"id":"1216","type":"Selection"},"selection_policy":{"id":"1215","type":"UnionRenderers"}},"id":"1144","type":"AjaxDataSource"},{"attributes":{"children":[{"id":"1082","type":"Dropdown"},{"id":"1077","type":"Select"},{"id":"1079","type":"ColorPicker"},{"id":"1074","type":"Toggle"},{"id":"1083","type":"Toggle"},{"id":"1084","type":"Toggle"}]},"id":"1184","type":"Row"},{"attributes":{"line_color":"#8c564b","name":"Series 6","x":{"field":"Mass"},"y":{"field":"Series 6"}},"id":"1067","type":"Line"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1102","type":"CDSView"},{"attributes":{"editor":{"id":"1218","type":"StringEditor"},"field":"name","formatter":{"id":"1217","type":"StringFormatter"},"title":"Subunit"},"id":"1145","type":"TableColumn"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1069","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1104","type":"CDSView"}},"id":"1103","type":"GlyphRenderer"},{"attributes":{"children":[{"id":"1001","subtype":"Figure","type":"Plot"}]},"id":"1185","type":"Row"},{"attributes":{"line_color":"#e377c2","name":"Series 7","x":{"field":"Mass"},"y":{"field":"Series 7"}},"id":"1068","type":"Line"},{"attributes":{"format":"0,0.00"},"id":"1146","type":"NumberFormatter"},{"attributes":{"children":[{"id":"1133","type":"DataTable"},{"id":"1142","type":"DataTable"}]},"id":"1186","type":"Row"},{"attributes":{"line_color":"#7f7f7f","name":"Series 8","x":{"field":"Mass"},"y":{"field":"Series 8"}},"id":"1069","type":"Line"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1104","type":"CDSView"},{"attributes":{"editor":{"id":"1219","type":"StringEditor"},"field":"mass","formatter":{"id":"1146","type":"NumberFormatter"},"title":"Mass"},"id":"1147","type":"TableColumn"},{"attributes":{"children":[{"id":"1160","type":"TextInput"},{"id":"1161","type":"TextInput"},{"id":"1162","type":"TextInput"},{"id":"1163","type":"TextInput"},{"id":"1164","type":"TextInput"},{"id":"1168","type":"Column"}]},"id":"1187","type":"Row"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1070","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1106","type":"CDSView"}},"id":"1105","type":"GlyphRenderer"},{"attributes":{"line_color":"#bcbd22","name":"Series 9","x":{"field":"Mass"},"y":{"field":"Series 9"}},"id":"1070","type":"Line"},{"attributes":{},"id":"1149","type":"NumberFormatter"},{"attributes":{"children":[{"id":"1158","type":"DataTable"}]},"id":"1188","type":"Row"},{"attributes":{"line_color":"#17becf","name":"Series 10","x":{"field":"Mass"},"y":{"field":"Series 10"}},"id":"1071","type":"Line"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1106","type":"CDSView"},{"attributes":{"editor":{"id":"1220","type":"StringEditor"},"field":"min","formatter":{"id":"1149","type":"NumberFormatter"},"title":"Minimum #"},"id":"1150","type":"TableColumn"},{"attributes":{"children":[{"id":"1171","type":"Select"},{"id":"1172","type":"TextInput"},{"id":"1183","type":"Button"}]},"id":"1189","type":"Row"},{"attributes":{"data_source":{"id":"1060","type":"AjaxDataSource"},"glyph":{"id":"1071","type":"Line"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1108","type":"CDSView"}},"id":"1107","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1234","type":"Selection"},"selection_policy":{"id":"1233","type":"UnionRenderers"}},"id":"1072","type":"AjaxDataSource"},{"attributes":{},"id":"1152","type":"NumberFormatter"},{"attributes":{"children":[{"id":"1180","type":"DataTable"}]},"id":"1190","type":"Row"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1236","type":"Selection"},"selection_policy":{"id":"1235","type":"UnionRenderers"}},"id":"1073","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1060","type":"AjaxDataSource"}},"id":"1108","type":"CDSView"},{"attributes":{"editor":{"id":"1221","type":"StringEditor"},"field":"max","formatter":{"id":"1152","type":"NumberFormatter"},"title":"Maximum #"},"id":"1153","type":"TableColumn"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1113","type":"CustomJS"},{"id":"1114","type":"CustomJS"}]},"label":"Peak prediction","width":150},"id":"1074","type":"Toggle"},{"attributes":{"data_source":{"id":"1072","type":"AjaxDataSource"},"glyph":{"id":"1075","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1110","type":"CDSView"},"visible":false},"id":"1109","type":"GlyphRenderer"},{"attributes":{},"id":"1155","type":"NumberFormatter"},{"attributes":{"children":[{"id":"1184","type":"Row"},{"id":"1185","type":"Row"},{"id":"1186","type":"Row"}]},"id":"1192","type":"Column"},{"attributes":{"line_color":{"value":"#1f77b4"},"line_width":{"value":2},"name":"pp_mean","xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1075","type":"MultiLine"},{"attributes":{"source":{"id":"1072","type":"AjaxDataSource"}},"id":"1110","type":"CDSView"},{"attributes":{"editor":{"id":"1222","type":"StringEditor"},"field":"stride","formatter":{"id":"1155","type":"NumberFormatter"},"title":"Stride"},"id":"1156","type":"TableColumn"},{"attributes":{"children":[{"id":"1187","type":"Row"},{"id":"1188","type":"Row"},{"id":"1189","type":"Row"},{"id":"1190","type":"Row"}],"visible":false},"id":"1193","type":"Column"},{"attributes":{"data_source":{"id":"1073","type":"AjaxDataSource"},"glyph":{"id":"1076","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1112","type":"CDSView"},"visible":false},"id":"1111","type":"GlyphRenderer"},{"attributes":{"line_color":{"value":"#1f77b4"},"line_dash":[6],"line_width":{"value":2},"name":"pp_std","xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1076","type":"MultiLine"},{"attributes":{"columns":[{"id":"1145","type":"TableColumn"},{"id":"1147","type":"TableColumn"},{"id":"1150","type":"TableColumn"},{"id":"1153","type":"TableColumn"},{"id":"1156","type":"TableColumn"}],"editable":true,"height":280,"index_header":"Index","name":"Complex table","source":{"id":"1144","type":"AjaxDataSource"},"view":{"id":"1159","type":"CDSView"},"width":534},"id":"1158","type":"DataTable"},{"attributes":{"callback":null,"height":30,"js_property_callbacks":{"change:value":[{"id":"1080","type":"CustomJS"}]},"options":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10"],"value":"Series 1","width":150},"id":"1077","type":"Select"},{"attributes":{"args":{"other":{"id":"1193","type":"Column"}},"code":"other.visible = this.active"},"id":"1194","type":"CustomJS"},{"attributes":{"source":{"id":"1073","type":"AjaxDataSource"}},"id":"1112","type":"CDSView"},{"attributes":{"source":{"id":"1144","type":"AjaxDataSource"}},"id":"1159","type":"CDSView"},{"attributes":{"children":[{"id":"1192","type":"Column"},{"id":"1193","type":"Column"}]},"id":"1195","type":"Row"},{"attributes":{"args":{"other":{"id":"1109","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1113","type":"CustomJS"},{"attributes":{"callback":{"id":"1078","type":"CustomJS"},"color":"#1f77b4","height":30,"width":50},"id":"1079","type":"ColorPicker"},{"attributes":{"callback":null,"title":"Name ","value":"Subunit 1","width":80},"id":"1160","type":"TextInput"},{"attributes":{"args":{"pp_mean":{"id":"1075","type":"MultiLine"},"pp_std":{"id":"1076","type":"MultiLine"},"sel_lines":{"Series 1":{"id":"1062","type":"Line"},"Series 10":{"id":"1071","type":"Line"},"Series 2":{"id":"1063","type":"Line"},"Series 3":{"id":"1064","type":"Line"},"Series 4":{"id":"1065","type":"Line"},"Series 5":{"id":"1066","type":"Line"},"Series 6":{"id":"1067","type":"Line"},"Series 7":{"id":"1068","type":"Line"},"Series 8":{"id":"1069","type":"Line"},"Series 9":{"id":"1070","type":"Line"}},"ser_act":{"id":"1077","type":"Select"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10"]},"code":"var act = ser_act.value;\nvar names = series_names;\nvar line = sel_lines[act]\nline.line_color = cb_obj.color;\npp_mean.line_color = cb_obj.color;\npp_std.line_color = cb_obj.color;\n"},"id":"1078","type":"CustomJS"},{"attributes":{"args":{"other":{"id":"1111","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1114","type":"CustomJS"},{"attributes":{"callback":null,"title":"Mass ","value":"1000.0","width":80},"id":"1161","type":"TextInput"},{"attributes":{"line_color":{"value":"grey"},"line_width":{"value":2},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1115","type":"MultiLine"},{"attributes":{"args":{"aser_data":{"id":"1058","type":"AjaxDataSource"},"col":{"id":"1079","type":"ColorPicker"},"pp_mean":{"id":"1075","type":"MultiLine"},"pp_mean_data":{"id":"1072","type":"AjaxDataSource"},"pp_std":{"id":"1076","type":"MultiLine"},"pp_std_data":{"id":"1073","type":"AjaxDataSource"},"sel_lines":{"Series 1":{"id":"1062","type":"Line"},"Series 10":{"id":"1071","type":"Line"},"Series 2":{"id":"1063","type":"Line"},"Series 3":{"id":"1064","type":"Line"},"Series 4":{"id":"1065","type":"Line"},"Series 5":{"id":"1066","type":"Line"},"Series 6":{"id":"1067","type":"Line"},"Series 7":{"id":"1068","type":"Line"},"Series 8":{"id":"1069","type":"Line"},"Series 9":{"id":"1070","type":"Line"}},"series_data":{"Series 1":{"id":"1027","type":"AjaxDataSource"},"Series 10":{"id":"1054","type":"AjaxDataSource"},"Series 2":{"id":"1030","type":"AjaxDataSource"},"Series 3":{"id":"1033","type":"AjaxDataSource"},"Series 4":{"id":"1036","type":"AjaxDataSource"},"Series 5":{"id":"1039","type":"AjaxDataSource"},"Series 6":{"id":"1042","type":"AjaxDataSource"},"Series 7":{"id":"1045","type":"AjaxDataSource"},"Series 8":{"id":"1048","type":"AjaxDataSource"},"Series 9":{"id":"1051","type":"AjaxDataSource"}},"series_masses":{"id":"1057","type":"AjaxDataSource"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10"]},"code":"var names = series_names;\nvar sele_lines = {};\nvar masses = series_masses.data\nvar ser_data = {};\n\n\n\nfor(i_ser in names){\n    sele_lines[names[i_ser]]=sel_lines[names[i_ser]];\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    }\n\nvar act = cb_obj.value;\ncol.color = sele_lines[act].line_color;\n\nvar ppm_data = { \"xs\":[], \"ys\":[] }\nvar pps_data = { \"xs\":[], \"ys\":[] }\n\nif (ser_data[act]['x_max'].length &gt; 1){\n    i_act = 0\n    /// Find correct series index for calculing peak prediction\n    for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n        if (masses['Series'][i_ms] == act){\n            i_act=i_ms\n        }\n    }\n\n    ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n    ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n    pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n    pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n    ppm_data['xs'].push([ppm_low, ppm_low])\n    ppm_data['xs'].push([ppm_upp, ppm_upp])\n    ppm_data['ys'].push([0.0, 100.0])\n    ppm_data['ys'].push([0.0, 100.0])\n\n    pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n    pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n    pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n    pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n    pps_data['ys'].push([0.0, 100.0])\n    pps_data['ys'].push([0.0, 100.0])\n    pps_data['ys'].push([0.0, 100.0])\n    pps_data['ys'].push([0.0, 100.0])\n}\n\npp_mean_data.data = ppm_data;\npp_std_data.data  = pps_data;\n\npp_mean.line_color = sele_lines[act].line_color;\npp_std.line_color = sele_lines[act].line_color;\n\naser_data.data = series_data[act].data;\n\n\n"},"id":"1080","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1258","type":"Selection"},"selection_policy":{"id":"1257","type":"UnionRenderers"}},"id":"1116","type":"AjaxDataSource"},{"attributes":{"callback":null,"title":"Min:","value":"0","width":80},"id":"1162","type":"TextInput"},{"attributes":{"text":""},"id":"1196","type":"Title"},{"attributes":{"data_source":{"id":"1116","type":"AjaxDataSource"},"glyph":{"id":"1115","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1118","type":"CDSView"},"visible":false},"id":"1117","type":"GlyphRenderer"},{"attributes":{"args":{"bg_mz":{"id":"1060","type":"AjaxDataSource"},"plot_canvas":{"id":"1001","subtype":"Figure","type":"Plot"},"pp_mean_data":{"id":"1072","type":"AjaxDataSource"},"pp_std_data":{"id":"1073","type":"AjaxDataSource"},"raw_mz":{"id":"1059","type":"AjaxDataSource"},"sel_lines":{"Series 1":{"id":"1062","type":"Line"},"Series 10":{"id":"1071","type":"Line"},"Series 2":{"id":"1063","type":"Line"},"Series 3":{"id":"1064","type":"Line"},"Series 4":{"id":"1065","type":"Line"},"Series 5":{"id":"1066","type":"Line"},"Series 6":{"id":"1067","type":"Line"},"Series 7":{"id":"1068","type":"Line"},"Series 8":{"id":"1069","type":"Line"},"Series 9":{"id":"1070","type":"Line"}},"ser_act":{"id":"1077","type":"Select"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10"]},"code":"var act =cb_obj.value;\n\nnew_data = {'Mass': [], 'Intensity': [], 'Background': [], 'Series 1': [], 'Series 2': [], 'Series 3': [], 'Series 4': [], 'Series 5': [], 'Series 6': [], 'Series 7': [], 'Series 8': [], 'Series 9': [], 'Series 10': []}\n\nconsole.log(act)\nif(act== \"load_file\"){\n    var input = document.createElement('input');\n    input.type = 'file';\n    input.onchange = e =&gt; {\n\n    // getting a hold of the file reference\n    var file = e.target.files[0];\n\n    // setting up the reader\n    var reader = new FileReader();\n    reader.readAsText(file,'UTF-8');\n\n    // here we tell the reader what to do when it's done reading...\n    reader.onload = readerEvent =&gt; {\n        var content = readerEvent.target.result; // this is the content!\n        ///console.log( content );\n\n        var lines = content.split('\\n')\n\n        for(i=10; i &lt; lines.length; i++){\n            line = lines[i].split('\\t')\n            new_data['Mass'].push(parseFloat(line[0]))\n            new_data['Intensity'].push(parseFloat(line[1]))\n            new_data['Background'].push(parseFloat(line[1]))\n            new_data['Series 1'].push(Math.NaN)\n            new_data['Series 2'].push(Math.NaN)\n            new_data['Series 3'].push(Math.NaN)\n            new_data['Series 4'].push(Math.NaN)\n            new_data['Series 5'].push(Math.NaN)\n            new_data['Series 6'].push(Math.NaN)\n            new_data['Series 7'].push(Math.NaN)\n            new_data['Series 8'].push(Math.NaN)\n            new_data['Series 9'].push(Math.NaN)\n            new_data['Series 10'].push(Math.NaN)\n        }\n\n          /// Find maximum and normalise data\n        max_int=0.0\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            if(new_data['Intensity'][i] &gt; max_int){\n                max_int = new_data['Intensity'][i];\n            }\n        }\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            new_data['Background'][i] = 100 * new_data['Background'][i] / max_int;\n            new_data['Intensity'][i] = 100 * new_data['Intensity'][i] / max_int;\n        }\n        bg_mz.data=new_data\n        raw_mz.data=new_data\n        }\n    }\n    input.click();\n}\n\nif(act== \"load_clip\"){\n\n    var ms = prompt(\"Paste spectrum here\", \"\");\n    if (ms != null) {\n        var lines = ms.split('\\n')\n        for(i=10; i &lt; lines.length; i++){\n            line = lines[i].split('\\t')\n            new_data['Mass'].push(parseFloat(line[0]))\n            new_data['Intensity'].push(parseFloat(line[1]))\n            new_data['Background'].push(parseFloat(line[1]))\n            new_data['Series 1'].push(Math.NaN)\n            new_data['Series 2'].push(Math.NaN)\n            new_data['Series 3'].push(Math.NaN)\n            new_data['Series 4'].push(Math.NaN)\n            new_data['Series 5'].push(Math.NaN)\n            new_data['Series 6'].push(Math.NaN)\n            new_data['Series 7'].push(Math.NaN)\n            new_data['Series 8'].push(Math.NaN)\n            new_data['Series 9'].push(Math.NaN)\n            new_data['Series 10'].push(Math.NaN)\n        }\n      \n        /// Find maximum and normalise data\n        max_int=0.0\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            if(new_data['Intensity'][i] &gt; max_int){\n                max_int = new_data['Intensity'][i];\n            }\n        }\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            new_data['Background'][i] = 100 * new_data['Background'][i] / max_int;\n            new_data['Intensity'][i] = 100 * new_data['Intensity'][i] / max_int;\n        }\n        bg_mz.data=new_data\n        raw_mz.data=new_data\n    }\n\n}\n\nif (act == 'load_sess'){\n    var input = document.createElement('input');\n        input.type = 'file';\n        input.onchange = e =&gt; {\n\n        // getting a hold of the file reference\n        var file = e.target.files[0];\n\n        // setting up the reader\n        var reader = new FileReader();\n        reader.readAsText(file,'UTF-8');\n\n        // here we tell the reader what to do when it's done reading...\n        reader.onload = readerEvent =&gt; {\n            var content = readerEvent.target.result; // this is the content!\n            /// Line below is short for look in content for key data and put into left data (professional name object destructuring)\n            const {raw_data} = JSON.parse(content)\n            bg_mz.data = data\n        }\n    }\n    input.click();\n}\n\n\nif (act == 'save_sess'){\n    var raw_data =raw_mz.data;\n    var smooth_data =raw_mz.data;\n\n    let save_json = {  data, }\n\n    var jsonData = JSON.stringify(data);\n    function download(content, fileName, contentType) {\n        var a = document.createElement(\"a\");\n        var file = new Blob([content], {type: contentType});\n        a.href = URL.createObjectURL(file);\n        a.download = fileName;\n        a.click();\n    }\n    download(jsonData, 'json.navia', 'navia');\n}\n\n/// Save sessions regurlarly\n/*\nwindow.setInteval(function(){\n    let save_json = {  data, }\n    var jsonData = JSON.stringify(data);\n    try {\n        window.localStorage.setItem(\"curr_sess\", jsonData)\n    }},1000)\n*/"},"id":"1081","type":"CustomJS"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:value":[{"id":"1081","type":"CustomJS"}]},"label":"File","menu":[["Load spectrum from file","load_file"],["Load spectrum from clipboard","load_clip"],null,["Save session","save_sess"],["Load session","load_sess"],null,["Load subunit table","load_suta"]],"width":200},"id":"1082","type":"Dropdown"},{"attributes":{"callback":null,"title":"Max:","value":"1","width":80},"id":"1163","type":"TextInput"},{"attributes":{},"id":"1198","type":"BasicTickFormatter"},{"attributes":{"source":{"id":"1116","type":"AjaxDataSource"}},"id":"1118","type":"CDSView"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1119","type":"CustomJS"}]},"label":"Mass Finder","width":150},"id":"1083","type":"Toggle"},{"attributes":{},"id":"1200","type":"BasicTickFormatter"},{"attributes":{"callback":null,"title":"Stride:","value":"1","width":80},"id":"1164","type":"TextInput"},{"attributes":{"callback":null,"tooltips":[["m/z","$x{5.2f}"],["Abundance","$y %"]]},"id":"1120","type":"HoverTool"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1194","type":"CustomJS"}]},"label":"Mass Matching &amp; Comment","width":200},"id":"1084","type":"Toggle"},{"attributes":{"args":{"mass_finder_data":{"id":"1116","type":"AjaxDataSource"},"mfl":{"id":"1117","type":"GlyphRenderer"}},"code":"if (cb_obj.active==true){\n\tconsole.log(\"Into MF loop\")\n\tconsole.log(mass_finder_data.data)\n\tvar mf_data = { \"xs\":[], \"ys\":[] }\n\tvar comp_mass = prompt(\"Mass of complex in Da\", \"10000.0\");\n\tvar mz_min = prompt(\"Lower m/z bound\", \"1000.0\");\n \tvar mz_max = prompt(\"Upper m/z bound\", \"2000.0\");\n\n\n\tvar z_max = Math.floor(parseFloat(comp_mass) / (parseFloat(mz_min)+0.1))\n \tvar z_min = Math.ceil(parseFloat(comp_mass) / (parseFloat(mz_max)+0.1))\n\n \tfor (z=z_min; z&lt;z_max; z++){\n \t \tmf_data[\"ys\"].push([0.0, 100.0])\n \t \tmf_data[\"xs\"].push([Number(comp_mass) / z , Number(comp_mass) / z])\n \t \tconsole.log(Number(comp_mass) / z)\n \t}\n \tmfl.visible=true;\n \tmass_finder_data.data = mf_data;\n}\n\nelse{\n \t mfl.visible=false;\n \t var mf_data = { \"xs\":[], \"ys\":[] }\n \t mass_finder_data.data = mf_data;\n}"},"id":"1119","type":"CustomJS"},{"attributes":{},"id":"1202","type":"UnionRenderers"},{"attributes":{"button_type":"success","callback":{"id":"1165","type":"CustomJS"},"height":30,"icon":null,"label":"Add subunit","width":84},"id":"1166","type":"Button"},{"attributes":{"callback":null},"id":"1002","type":"DataRange1d"},{"attributes":{},"id":"1203","type":"Selection"},{"attributes":{"format":"0,0.00"},"id":"1123","type":"NumberFormatter"},{"attributes":{"callback":null},"id":"1004","type":"DataRange1d"},{"attributes":{"args":{"SU_act":{"id":"1144","type":"AjaxDataSource"},"SU_mass":{"id":"1161","type":"TextInput"},"SU_max":{"id":"1163","type":"TextInput"},"SU_min":{"id":"1162","type":"TextInput"},"SU_name":{"id":"1160","type":"TextInput"},"SU_stride":{"id":"1164","type":"TextInput"}},"code":"complexes=SU_act.data\n\ncomplexes['name'].push(SU_name.value)\ncomplexes['mass'].push(SU_mass.value)\ncomplexes['min'].push(SU_min.value)\ncomplexes['max'].push(SU_max.value)\ncomplexes['stride'].push(SU_stride.value)\n\nSU_act.change.emit()"},"id":"1165","type":"CustomJS"},{"attributes":{"args":{"aser_data":{"id":"1058","type":"AjaxDataSource"},"bg_mz":{"id":"1060","type":"AjaxDataSource"},"pp_mean_data":{"id":"1072","type":"AjaxDataSource"},"pp_std_data":{"id":"1073","type":"AjaxDataSource"},"raw_mz":{"id":"1059","type":"AjaxDataSource"},"ser_act":{"id":"1077","type":"Select"},"series_data":{"Series 1":{"id":"1027","type":"AjaxDataSource"},"Series 10":{"id":"1054","type":"AjaxDataSource"},"Series 2":{"id":"1030","type":"AjaxDataSource"},"Series 3":{"id":"1033","type":"AjaxDataSource"},"Series 4":{"id":"1036","type":"AjaxDataSource"},"Series 5":{"id":"1039","type":"AjaxDataSource"},"Series 6":{"id":"1042","type":"AjaxDataSource"},"Series 7":{"id":"1045","type":"AjaxDataSource"},"Series 8":{"id":"1048","type":"AjaxDataSource"},"Series 9":{"id":"1051","type":"AjaxDataSource"}},"series_masses":{"id":"1057","type":"AjaxDataSource"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10"],"series_sele":{"Series 1":{"id":"1028","type":"AjaxDataSource"},"Series 10":{"id":"1055","type":"AjaxDataSource"},"Series 2":{"id":"1031","type":"AjaxDataSource"},"Series 3":{"id":"1034","type":"AjaxDataSource"},"Series 4":{"id":"1037","type":"AjaxDataSource"},"Series 5":{"id":"1040","type":"AjaxDataSource"},"Series 6":{"id":"1043","type":"AjaxDataSource"},"Series 7":{"id":"1046","type":"AjaxDataSource"},"Series 8":{"id":"1049","type":"AjaxDataSource"},"Series 9":{"id":"1052","type":"AjaxDataSource"}}},"code":"    /// Define closest, BubbleSort Peak Prediction and MacSED\n\n\n        function mean_func(array){\n            mean_res = 0.0\n            for (i=0; i &lt; array.length; i++){\n                mean_res += array[i]\n            }\n            mean_res = mean_res / array.length\n            return mean_res\n        }\n\n         function std_func(array){\n            mean_res = mean_func(array)\n            std_res = 0\n            for (i=0; i &lt; array.length; i++){\n                std_res += (array[i]-mean_res)*(array[i]-mean_res)\n            }\n            std_res = Math.sqrt(std_res / (array.length-1))\n            return std_res\n        }\n\n\n        function closest(array,num){\n            var i=0;\n            var minDiff=10000;\n            var i_closest;\n            for(i=0; i&lt; array.length; i++){\n                var m=Math.abs(Math.abs(num)-array[i]);\n                if(m&lt;minDiff){ \n                    minDiff=m; \n                    i_closest=i; \n                }\n            }\n            return i_closest;\n        }\n\n        function BubbleSort(array){\n        var array= array;\n          for(i=0; i &lt; array.length-1; i++){\n                for(j=0; j &lt; array.length-1; j++){\n                    if(array[j] &gt; array[j+1]){\n                        dummy = array[j];\n                        array[j] = array[j+1];\n                        array[j+1] = dummy;\n                    }\n                }\n                j=0\n            }\n            return array;\n        }\n\n        function MacSED(series_i_max){\n            z_max=200\n            m_h=1.00784\n            maxima = []\n            for(i=series_i_max.length-1; i&gt;=0; i--){\n                maxima.push(series_i_max[i])\n            }\n            mass_mat = []\n            charge_mat = []\n            mean_arr = []\n            std_arr = []\n\n            for(z=0; z &lt; z_max; z++){\n                mass_mat.push([])\n                charge_mat.push([])\n                for(i_m=0; i_m &lt; maxima.length; i_m++){\n                    mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h)\n                    charge_mat[z].push(z+1+i_m)\n                }\n                mean_arr.push(mean_func(mass_mat[z]))\n                std_arr.push(  std_func(mass_mat[z]))\n            }\n            i_best = closest(std_arr, 0.0)\n            charge_arr=[]\n\n            for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n                charge_arr.push(charge_mat[i_best][i])\n            } \n\n            res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n            return res\n\n        }\n\n        function peakprediction(masses,ser_data){\n                    var ppm_data = { \"xs\":[], \"ys\":[] }\n                    var pps_data = { \"xs\":[], \"ys\":[] }\n\n                    if (ser_data[act]['x_max'].length &gt; 1){\n                        i_act = 0\n                        /// Find correct series index for calculing peak prediction\n                        for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                            if (masses['Series'][i_ms] == act){\n                                i_act=i_ms\n                            }\n                        }\n\n                        ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n                        ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n                        pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n                        pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n                        ppm_data['xs'].push([ppm_low, ppm_low])\n                        ppm_data['xs'].push([ppm_upp, ppm_upp])\n                        ppm_data['ys'].push([0.0, 100.0])\n                        ppm_data['ys'].push([0.0, 100.0])\n\n                        pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n                        pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n                        pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n                        pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n                        pps_data['ys'].push([0.0, 100.0])\n                        pps_data['ys'].push([0.0, 100.0])\n                        pps_data['ys'].push([0.0, 100.0])\n                        pps_data['ys'].push([0.0, 100.0])\n                    }\n\n                    pp_mean_data.data = ppm_data;\n                    pp_std_data.data  = pps_data;\n        }\n\n    /// Get data source from Callback args\n\n        var data = bg_mz.data;\n        var act = ser_act.value;\n\n        var sele = {};\n        var ser_data={};\n        var act_data=aser_data.data;\n        var masses = series_masses.data;\n\n        var names = series_names;\n\n        /// remember i in x gives ith element\n        for(i_ser in names){\n            sele[names[i_ser]]=series_sele[names[i_ser]].data;\n            ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n        }\n        \n\n\n    /// get BoxSelectTool dimensions from cb_data parameter of Callback\n\n        var geometry = cb_data['geometry'];\n\n\n    /// Find indices of lower/upper range marked\n\n        i_low = closest(data['Mass'], geometry['x0']);\n        i_upp = closest(data['Mass'], geometry['x1']);\n\n\n    /// Boolean to decide whether to append new selection\n\n        var nopush = false;\n\n    /// Loops &amp; logics which makes sure overlapping selections are handled cor-\n    /// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                        break;\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['Mass'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['Mass'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['Mass'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['Mass'][i_upp];\n                    }\n                } \n            }\n        }\n    console.log('did selection logics')    \n\n    /// Append new indices if selection requires it\n\n        if (nopush == false){\n\n            /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n            var data_to_find_max = [];\n            for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n                data_to_find_max.push(data['Intensity'][i_ind]);\n            }\n\n            \n            i_max = closest(data_to_find_max, 100.0) + i_low\n\n            sele[act]['i_max'].push(i_max);\n            sele[act]['i_upp'].push(i_upp);\n            sele[act]['i_low'].push(i_low);\n\n            ser_data[act]['x_max'].push(data['Mass'][i_max]);\n            ser_data[act]['x_upp'].push(data['Mass'][i_upp]);\n            ser_data[act]['x_low'].push(data['Mass'][i_low]);\n            ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n             \n\n            if (ser_data[act]['x_max'].length &gt;1 ){\n                ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n                ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n                ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n                sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n                sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n                sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n                x = sele[act]['i_max']\n                for(i=0; i &lt; x.length; i++){\n                    x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n                }\n                ser_data[act][\"charge\"].push(0);\n\n                \n            }\n            else{\n                ser_data[act][\"charge\"].push(0);\n            }\n        }\n\n    /// Selection of indices done, emit changes\n        for(i_ser in names){\n            series_sele[names[i_ser]].change.emit();\n            series_data[names[i_ser]].change.emit();\n        } \n\n    /// First set all series to NaN to make sure everything (WORKS)\n\n        for(i_ser in names){\n            for(i=0; i &lt; data[names[i_ser]].length; i++){\n                data[names[i_ser]][i]=Math.NaN;\n            }\n        }       \n\n\n    /// Put background to intensity \n\n        for(i=0; i &lt; data['Intensity'].length; i++){\n            data['Background'][i]=data['Intensity'][i]; \n        }\n\n\n    /// Now, put in data in correct columns in source\n\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                    overlap_low = 1;\n                    overlap_upp = 1;\n\n                    if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                        overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                    }\n                    if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                        overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                    }\n                    for(i_dat=sele[names[i_ser]]['i_low'][i_peak]-overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                        data[names[i_ser]][i_dat]=data['Intensity'][i_dat];\n                        if(!(i_dat &lt; sele[names[i_ser]]['i_low'][i_peak] || i_dat &gt;=  sele[names[i_ser]]['i_upp'][i_peak])){\n                            data['Background'][i_dat]=Math.NaN;\n                        }\n                    }   \n                }\n            }\n        }\n\n\n    /// Do MacSED \n        MacSED_res=[[],[],[]]\n        charges={}\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_max'].length &gt; 1){\n                mass_res=MacSED(ser_data[names[i_ser]]['x_max'])\n                charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n                for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                    charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n                }\n                series_data[names[i_ser]].change.emit()\n                MacSED_res[0].push(names[i_ser])\n                MacSED_res[1].push(mass_res[0])\n                MacSED_res[2].push(mass_res[1])\n\n            }\n        }\n\n        if (MacSED_res[0].length &gt; 0){\n            for (i=0; i &lt; MacSED_res[0].length; i++){\n                if(i &gt;= masses[\"Series\"].length){\n                    masses[\"Series\"].push(MacSED_res[0][i])\n                    masses[\"Mass\"].push(MacSED_res[1][i])\n                    masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                }\n                else{\n                    masses[\"Series\"][i] = MacSED_res[0][i]\n                    masses[\"Mass\"][i] = MacSED_res[1][i]\n                    masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                }\n            }\n        }\n\n        peakprediction(masses,ser_data);\n\n\n        /// Fill shown table with active series\n        let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n        for (i=0; i &lt; ser_data[act]['x_low'].length; i++){\n            adat['x_low'].push(ser_data[act]['x_low'][i])\n            adat['x_upp'].push(ser_data[act]['x_upp'][i])\n            adat['x_max'].push(ser_data[act]['x_max'][i])\n            adat['max_int'].push(ser_data[act]['max_int'][i])\n            adat['charge'].push(ser_data[act]['charge'][i])  \n        }\n\n    aser_data.data = adat;\n\n    series_masses.change.emit();\n    bg_mz.change.emit();\n"},"id":"1085","type":"CustomJS"},{"attributes":{},"id":"1204","type":"StringEditor"},{"attributes":{},"id":"1240","type":"Selection"},{"attributes":{},"id":"1006","type":"LinearScale"},{"attributes":{},"id":"1205","type":"StringEditor"},{"attributes":{},"id":"1241","type":"UnionRenderers"},{"attributes":{},"id":"1008","type":"LinearScale"},{"attributes":{},"id":"1206","type":"StringEditor"},{"attributes":{},"id":"1242","type":"Selection"},{"attributes":{"axis_label":"m/z ","formatter":{"id":"1200","type":"BasicTickFormatter"},"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1010","type":"LinearAxis"},{"attributes":{},"id":"1207","type":"StringFormatter"},{"attributes":{},"id":"1243","type":"UnionRenderers"},{"attributes":{},"id":"1011","type":"BasicTicker"},{"attributes":{},"id":"1208","type":"StringEditor"},{"attributes":{},"id":"1244","type":"Selection"},{"attributes":{"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1014","type":"Grid"},{"attributes":{},"id":"1209","type":"UnionRenderers"},{"attributes":{},"id":"1245","type":"UnionRenderers"},{"attributes":{"axis_label":"Rel. Abundance  [%]","formatter":{"id":"1198","type":"BasicTickFormatter"},"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1015","type":"LinearAxis"},{"attributes":{},"id":"1210","type":"Selection"},{"attributes":{},"id":"1246","type":"Selection"},{"attributes":{},"id":"1016","type":"BasicTicker"},{"attributes":{},"id":"1211","type":"StringFormatter"},{"attributes":{},"id":"1247","type":"UnionRenderers"},{"attributes":{"dimension":1,"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1019","type":"Grid"},{"attributes":{},"id":"1212","type":"StringEditor"},{"attributes":{},"id":"1248","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1238","type":"Selection"},"selection_policy":{"id":"1237","type":"UnionRenderers"}},"id":"1027","type":"AjaxDataSource"},{"attributes":{},"id":"1213","type":"StringEditor"},{"attributes":{},"id":"1249","type":"UnionRenderers"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1020","type":"BoxZoomTool"},{"id":"1021","type":"ResetTool"},{"id":"1022","type":"SaveTool"},{"id":"1120","type":"HoverTool"},{"id":"1086","type":"BoxSelectTool"}]},"id":"1023","type":"Toolbar"},{"attributes":{},"id":"1214","type":"StringEditor"},{"attributes":{},"id":"1250","type":"Selection"},{"attributes":{},"id":"1275","type":"UnionRenderers"},{"attributes":{"overlay":{"id":"1259","type":"BoxAnnotation"}},"id":"1020","type":"BoxZoomTool"},{"attributes":{},"id":"1021","type":"ResetTool"},{"attributes":{},"id":"1215","type":"UnionRenderers"},{"attributes":{},"id":"1251","type":"UnionRenderers"},{"attributes":{},"id":"1022","type":"SaveTool"},{"attributes":{},"id":"1216","type":"Selection"},{"attributes":{},"id":"1252","type":"Selection"},{"attributes":{},"id":"1217","type":"StringFormatter"},{"attributes":{},"id":"1253","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1262","type":"Selection"},"selection_policy":{"id":"1261","type":"UnionRenderers"}},"id":"1028","type":"AjaxDataSource"},{"attributes":{},"id":"1218","type":"StringEditor"},{"attributes":{},"id":"1254","type":"Selection"},{"attributes":{},"id":"1219","type":"StringEditor"},{"attributes":{},"id":"1255","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1240","type":"Selection"},"selection_policy":{"id":"1239","type":"UnionRenderers"}},"id":"1030","type":"AjaxDataSource"},{"attributes":{},"id":"1220","type":"StringEditor"},{"attributes":{},"id":"1256","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1264","type":"Selection"},"selection_policy":{"id":"1263","type":"UnionRenderers"}},"id":"1031","type":"AjaxDataSource"},{"attributes":{},"id":"1221","type":"StringEditor"},{"attributes":{},"id":"1257","type":"UnionRenderers"},{"attributes":{},"id":"1222","type":"StringEditor"},{"attributes":{},"id":"1258","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1242","type":"Selection"},"selection_policy":{"id":"1241","type":"UnionRenderers"}},"id":"1033","type":"AjaxDataSource"},{"attributes":{},"id":"1223","type":"UnionRenderers"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1259","type":"BoxAnnotation"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1266","type":"Selection"},"selection_policy":{"id":"1265","type":"UnionRenderers"}},"id":"1034","type":"AjaxDataSource"},{"attributes":{},"id":"1224","type":"Selection"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1260","type":"BoxAnnotation"},{"attributes":{},"id":"1225","type":"StringFormatter"},{"attributes":{},"id":"1261","type":"UnionRenderers"},{"attributes":{"below":[{"id":"1010","type":"LinearAxis"}],"center":[{"id":"1014","type":"Grid"},{"id":"1019","type":"Grid"}],"left":[{"id":"1015","type":"LinearAxis"}],"plot_width":950,"renderers":[{"id":"1087","type":"GlyphRenderer"},{"id":"1089","type":"GlyphRenderer"},{"id":"1091","type":"GlyphRenderer"},{"id":"1093","type":"GlyphRenderer"},{"id":"1095","type":"GlyphRenderer"},{"id":"1097","type":"GlyphRenderer"},{"id":"1099","type":"GlyphRenderer"},{"id":"1101","type":"GlyphRenderer"},{"id":"1103","type":"GlyphRenderer"},{"id":"1105","type":"GlyphRenderer"},{"id":"1107","type":"GlyphRenderer"},{"id":"1109","type":"GlyphRenderer"},{"id":"1111","type":"GlyphRenderer"},{"id":"1117","type":"GlyphRenderer"}],"title":{"id":"1196","type":"Title"},"toolbar":{"id":"1023","type":"Toolbar"},"x_range":{"id":"1002","type":"DataRange1d"},"x_scale":{"id":"1006","type":"LinearScale"},"y_range":{"id":"1004","type":"DataRange1d"},"y_scale":{"id":"1008","type":"LinearScale"}},"id":"1001","subtype":"Figure","type":"Plot"},{"attributes":{"adapter":null,"callback":null,"data":{"Mass":[],"Series":[],"Uncertainty":[]},"selected":{"id":"1210","type":"Selection"},"selection_policy":{"id":"1209","type":"UnionRenderers"}},"id":"1057","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1244","type":"Selection"},"selection_policy":{"id":"1243","type":"UnionRenderers"}},"id":"1036","type":"AjaxDataSource"},{"attributes":{},"id":"1226","type":"StringEditor"},{"attributes":{},"id":"1262","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1268","type":"Selection"},"selection_policy":{"id":"1267","type":"UnionRenderers"}},"id":"1037","type":"AjaxDataSource"},{"attributes":{},"id":"1227","type":"StringEditor"},{"attributes":{},"id":"1263","type":"UnionRenderers"},{"attributes":{},"id":"1228","type":"StringEditor"},{"attributes":{},"id":"1264","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1246","type":"Selection"},"selection_policy":{"id":"1245","type":"UnionRenderers"}},"id":"1039","type":"AjaxDataSource"},{"attributes":{},"id":"1229","type":"UnionRenderers"},{"attributes":{},"id":"1265","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1270","type":"Selection"},"selection_policy":{"id":"1269","type":"UnionRenderers"}},"id":"1040","type":"AjaxDataSource"},{"attributes":{},"id":"1230","type":"Selection"},{"attributes":{},"id":"1266","type":"Selection"},{"attributes":{},"id":"1231","type":"UnionRenderers"},{"attributes":{},"id":"1267","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1248","type":"Selection"},"selection_policy":{"id":"1247","type":"UnionRenderers"}},"id":"1042","type":"AjaxDataSource"},{"attributes":{},"id":"1232","type":"Selection"},{"attributes":{},"id":"1268","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1272","type":"Selection"},"selection_policy":{"id":"1271","type":"UnionRenderers"}},"id":"1043","type":"AjaxDataSource"},{"attributes":{},"id":"1233","type":"UnionRenderers"},{"attributes":{},"id":"1269","type":"UnionRenderers"},{"attributes":{},"id":"1234","type":"Selection"},{"attributes":{},"id":"1270","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1250","type":"Selection"},"selection_policy":{"id":"1249","type":"UnionRenderers"}},"id":"1045","type":"AjaxDataSource"},{"attributes":{},"id":"1235","type":"UnionRenderers"},{"attributes":{},"id":"1271","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1274","type":"Selection"},"selection_policy":{"id":"1273","type":"UnionRenderers"}},"id":"1046","type":"AjaxDataSource"},{"attributes":{},"id":"1236","type":"Selection"},{"attributes":{},"id":"1272","type":"Selection"},{"attributes":{},"id":"1237","type":"UnionRenderers"},{"attributes":{},"id":"1273","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1252","type":"Selection"},"selection_policy":{"id":"1251","type":"UnionRenderers"}},"id":"1048","type":"AjaxDataSource"},{"attributes":{},"id":"1238","type":"Selection"},{"attributes":{},"id":"1274","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1276","type":"Selection"},"selection_policy":{"id":"1275","type":"UnionRenderers"}},"id":"1049","type":"AjaxDataSource"},{"attributes":{},"id":"1239","type":"UnionRenderers"}],"root_ids":["1195"]},"title":"Bokeh Application","version":"1.4.0"}}
        </script>
        <script type="text/javascript">
          (function() {
            var fn = function() {
              Bokeh.safely(function() {
                (function(root) {
                  function embed_document(root) {
                    
                  var docs_json = document.getElementById('2023').textContent;
                  var render_items = [{"docid":"37928bb9-2812-4264-a4cb-db174f4cf504","roots":{"1195":"b1c10d3e-12a5-4574-93ed-2ca8f202b41b"}}];
                  root.Bokeh.embed.embed_items(docs_json, render_items);
                
                  }
                  if (root.Bokeh !== undefined) {
                    embed_document(root);
                  } else {
                    var attempts = 0;
                    var timer = setInterval(function(root) {
                      if (root.Bokeh !== undefined) {
                        clearInterval(timer);
                        embed_document(root);
                      } else {
                        attempts++;
                        if (attempts > 100) {
                          clearInterval(timer);
                          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                        }
                      }
                    }, 10, root)
                  }
                })(window);
              });
            };
            if (document.readyState != "loading") fn();
            else document.addEventListener("DOMContentLoaded", fn);
          })();
        </script>
    
  </body>
  
</html>
