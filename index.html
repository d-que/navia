



<!DOCTYPE html>
<html lang="en">
  
  <head>
    
      <meta charset="utf-8">
      <title>Navia Beta v 0.5</title>
      
      
        
          
        
        
          
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-1.4.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.4.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.4.0.min.js"></script>
        <script type="text/javascript">
            Bokeh.set_log_level("info");
        </script>
        
      
      
    
  </head>
  
  
  <body>
    
      
        
          
          
            
              <div class="bk-root" id="df3dcdf3-96ef-4686-8589-f3eed2984ddf" data-root-id="1662"></div>
            
          
        
      
      
        <script type="application/json" id="3975">
          {"d90f497b-6390-4ec2-8c83-9d8f3e44d109":{"roots":{"references":[{"attributes":{"args":{"other":{"id":"1471","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1476","type":"CustomJS"},{"attributes":{"args":{"other":{"id":"1473","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1477","type":"CustomJS"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#002147"},"line_width":{"value":2},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1478","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1869","type":"Selection"},"selection_policy":{"id":"1870","type":"UnionRenderers"}},"id":"1479","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1479","type":"AjaxDataSource"},"glyph":{"id":"1478","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1481","type":"CDSView"}},"id":"1480","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1479","type":"AjaxDataSource"}},"id":"1481","type":"CDSView"},{"attributes":{"callback":null,"tooltips":[["m/z","$x{5.2f}"],["Abundance","$y %"]]},"id":"1483","type":"HoverTool"},{"attributes":{"args":{"mass_finder_data":{"id":"1479","type":"AjaxDataSource"},"mfl":{"id":"1480","type":"GlyphRenderer"}},"code":"if (cb_obj.active==true){\n\tvar mf_data = { \"xs\":[], \"ys\":[] }\n\tvar comp_mass = prompt(\"Mass of complex in Da\", \"10000.0\");\n\tvar mz_min = prompt(\"Lower m/z bound\", \"1000.0\");\n \tvar mz_max = prompt(\"Upper m/z bound\", \"2000.0\");\n\n\n\tvar z_max = Math.floor(parseFloat(comp_mass) / (parseFloat(mz_min)+0.1))\n \tvar z_min = Math.ceil(parseFloat(comp_mass) / (parseFloat(mz_max)+0.1))\n\n \tfor (z=z_min; z&lt;z_max; z++){\n \t \tmf_data[\"ys\"].push([0.0, 100.0])\n \t \tmf_data[\"xs\"].push([Number(comp_mass) / z , Number(comp_mass) / z])\n \t \t///console.log(Number(comp_mass) / z)\n \t}\n \tmfl.visible=true;\n \tmass_finder_data.data = mf_data;\n}\n\nelse{\n \t mfl.visible=false;\n \t var mf_data = { \"xs\":[], \"ys\":[] }\n \t mass_finder_data.data = mf_data;\n}"},"id":"1482","type":"CustomJS"},{"attributes":{"format":"0,0.00"},"id":"1487","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1757","type":"StringEditor"},"field":"x_low","formatter":{"id":"1487","type":"NumberFormatter"},"title":"Lower m/z"},"id":"1488","type":"TableColumn"},{"attributes":{"format":"0,0.00"},"id":"1490","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1758","type":"StringEditor"},"field":"x_upp","formatter":{"id":"1490","type":"NumberFormatter"},"title":"Upper m/z"},"id":"1491","type":"TableColumn"},{"attributes":{"format":"0,0.00"},"id":"1493","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1759","type":"StringEditor"},"field":"x_max","formatter":{"id":"1493","type":"NumberFormatter"},"title":"mz of Max"},"id":"1494","type":"TableColumn"},{"attributes":{"format":"0,0.00"},"id":"1496","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1760","type":"StringEditor"},"field":"max_int","formatter":{"id":"1496","type":"NumberFormatter"},"title":"Intensity of Maximum"},"id":"1497","type":"TableColumn"},{"attributes":{"editor":{"id":"1762","type":"StringEditor"},"field":"charge","formatter":{"id":"1761","type":"StringFormatter"},"title":"Charge (Positive)"},"id":"1499","type":"TableColumn"},{"attributes":{"columns":[{"id":"1488","type":"TableColumn"},{"id":"1491","type":"TableColumn"},{"id":"1494","type":"TableColumn"},{"id":"1497","type":"TableColumn"},{"id":"1499","type":"TableColumn"}],"height":300,"index_position":null,"name":"Series 20","source":{"id":"1153","type":"AjaxDataSource"},"view":{"id":"1501","type":"CDSView"},"width":680},"id":"1500","type":"DataTable"},{"attributes":{"source":{"id":"1153","type":"AjaxDataSource"}},"id":"1501","type":"CDSView"},{"attributes":{"editor":{"id":"1766","type":"StringEditor"},"field":"Series","formatter":{"id":"1765","type":"StringFormatter"},"title":"Series"},"id":"1502","type":"TableColumn"},{"attributes":{"format":"0,0.00"},"id":"1503","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1767","type":"StringEditor"},"field":"Mass","formatter":{"id":"1503","type":"NumberFormatter"},"title":"Mass"},"id":"1504","type":"TableColumn"},{"attributes":{"format":"0,0.00"},"id":"1506","type":"NumberFormatter"},{"attributes":{"height":30,"text":" &lt;b&gt;X-Range (m/z)&lt;/b&gt;","width":100},"id":"1627","type":"Div"},{"attributes":{"editor":{"id":"1768","type":"StringEditor"},"field":"Uncertainty","formatter":{"id":"1506","type":"NumberFormatter"},"title":"Uncertainty"},"id":"1507","type":"TableColumn"},{"attributes":{"columns":[{"id":"1502","type":"TableColumn"},{"id":"1504","type":"TableColumn"},{"id":"1507","type":"TableColumn"}],"height":300,"index_position":null,"name":"Mass table","source":{"id":"1152","type":"AjaxDataSource"},"view":{"id":"1510","type":"CDSView"},"width":270},"id":"1509","type":"DataTable"},{"attributes":{"source":{"id":"1152","type":"AjaxDataSource"}},"id":"1510","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"mass":[],"max":[],"min":[],"name":[],"stride":[]},"selected":{"id":"1773","type":"Selection"},"selection_policy":{"id":"1774","type":"UnionRenderers"}},"id":"1511","type":"AjaxDataSource"},{"attributes":{"editor":{"id":"1874","type":"StringEditor"},"field":"name","formatter":{"id":"1873","type":"StringFormatter"},"title":"Subunit"},"id":"1512","type":"TableColumn"},{"attributes":{"format":"0,0.00"},"id":"1513","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1875","type":"StringEditor"},"field":"mass","formatter":{"id":"1513","type":"NumberFormatter"},"title":"Mass"},"id":"1514","type":"TableColumn"},{"attributes":{},"id":"1516","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1876","type":"StringEditor"},"field":"min","formatter":{"id":"1516","type":"NumberFormatter"},"title":"Minimum #"},"id":"1517","type":"TableColumn"},{"attributes":{},"id":"1519","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1877","type":"StringEditor"},"field":"max","formatter":{"id":"1519","type":"NumberFormatter"},"title":"Maximum #"},"id":"1520","type":"TableColumn"},{"attributes":{},"id":"1522","type":"NumberFormatter"},{"attributes":{"editor":{"id":"1878","type":"StringEditor"},"field":"stride","formatter":{"id":"1522","type":"NumberFormatter"},"title":"Stride"},"id":"1523","type":"TableColumn"},{"attributes":{"callback":null,"height":30,"value":"0.0","width":70},"id":"1631","type":"TextInput"},{"attributes":{"args":{"other":{"id":"1435","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1439","type":"CustomJS"},{"attributes":{},"id":"1850","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1437","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1440","type":"CustomJS"},{"attributes":{},"id":"1851","type":"Selection"},{"attributes":{"callback":null,"height":30,"value":"100.0","width":70},"id":"1632","type":"TextInput"},{"attributes":{"data_source":{"id":"1142","type":"AjaxDataSource"},"glyph":{"id":"1228","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1442","type":"CDSView"}},"id":"1441","type":"GlyphRenderer"},{"attributes":{},"id":"1852","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1624","type":"Div"},{"id":"1627","type":"Div"},{"id":"1628","type":"Div"}]},"id":"1633","type":"Column"},{"attributes":{"source":{"id":"1142","type":"AjaxDataSource"}},"id":"1442","type":"CDSView"},{"attributes":{},"id":"1853","type":"Selection"},{"attributes":{"children":[{"id":"1625","type":"Div"},{"id":"1629","type":"TextInput"},{"id":"1631","type":"TextInput"}]},"id":"1634","type":"Column"},{"attributes":{"data_source":{"id":"1142","type":"AjaxDataSource"},"glyph":{"id":"1229","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1444","type":"CDSView"}},"id":"1443","type":"GlyphRenderer"},{"attributes":{},"id":"1854","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1626","type":"Div"},{"id":"1630","type":"TextInput"},{"id":"1632","type":"TextInput"}]},"id":"1635","type":"Column"},{"attributes":{"source":{"id":"1142","type":"AjaxDataSource"}},"id":"1444","type":"CDSView"},{"attributes":{"children":[{"id":"1633","type":"Column"},{"id":"1634","type":"Column"},{"id":"1635","type":"Column"}]},"id":"1636","type":"Row"},{"attributes":{},"id":"1855","type":"Selection"},{"attributes":{"data_source":{"id":"1143","type":"AjaxDataSource"},"glyph":{"id":"1230","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1446","type":"CDSView"},"visible":false},"id":"1445","type":"GlyphRenderer"},{"attributes":{},"id":"1856","type":"UnionRenderers"},{"attributes":{"height":30,"width":100},"id":"1638","type":"Div"},{"attributes":{"source":{"id":"1143","type":"AjaxDataSource"}},"id":"1446","type":"CDSView"},{"attributes":{},"id":"1857","type":"Selection"},{"attributes":{"args":{"plot_canvas":{"id":"1001","subtype":"Figure","type":"Plot"},"x_range_max":{"id":"1630","type":"TextInput"},"x_range_min":{"id":"1629","type":"TextInput"},"y_range_max":{"id":"1632","type":"TextInput"},"y_range_min":{"id":"1631","type":"TextInput"}},"code":"plot_canvas.x_range.start=Number(x_range_min.value)\nplot_canvas.x_range.end=Number(x_range_max.value)\nplot_canvas.y_range.start=Number(y_range_min.value)\nplot_canvas.y_range.end=Number(y_range_max.value)\n// plot_canvas.y_range=[y_range_min.value, y_range_max.value]\n"},"id":"1637","type":"CustomJS"},{"attributes":{"data_source":{"id":"1143","type":"AjaxDataSource"},"glyph":{"id":"1231","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1448","type":"CDSView"},"visible":false},"id":"1447","type":"GlyphRenderer"},{"attributes":{},"id":"1858","type":"UnionRenderers"},{"attributes":{"button_type":"success","callback":{"id":"1637","type":"CustomJS"},"height":30,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1637","type":"CustomJS"}]},"label":"Set range","width":150},"id":"1639","type":"Button"},{"attributes":{"source":{"id":"1143","type":"AjaxDataSource"}},"id":"1448","type":"CDSView"},{"attributes":{"children":[{"id":"1606","type":"Div"},{"id":"1609","type":"ToolbarBox"}]},"id":"1640","type":"Row"},{"attributes":{},"id":"1859","type":"Selection"},{"attributes":{"args":{"other":{"id":"1445","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1449","type":"CustomJS"},{"attributes":{"children":[{"id":"1638","type":"Div"},{"id":"1639","type":"Button"}]},"id":"1641","type":"Row"},{"attributes":{},"id":"1860","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1447","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1450","type":"CustomJS"},{"attributes":{"children":[{"id":"1622","type":"Div"},{"id":"1621","type":"Row"},{"id":"1640","type":"Row"},{"id":"1623","type":"Div"},{"id":"1636","type":"Row"},{"id":"1641","type":"Row"}],"visible":false},"id":"1642","type":"Column"},{"attributes":{},"id":"1861","type":"Selection"},{"attributes":{"data_source":{"id":"1146","type":"AjaxDataSource"},"glyph":{"id":"1232","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1452","type":"CDSView"}},"id":"1451","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1642","type":"Column"}},"code":"other.visible = this.active"},"id":"1643","type":"CustomJS"},{"attributes":{},"id":"1862","type":"UnionRenderers"},{"attributes":{"source":{"id":"1146","type":"AjaxDataSource"}},"id":"1452","type":"CDSView"},{"attributes":{},"id":"1863","type":"Selection"},{"attributes":{"callback":{"id":"1645","type":"CustomJS"},"height":30,"icon":null,"label":"File","menu":[["Load spectrum (txt file)","load_file"],["Load spectrum (clipboard)","load_clip"],null,["Save session","save_sess"],["Load session","load_sess"]],"width":180},"id":"1646","type":"Dropdown"},{"attributes":{"data_source":{"id":"1146","type":"AjaxDataSource"},"glyph":{"id":"1233","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1454","type":"CDSView"}},"id":"1453","type":"GlyphRenderer"},{"attributes":{},"id":"1864","type":"UnionRenderers"},{"attributes":{"args":{"grid_sele":{"id":"1573","type":"Toggle"},"highres_canvas":{"id":"1051","subtype":"Figure","type":"Plot"},"labels_sele":{"id":"1581","type":"Toggle"},"linew_txt":{"id":"1608","type":"TextInput"},"plot_canvas":{"id":"1001","subtype":"Figure","type":"Plot"},"sel_lines":{"Background":{"id":"1244","type":"MultiLine"},"Series 1":{"id":"1160","type":"MultiLine"},"Series 10":{"id":"1196","type":"MultiLine"},"Series 11":{"id":"1200","type":"MultiLine"},"Series 12":{"id":"1204","type":"MultiLine"},"Series 13":{"id":"1208","type":"MultiLine"},"Series 14":{"id":"1212","type":"MultiLine"},"Series 15":{"id":"1216","type":"MultiLine"},"Series 16":{"id":"1220","type":"MultiLine"},"Series 17":{"id":"1224","type":"MultiLine"},"Series 18":{"id":"1228","type":"MultiLine"},"Series 19":{"id":"1232","type":"MultiLine"},"Series 2":{"id":"1164","type":"MultiLine"},"Series 20":{"id":"1236","type":"MultiLine"},"Series 3":{"id":"1168","type":"MultiLine"},"Series 4":{"id":"1172","type":"MultiLine"},"Series 5":{"id":"1176","type":"MultiLine"},"Series 6":{"id":"1180","type":"MultiLine"},"Series 7":{"id":"1184","type":"MultiLine"},"Series 8":{"id":"1188","type":"MultiLine"},"Series 9":{"id":"1192","type":"MultiLine"}},"sel_lines4k":{"Background":{"id":"1245","type":"MultiLine"},"Series 1":{"id":"1161","type":"MultiLine"},"Series 10":{"id":"1197","type":"MultiLine"},"Series 11":{"id":"1201","type":"MultiLine"},"Series 12":{"id":"1205","type":"MultiLine"},"Series 13":{"id":"1209","type":"MultiLine"},"Series 14":{"id":"1213","type":"MultiLine"},"Series 15":{"id":"1217","type":"MultiLine"},"Series 16":{"id":"1221","type":"MultiLine"},"Series 17":{"id":"1225","type":"MultiLine"},"Series 18":{"id":"1229","type":"MultiLine"},"Series 19":{"id":"1233","type":"MultiLine"},"Series 2":{"id":"1165","type":"MultiLine"},"Series 20":{"id":"1237","type":"MultiLine"},"Series 3":{"id":"1169","type":"MultiLine"},"Series 4":{"id":"1173","type":"MultiLine"},"Series 5":{"id":"1177","type":"MultiLine"},"Series 6":{"id":"1181","type":"MultiLine"},"Series 7":{"id":"1185","type":"MultiLine"},"Series 8":{"id":"1189","type":"MultiLine"},"Series 9":{"id":"1193","type":"MultiLine"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"svg_canvas":{"id":"1029","subtype":"Figure","type":"Plot"},"ticks_sele":{"id":"1583","type":"Toggle"}},"code":"var names = series_names\nnames.push('Background')\nfor(i_ser in names){\n    sel_lines[names[i_ser]].line_width=linew_txt.value\n    sel_lines4k[names[i_ser]].line_width=4.0*linew_txt.value\n}\n\n\n// if (labels_sele.value == 'on'){\n// \tplot_canvas.axis.axis_label_text_alpha=1\n// \tplot_canvas.axis.major_label_text_alpha=1\n// \thighres_canvas.axis.axis_label_text_alpha=1\n// \thighres_canvas.axis.major_label_text_alpha=1\n// \t// svg_canvas.axis.axis_label_text_alpha=1\n// \t// svg_canvas.axis.major_label_text_alpha=1\n// }\n// if (labels_sele.value == 'off'){\n// \tplot_canvas.axis.axis_label_text_alpha=0\n// \tplot_canvas.axis.major_label_text_alpha=0\n// \thighres_canvas.axis.axis_label_text_alpha=0\n// \thighres_canvas.axis.major_label_text_alpha=0\n// \tsvg_canvas.axis.axis_label_text_alpha=0\n// \tsvg_canvas.axis.major_label_text_alpha=0\n// }\n\n// if (labels_sele.value == 'on'){\n// \tplot_canvas.axis.axis_label_text_alpha=1\n// \tplot_canvas.axis.major_label_text_alpha=1\n// \thighres_canvas.axis.axis_label_text_alpha=1\n// \thighres_canvas.axis.major_label_text_alpha=1\n// \t// svg_canvas.axis.axis_label_text_alpha=1\n// \t// svg_canvas.axis.major_label_text_alpha=1\n// }\n// if (labels_sele.value == 'off'){\n// \tplot_canvas.axis.axis_label_text_alpha=0\n// \tplot_canvas.axis.major_label_text_alpha=0\n// \thighres_canvas.axis.axis_label_text_alpha=0\n// \thighres_canvas.axis.major_label_text_alpha=0\n// \t// svg_canvas.axis.axis_label_text_alpha=0\n// \t// svg_canvas.axis.major_label_text_alpha=0\n// }"},"id":"1644","type":"CustomJS"},{"attributes":{"args":{"DataProcessingParameters":{"id":"1158","type":"AjaxDataSource"},"SU_act":{"id":"1511","type":"AjaxDataSource"},"aser_data":{"id":"1153","type":"AjaxDataSource"},"bg_mz":{"id":"1157","type":"AjaxDataSource"},"col":{"id":"1254","type":"ColorPicker"},"comment_window":{"id":"1537","type":"TextAreaInput"},"cropping_slider":{"id":"1553","type":"RangeSlider"},"gaussian_smooth":{"id":"1554","type":"Slider"},"intensity_threshold":{"id":"1556","type":"Slider"},"n_smooth":{"id":"1555","type":"Slider"},"peak_lines":{"Background":{"id":"1242","type":"MultiLine"},"Series 1":{"id":"1162","type":"MultiLine"},"Series 10":{"id":"1198","type":"MultiLine"},"Series 11":{"id":"1202","type":"MultiLine"},"Series 12":{"id":"1206","type":"MultiLine"},"Series 13":{"id":"1210","type":"MultiLine"},"Series 14":{"id":"1214","type":"MultiLine"},"Series 15":{"id":"1218","type":"MultiLine"},"Series 16":{"id":"1222","type":"MultiLine"},"Series 17":{"id":"1226","type":"MultiLine"},"Series 18":{"id":"1230","type":"MultiLine"},"Series 19":{"id":"1234","type":"MultiLine"},"Series 2":{"id":"1166","type":"MultiLine"},"Series 20":{"id":"1238","type":"MultiLine"},"Series 3":{"id":"1170","type":"MultiLine"},"Series 4":{"id":"1174","type":"MultiLine"},"Series 5":{"id":"1178","type":"MultiLine"},"Series 6":{"id":"1182","type":"MultiLine"},"Series 7":{"id":"1186","type":"MultiLine"},"Series 8":{"id":"1190","type":"MultiLine"},"Series 9":{"id":"1194","type":"MultiLine"}},"peak_lines4k":{"Background":{"id":"1243","type":"MultiLine"},"Series 1":{"id":"1163","type":"MultiLine"},"Series 10":{"id":"1199","type":"MultiLine"},"Series 11":{"id":"1203","type":"MultiLine"},"Series 12":{"id":"1207","type":"MultiLine"},"Series 13":{"id":"1211","type":"MultiLine"},"Series 14":{"id":"1215","type":"MultiLine"},"Series 15":{"id":"1219","type":"MultiLine"},"Series 16":{"id":"1223","type":"MultiLine"},"Series 17":{"id":"1227","type":"MultiLine"},"Series 18":{"id":"1231","type":"MultiLine"},"Series 19":{"id":"1235","type":"MultiLine"},"Series 2":{"id":"1167","type":"MultiLine"},"Series 20":{"id":"1239","type":"MultiLine"},"Series 3":{"id":"1171","type":"MultiLine"},"Series 4":{"id":"1175","type":"MultiLine"},"Series 5":{"id":"1179","type":"MultiLine"},"Series 6":{"id":"1183","type":"MultiLine"},"Series 7":{"id":"1187","type":"MultiLine"},"Series 8":{"id":"1191","type":"MultiLine"},"Series 9":{"id":"1195","type":"MultiLine"}},"peak_mz":{"Series 1":{"id":"1075","type":"AjaxDataSource"},"Series 10":{"id":"1111","type":"AjaxDataSource"},"Series 11":{"id":"1115","type":"AjaxDataSource"},"Series 12":{"id":"1119","type":"AjaxDataSource"},"Series 13":{"id":"1123","type":"AjaxDataSource"},"Series 14":{"id":"1127","type":"AjaxDataSource"},"Series 15":{"id":"1131","type":"AjaxDataSource"},"Series 16":{"id":"1135","type":"AjaxDataSource"},"Series 17":{"id":"1139","type":"AjaxDataSource"},"Series 18":{"id":"1143","type":"AjaxDataSource"},"Series 19":{"id":"1147","type":"AjaxDataSource"},"Series 2":{"id":"1079","type":"AjaxDataSource"},"Series 20":{"id":"1151","type":"AjaxDataSource"},"Series 3":{"id":"1083","type":"AjaxDataSource"},"Series 4":{"id":"1087","type":"AjaxDataSource"},"Series 5":{"id":"1091","type":"AjaxDataSource"},"Series 6":{"id":"1095","type":"AjaxDataSource"},"Series 7":{"id":"1099","type":"AjaxDataSource"},"Series 8":{"id":"1103","type":"AjaxDataSource"},"Series 9":{"id":"1107","type":"AjaxDataSource"}},"plot_canvas":{"id":"1001","subtype":"Figure","type":"Plot"},"posneg":{"id":"1257","type":"Select"},"pp_mean_data":{"id":"1246","type":"AjaxDataSource"},"pp_std_data":{"id":"1247","type":"AjaxDataSource"},"proc_mz":{"id":"1156","type":"AjaxDataSource"},"process_data":{"id":"1567","type":"Button"},"raw_mz":{"id":"1155","type":"AjaxDataSource"},"sel_lines":{"Background":{"id":"1244","type":"MultiLine"},"Series 1":{"id":"1160","type":"MultiLine"},"Series 10":{"id":"1196","type":"MultiLine"},"Series 11":{"id":"1200","type":"MultiLine"},"Series 12":{"id":"1204","type":"MultiLine"},"Series 13":{"id":"1208","type":"MultiLine"},"Series 14":{"id":"1212","type":"MultiLine"},"Series 15":{"id":"1216","type":"MultiLine"},"Series 16":{"id":"1220","type":"MultiLine"},"Series 17":{"id":"1224","type":"MultiLine"},"Series 18":{"id":"1228","type":"MultiLine"},"Series 19":{"id":"1232","type":"MultiLine"},"Series 2":{"id":"1164","type":"MultiLine"},"Series 20":{"id":"1236","type":"MultiLine"},"Series 3":{"id":"1168","type":"MultiLine"},"Series 4":{"id":"1172","type":"MultiLine"},"Series 5":{"id":"1176","type":"MultiLine"},"Series 6":{"id":"1180","type":"MultiLine"},"Series 7":{"id":"1184","type":"MultiLine"},"Series 8":{"id":"1188","type":"MultiLine"},"Series 9":{"id":"1192","type":"MultiLine"}},"sel_lines4k":{"Background":{"id":"1245","type":"MultiLine"},"Series 1":{"id":"1161","type":"MultiLine"},"Series 10":{"id":"1197","type":"MultiLine"},"Series 11":{"id":"1201","type":"MultiLine"},"Series 12":{"id":"1205","type":"MultiLine"},"Series 13":{"id":"1209","type":"MultiLine"},"Series 14":{"id":"1213","type":"MultiLine"},"Series 15":{"id":"1217","type":"MultiLine"},"Series 16":{"id":"1221","type":"MultiLine"},"Series 17":{"id":"1225","type":"MultiLine"},"Series 18":{"id":"1229","type":"MultiLine"},"Series 19":{"id":"1233","type":"MultiLine"},"Series 2":{"id":"1165","type":"MultiLine"},"Series 20":{"id":"1237","type":"MultiLine"},"Series 3":{"id":"1169","type":"MultiLine"},"Series 4":{"id":"1173","type":"MultiLine"},"Series 5":{"id":"1177","type":"MultiLine"},"Series 6":{"id":"1181","type":"MultiLine"},"Series 7":{"id":"1185","type":"MultiLine"},"Series 8":{"id":"1189","type":"MultiLine"},"Series 9":{"id":"1193","type":"MultiLine"}},"ser_act":{"id":"1252","type":"Select"},"ser_match":{"id":"1255","type":"Select"},"series_colours_DS":{"id":"1159","type":"AjaxDataSource"},"series_data":{"Series 1":{"id":"1072","type":"AjaxDataSource"},"Series 10":{"id":"1108","type":"AjaxDataSource"},"Series 11":{"id":"1112","type":"AjaxDataSource"},"Series 12":{"id":"1116","type":"AjaxDataSource"},"Series 13":{"id":"1120","type":"AjaxDataSource"},"Series 14":{"id":"1124","type":"AjaxDataSource"},"Series 15":{"id":"1128","type":"AjaxDataSource"},"Series 16":{"id":"1132","type":"AjaxDataSource"},"Series 17":{"id":"1136","type":"AjaxDataSource"},"Series 18":{"id":"1140","type":"AjaxDataSource"},"Series 19":{"id":"1144","type":"AjaxDataSource"},"Series 2":{"id":"1076","type":"AjaxDataSource"},"Series 20":{"id":"1148","type":"AjaxDataSource"},"Series 3":{"id":"1080","type":"AjaxDataSource"},"Series 4":{"id":"1084","type":"AjaxDataSource"},"Series 5":{"id":"1088","type":"AjaxDataSource"},"Series 6":{"id":"1092","type":"AjaxDataSource"},"Series 7":{"id":"1096","type":"AjaxDataSource"},"Series 8":{"id":"1100","type":"AjaxDataSource"},"Series 9":{"id":"1104","type":"AjaxDataSource"}},"series_dict":{"id":"1154","type":"AjaxDataSource"},"series_masses":{"id":"1152","type":"AjaxDataSource"},"series_mz":{"Series 1":{"id":"1074","type":"AjaxDataSource"},"Series 10":{"id":"1110","type":"AjaxDataSource"},"Series 11":{"id":"1114","type":"AjaxDataSource"},"Series 12":{"id":"1118","type":"AjaxDataSource"},"Series 13":{"id":"1122","type":"AjaxDataSource"},"Series 14":{"id":"1126","type":"AjaxDataSource"},"Series 15":{"id":"1130","type":"AjaxDataSource"},"Series 16":{"id":"1134","type":"AjaxDataSource"},"Series 17":{"id":"1138","type":"AjaxDataSource"},"Series 18":{"id":"1142","type":"AjaxDataSource"},"Series 19":{"id":"1146","type":"AjaxDataSource"},"Series 2":{"id":"1078","type":"AjaxDataSource"},"Series 20":{"id":"1150","type":"AjaxDataSource"},"Series 3":{"id":"1082","type":"AjaxDataSource"},"Series 4":{"id":"1086","type":"AjaxDataSource"},"Series 5":{"id":"1090","type":"AjaxDataSource"},"Series 6":{"id":"1094","type":"AjaxDataSource"},"Series 7":{"id":"1098","type":"AjaxDataSource"},"Series 8":{"id":"1102","type":"AjaxDataSource"},"Series 9":{"id":"1106","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1073","type":"AjaxDataSource"},"Series 10":{"id":"1109","type":"AjaxDataSource"},"Series 11":{"id":"1113","type":"AjaxDataSource"},"Series 12":{"id":"1117","type":"AjaxDataSource"},"Series 13":{"id":"1121","type":"AjaxDataSource"},"Series 14":{"id":"1125","type":"AjaxDataSource"},"Series 15":{"id":"1129","type":"AjaxDataSource"},"Series 16":{"id":"1133","type":"AjaxDataSource"},"Series 17":{"id":"1137","type":"AjaxDataSource"},"Series 18":{"id":"1141","type":"AjaxDataSource"},"Series 19":{"id":"1145","type":"AjaxDataSource"},"Series 2":{"id":"1077","type":"AjaxDataSource"},"Series 20":{"id":"1149","type":"AjaxDataSource"},"Series 3":{"id":"1081","type":"AjaxDataSource"},"Series 4":{"id":"1085","type":"AjaxDataSource"},"Series 5":{"id":"1089","type":"AjaxDataSource"},"Series 6":{"id":"1093","type":"AjaxDataSource"},"Series 7":{"id":"1097","type":"AjaxDataSource"},"Series 8":{"id":"1101","type":"AjaxDataSource"},"Series 9":{"id":"1105","type":"AjaxDataSource"}},"stoich":{"id":"1538","type":"AjaxDataSource"},"sub_name":{"id":"1562","type":"Select"},"substract":{"id":"1557","type":"Slider"}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max, posneg){\n    sign = 1.0\n    if (posneg.value == \"Negative\"){\n        sign = -1.0\n    }\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h*sign)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data, series_mz){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        console.log(\"There are selections\")\n        bg_mz.data=backg_mz;\n    }\n    if (low_inds.length == 0) {\n        console.log(\"In BG mode\")\n        mz=[]\n        Intensity=[]\n        len_data=data['mz'].length\n        console.log(len_data)\n        for(i=0; i&lt;len_data; i++){\n            mz.push(data['mz'][i])\n            Intensity.push(data['Intensity'][i])\n        }\n        new_bg = {'mz': [mz], 'Intensity': [Intensity]}\n        bg_mz.data = new_bg\n\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_peak_lines(ser_data,peak_data, names){\n    for(i_ser in names){\n        if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n            peak_xy={'xs':[], 'ys':[]}\n            for(i_peak=0; i_peak &lt; ser_data[names[i_ser]]['x_low'].length; i_peak++){\n                peak_xy['xs'].push()\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n            }\n        }\n        series_sele[names[i_ser]].change.emit()\n    }\n    return;\n\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n        peak_data[act]['xs'].push([data['mz'][i_max], data['mz'][i_max]])\n        peak_data[act]['ys'].push([0.0, data[\"Intensity\"][i_max]])\n        console.log(act + ' ' + peak_data[act]['xs']+ ' ' + peak_data[act]['ys'])\n\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses, posneg){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'], posneg)\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                // masses[\"Old_Mass\"].push(MacSED_res[1][i])\n                // masses[\"Old_Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                // masses[\"Old_Mass\"][i] = MacSED_res[1][i]\n                // masses[\"Old_Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/*Finding indices for mz values (the martial name refers to a Linear Algebra lecture of Prof Valentin Blomer the program author \nattended as a first year studentat the University of Goettingen. The same Prof Blomer also told his students in the same lecture\nseries not to implement a BubbleSort algorithm which the author remembered and promptly implemented because of the short lists to \nsort. )*/\nfunction indexkrieg(data, sele, ser_data, names, peak_mz){\n    console.log('Indexkrieg eingeleitet.')\n    for(i_ser in names){\n        peak_xy={'xs':[], 'ys':[]}\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n                // Now correct intensity bc of smooothing etc\n                ser_data[names[i_ser]]['max_int'][i_peak]=data['Intensity'][sele[names[i_ser]]['i_max'][i_peak]];\n                peak_xy['xs'].push([ser_data[names[i_ser]]['x_max'][i_peak],ser_data[names[i_ser]]['x_max'][i_peak]])\n                peak_xy['ys'].push([0.0,ser_data[names[i_ser]]['max_int'][i_peak]])\n            }\n        }\n        peak_mz[names[i_ser]].data=peak_xy\n        series_sele[names[i_ser]].change.emit()\n        series_data[names[i_ser]].change.emit()\n    }\n    return;\n}\n\nfunction cropping_data(data, cropping_min, cropping_max, sele, ser_data, names){\n    i_min=closest(data['mz'],cropping_min)\n    i_max=closest(data['mz'],cropping_max)\n    len_data=data['mz'].length\n    console.log(i_min + ' ' + i_max)\n    // data['mz'].slice(i_min,i_max)\n    // data['Intensity'].slice(i_min,i_max)\n    // data['mz'].splice(0,cropping_min)\n    // data['Intensity'].splice(0,cropping_min)\n    mz=data['mz'].slice(i_min,i_max)\n    Intensity=data['Intensity'].slice(i_min,i_max)\n    new_data={'mz':mz, 'Intensity':Intensity}\n    return new_data\n}\n\nfunction gaussian_filter(data, sigma){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    var len_y=array_y.length\n    console.log('in gaussian')\n    min_dist=10\n    for(i=0; i&lt;array_x.length-2; i++){\n        dist=array_x[i+1]-array_x[i]\n        if(dist &lt; min_dist){\n            min_dist=dist\n        }\n    }\n    sigma2div2=0.5*sigma*sigma\n    var smooth_array=array_y\n    var trunc=Math.ceil(4*sigma/min_dist)    \n    for(i=0; i &lt; len_y; i++){\n        weights= new Array(2*trunc)\n        if((i&gt;trunc) &amp;&amp;  (i &lt; (len_y-1-trunc))){\n            arr_ind=0\n            sum_arr=0.0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            new_val=0.0\n            arr_ind=0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n    \n        if (i&lt;trunc){\n            new_val=0.0\n            arr_ind=0\n            sum_arr=0.0\n\n            for(j=0; j &lt;=i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                x=array_x[j] + array_x[i] - array_x[0] - array_x[0]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            arr_ind=0\n            for(j=0; j &lt;=i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n\n        if (i&gt;len_y-1-trunc){\n            arr_ind=0\n            sum_arr=0.0\n            new_val=0.0\n            for(j=i-trunc; j &lt; len_y; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n\n            }\n            var last_x2= 2*array_x[len_y-1] /// Multiply klast entry of array_x to get end point\n            for(j=len_y-1; j &gt; len_y -trunc; j--){\n                x= last_x2  - array_x[j] - array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n\n            arr_ind=0\n            for(j=i-trunc; j &lt;len_y; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            for(j=len_y-1; j &gt;len_y-trunc; j--){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n\n        smooth_array[i]=new_val\n        }\n        smooth_array[trunc]=0.5*(smooth_array[trunc+1]+smooth_array[trunc-1])\n        smooth_array[array_y.length-1-trunc]=0.5*(smooth_array[array_y.length-trunc]+smooth_array[array_y.length-trunc-2])\n        }\n        returndata={'mz':array_x, 'Intensity':smooth_array}\n    return returndata;\n}\n\nfunction smoothing(data, sigma, n){\n\n    if (sigma !=0.0){\n    n_gau=parseInt(n)\n    console.log('Applying Gaussian Filter of sigma=' + sigma + ' for ' + n_gau + ' times.')\n    for(i=0; i &lt; n_gau; i++){\n        data=gaussian_filter(data, sigma)\n        console.log('Gaussian Filter successful for ' + i + ' times.')\n\n    }\n    }\n    return data\n    console.log('Smoothing complete')\n}\n\nfunction baseline_substraction(data, substraction_mode, substraction_value){\n    console.log('Performing baseline substraction')\n    var array_x=data['mz']\n    var array_y=data['Intensity'] \n\n    if (substraction_mode == 'Substract Minimum' &amp;&amp; substraction_value &gt; 0.0){\n    console.log('Mode: ' + substraction_mode)\n    y_min = array_y[closest(array_y, 0.0)]\n    console.log('Minimum: ' + y_min + ' %.')\n    for(var i=0; i&lt; array_y.length; i++){\n        array_y[i]-=y_min\n    }\n    }\n\n    if (substraction_mode == 'Substract Line' &amp;&amp; substraction_value &gt; 0.0){\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        console.log(n_points)\n        var frontpart=0.0\n        var backpart =0.0\n        for(var i=0; i&lt; n_points; i++){\n            frontpart+=array_y[i]\n            backpart +=array_y[array_y.length-1-i]\n            console.log(frontpart + ' ' + backpart)\n\n        }\n        frontpart = frontpart / n_points\n        backpart  =  backpart / n_points\n        slope = (backpart - frontpart)/ (array_x[array_x.length-1] - array_x[0])\n\n        console.log(frontpart + ' ' + backpart + ' ' + slope)\n\n        for(var i=0; i &lt; array_y.length; i++){\n            array_y[i]-=slope * (array_x[i] - array_x[0]) + frontpart\n        }\n\n    }\n\n    if (substraction_mode == 'Substract Curved' &amp;&amp; substraction_value &gt; 0.0){\n\n        /* \n        Taken from Massign Paper (and UniDEC)\n        First creates an array that matches the data but has the minimum value within a window of +/- buff.\n        Then, smooths the minimum array with a Gaussian filter of width buff * 2 to form the background array.\n        Finally, subtracts the background array from the data intensities.\n        :param datatop: Data array\n        :param buff: Width parameter\n        :return: Subtracted data\n        \"\"\"\n        length = len(datatop)\n        mins = list(range(0, length))\n        indexes = list(range(0, length))\n        for i in indexes:\n            mins[i] = np.amin(datatop[int(max([0, i - abs(buff)])):int(min([i + abs(buff), length])), 1])\n        background = filt.gaussian_filter(mins, abs(buff) * 2)\n        datatop[:, 1] = datatop[:, 1] - background\n        return datatop\n        */\n\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        var len_y=array_y.length\n        var mins= []\n        for(i=0; i &lt; len_y; i++){\n            low_ind=Math.max(0, i-n_points)\n            upp_ind=Math.min(len_y, i+n_points)\n            deduct_min=100.0\n            for (j=low_ind; j&lt; upp_ind; j++){\n                if(deduct_min &gt; array_y[j]){\n                    deduct_min=array_y[j]\n                }\n            }\n            // console.log(low_ind + ' ' + upp_ind + ' ' + deduct_min)\n            mins.push(deduct_min)\n        }\n        console.log('Array of minima created.')\n        temp_data={'mz':array_x, 'Intensity':mins}\n        temp_data=gaussian_filter(temp_data,2.0*substraction_value, 1)\n        mins=temp_data['Intensity']\n        console.log('Array of minima smoothened.')\n        for(var i=0; i&lt; len_y; i++){\n            array_y[i]-=mins[i]\n        }\n        console.log('Mimima from data deducted.')\n\n    }\n\n\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Baseline substraction complete.\")\n}\n\nfunction normalising_and_thresholding(data,intensity_threshold, sele){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    ///Normailisation\n    y_max = array_y[closest(array_y, 1000.0)]\n    var mult = 100.0/y_max\n    for (i=0; i&lt; array_y.length; i++){\n        array_y[i]=array_y[i]*mult\n    }\n    console.log('Normalisation complete')\n    ///Thresholding\n    console.log('Thresholding value: ' + intensity_threshold + ' %.')    \n    for (var i = array_y.length - 1; i &gt;= 0; i--) {\n        if (array_y[i] &lt; intensity_threshold) {\n            array_y[i] = 0.0   \n        }    \n    }\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Thresholding complete.\")\n}\n\nfunction data_processing(data, dtp, sele, ser_data, names, peak_mz){\n    var crop_dat=cropping_data(data, dtp['mz_low'][0], dtp['mz_upp'][0], sele, ser_data, names)\n    var nat_data=normalising_and_thresholding(crop_dat,dtp['intensity_threshold'][0])\n    var bld_data=baseline_substraction(nat_data, dtp['sub_mode'][0], dtp['sub_value'][0])\n    var smo_data=smoothing(bld_data, dtp['gau_sigma'][0],dtp['gau_rep'][0])\n    var final_data=normalising_and_thresholding(smo_data,0.0) // Renormailising\n    indexkrieg(final_data, sele, ser_data, names, peak_mz)\n    return final_data\n}\n\n\n\n\n\n\n\n\nvar act =cb_obj.value;\nconsole.log(act)\nif(act== \"load_file\"){\n    var input = document.createElement('input');\n    input.type = 'file';\n    input.onchange = e =&gt; {\n\n   \n    // getting a hold of the file reference\n    var file = e.target.files[0];\n\n    // setting up the reader\n    var reader = new FileReader();\n    reader.readAsText(file,'UTF-8');\n\n    // here we tell the reader what to do when it's done reading...\n    reader.onload = readerEvent =&gt; {\n        var new_data = {'mz': [], 'Intensity': []}\n        for (i in series_names){\n            series_data[series_names[i]].data = {'x_low':[], 'x_upp':[],  'x_max':[],'max_int':[], 'charge':[]}\n            series_sele[series_names[i]].data = {'i_low':[], 'i_upp':[], 'i_max':[]}\n            series_mz[series_names[i]].data  = {'Intensity':[], 'mz':[]}\n        }\n        series_masses.data = {'Series':[], 'Mass':[], 'Uncertainty':[]}\n\n        aser_data.data = {'x_low':[], 'x_upp':[],  'x_max':[], 'max_int':[], 'charge':[]}\n\n        var content = readerEvent.target.result; // this is the content!\n        console.log( 'content created.' );\n\n        var lines = content.split('\\n')\n\n        for(i=10; i &lt; lines.length-10; i++){\n            line = lines[i].split('\\t')\n            new_data['mz'].push(parseFloat(line[0]))\n            new_data['Intensity'].push(parseFloat(line[1]))\n        }\n        console.log('Lines split.');\n          /// Find maximum and normalise data\n        max_int=0.0\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            if(new_data['Intensity'][i] &gt; max_int){\n                max_int = new_data['Intensity'][i];\n            }\n        }\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            new_data['Intensity'][i] = 100 * new_data['Intensity'][i] / max_int;\n        }\n        console.log('Intensity calculated and normalised.');\n\n        cropping_slider.value[0]  = new_data['mz'][0]\n        cropping_slider.value[1]  = new_data['mz'][new_data['mz'].length-1]\n        cropping_slider.start     = new_data['mz'][0]\n        cropping_slider.end       = new_data['mz'][new_data['mz'].length-1]\n        DataProcessingParameters.data['mz_low'][0] = new_data['mz'][0]\n        DataProcessingParameters.data['mz_upp'][0] = new_data['mz'][new_data['mz'].length-1]\n        cropping_slider.change.emit()\n\n        raw_mz.data=new_data\n        proc_mz.data=new_data\n        new_bg = {'mz': [new_data['mz']], 'Intensity': [new_data['Intensity']]}\n        bg_mz.data = new_bg\n        }\n        console.log('All done.');\n    }\n    console.log('Almost there.');\n    input.click();\n}\n\nif(act== \"load_clip\"){\n    var ms = prompt(\"Paste spectrum here\", \"\");\n    if (ms != null) {\n        var new_data = {'mz': [], 'Intensity': []}\n        for (i in series_names){\n            series_data[series_names[i]].data = {'x_low':[], 'x_upp':[],  'x_max':[],'max_int':[], 'charge':[]}\n            series_sele[series_names[i]].data = {'i_low':[], 'i_upp':[], 'i_max':[]}\n            series_mz[series_names[i]].data  = {'Intensity':[], 'mz':[]}\n        }\n\n        series_masses.data = {'Series':[], 'Mass':[], 'Uncertainty':[]}\n\n        aser_data.data = {'x_low':[], 'x_upp':[],  'x_max':[], 'max_int':[], 'charge':[]}\n        var lines = ms.split('\\n')\n        for(i=10; i &lt; lines.length-10; i++){\n            line = lines[i].split('\\t')\n            new_data['mz'].push(parseFloat(line[0]))\n            new_data['Intensity'].push(parseFloat(line[1]))\n        }\n      \n        /// Find maximum and normalise data\n        max_int=0.0\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            if(new_data['Intensity'][i] &gt; max_int){\n                max_int = new_data['Intensity'][i];\n            }\n        }\n        for(i=0; i &lt; new_data['Intensity'].length; i++){\n            new_data['Intensity'][i] = 100 * new_data['Intensity'][i] / max_int;\n        }\n        cropping_slider.value[0]  = new_data['mz'][0]\n        DataProcessingParameters.data['mz_low'][0] = new_data['mz'][0]\n        DataProcessingParameters.data['mz_upp'][0] = new_data['mz'][new_data['mz'].length-1]\n        cropping_slider.value[1]  = new_data['mz'][new_data['mz'].length-1]\n        cropping_slider.start     = new_data['mz'][0]\n        cropping_slider.end       = new_data['mz'][new_data['mz'].length-1]\n        cropping_slider.change.emit()\n        raw_mz.data=new_data\n        new_bg = {'mz': [new_data['mz']], 'Intensity': [new_data['Intensity']]}\n        bg_mz.data = new_bg\n    }\n\n}\n\n\n/* What is saved in a session: \n\nraw_mz, series_dict, series_data, series_sele, \nseries_cols, posneg, SU_act, stoich, cropping_slider, gaussian_smooth, \nn_smooth, intensity_threshold, sub_name, substract, \n\n\nvar peak_data={};\n\nvar sele = {};\nvar ser_data={};\nvar masses = series_masses.data;\n\nvar names = series_names;\n\n/// remember i in x gives ith element\nfor(i_ser in names){\n    sele[names[i_ser]]=series_sele[names[i_ser]].data;\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    peak_data[names[i_ser]]=peak_mz[names[i_ser]].data;\n}\n\n\n*/\nif (act == 'save_sess'){\n    var raw_data =raw_mz.data;\n    // var proc_data =proc_mz.data;\n    var dtp        = DataProcessingParameters.data\n    var ser_dict = series_dict.data\n    var ser_cols = series_colours_DS.data\n    var stoichiometry = stoich.data\n    var subunits= SU_act.data\n    var charge_sign= posneg.value\n    var comment = comment_window.value\n    var masses = series_masses.data;\n    var peak_data={};\n\n    // var sele = {};\n    var ser_data={};\n    var sele={}\n    var names = series_names;\n\n    /// remember i in x gives ith element\n    for(i_ser in names){\n        sele[names[i_ser]]=series_sele[names[i_ser]].data;\n        ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    }\n\n    // let save_json = {data, }\n    let save_json = { raw_data, ser_dict, masses, sele, ser_data, ser_cols, charge_sign, subunits, stoichiometry, dtp, comment }\n\n    var jsonData = JSON.stringify(save_json);\n    function download(content, fileName, contentType) {\n        var a = document.createElement(\"a\");\n        var file = new Blob([content], {type: contentType});\n        a.href = URL.createObjectURL(file);\n        a.download = fileName;\n        a.click();\n    }\n    download(jsonData, 'session.navia', 'navia');\n}\n\nif (act == 'load_sess'){\n    var input = document.createElement('input');\n        input.type = 'file';\n        input.onchange = e =&gt; {\n\n        // getting a hold of the file reference\n        var file = e.target.files[0];\n\n        // setting up the reader\n        var reader = new FileReader();\n        reader.readAsText(file,'UTF-8');\n\n        // here we tell the reader what to do when it's done reading...\n        reader.onload = readerEvent =&gt; {\n            var content = readerEvent.target.result; // this is the content!\n            /// Line below is short for look in content for key data and put into left data (professional name object destructuring)\n            const { raw_data, ser_dict, masses, sele, ser_data, peak_data, ser_cols, charge_sign, subunits, stoichiometry, dtp, comment } = JSON.parse(content)\n            raw_mz.data = raw_data\n            DataProcessingParameters.data = dtp\n            series_dict.data = ser_dict\n            series_colours_DS.data = ser_cols\n            stoich.data = stoichiometry\n            SU_act.data = subunits\n            posneg.value = charge_sign\n            comment_window.value = comment\n            series_masses.data = masses;\n\n            names = series_names;\n            ser_act.options=['Background', 'New Series']\n            /// remember i in x gives ith element\n            for(i in ser_cols['series']){\n                sel_lines[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n                sel_lines4k[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n                peak_lines[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n                peak_lines4k[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n            }\n\n            for(i_ser in names){\n                series_data[names[i_ser]].data = ser_data[names[i_ser]];\n                series_sele[names[i_ser]].data = sele[names[i_ser]];\n                if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n                    ser_act.options.splice(ser_act.options.length-1,1)\n                    i = ser_act.options.length\n                    ser_act.options.push(\"Series \" + i)\n                    ser_act.options.push(\"New Series\")\n                    ser_act.value=\"Series \" + i\n                    ser_match.options.push(\"Series \" + i)\n                    ser_match.value=\"Series \" + i\n                    act=\"Series \" + i\n                }\n            }\n            proc_mz.data=data_processing(raw_data, DataProcessingParameters.data, sele, ser_data, names, peak_mz)\n            cropping_slider.value[0]  = dtp['mz_low'][0]\n            cropping_slider.value[1]  = dtp['mz_upp'][0]\n            gaussian_smooth.value     = dtp['gau_sigma'][0]\n            n_smooth.value            = dtp['gau_rep'][0]\n            intensity_threshold.value = dtp['intensity_threshold'][0]\n            sub_name.value            = dtp['sub_mode'][0]\n            substract.value           = dtp['sub_value'][0]\n            \n\n            process_data.button_type='warning'\n            process_data.label='Reprocess Data'\n            data2sources(names, sele, proc_mz.data, series_mz);\n            peakprediction(masses,ser_data, act);\n            data2active_table(ser_data[act], aser_data, act);\n        }\n    }\n    input.click();\n}\n\n/// Save sessions regurlarly\n/*\nwindow.setInteval(function(){\n    let save_json = {  data, }\n    var jsonData = JSON.stringify(data);\n    try {\n        window.localStorage.setItem(\"curr_sess\", jsonData)\n    }},1000)\n*/"},"id":"1645","type":"CustomJS"},{"attributes":{"source":{"id":"1146","type":"AjaxDataSource"}},"id":"1454","type":"CDSView"},{"attributes":{},"id":"1865","type":"Selection"},{"attributes":{"data_source":{"id":"1147","type":"AjaxDataSource"},"glyph":{"id":"1234","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1456","type":"CDSView"},"visible":false},"id":"1455","type":"GlyphRenderer"},{"attributes":{"height":30,"width":23},"id":"1647","type":"Spacer"},{"attributes":{},"id":"1866","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1647","type":"Spacer"},{"id":"1646","type":"Dropdown"},{"id":"1252","type":"Select"},{"id":"1254","type":"ColorPicker"},{"id":"1248","type":"Toggle"},{"id":"1259","type":"Toggle"},{"id":"1260","type":"Toggle"},{"id":"1258","type":"Toggle"},{"id":"1261","type":"Toggle"},{"id":"1249","type":"Toggle"}]},"id":"1648","type":"Row"},{"attributes":{"source":{"id":"1147","type":"AjaxDataSource"}},"id":"1456","type":"CDSView"},{"attributes":{},"id":"1867","type":"Selection"},{"attributes":{"data_source":{"id":"1147","type":"AjaxDataSource"},"glyph":{"id":"1235","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1458","type":"CDSView"},"visible":false},"id":"1457","type":"GlyphRenderer"},{"attributes":{"children":[{"id":"1620","type":"Column"},{"id":"1642","type":"Column"}]},"id":"1649","type":"Column"},{"attributes":{},"id":"1868","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1001","subtype":"Figure","type":"Plot"},{"id":"1649","type":"Column"}],"height":768},"id":"1650","type":"Row"},{"attributes":{"source":{"id":"1147","type":"AjaxDataSource"}},"id":"1458","type":"CDSView"},{"attributes":{},"id":"1869","type":"Selection"},{"attributes":{"children":[{"id":"1500","type":"DataTable"},{"id":"1509","type":"DataTable"},{"id":"1537","type":"TextAreaInput"}]},"id":"1651","type":"Row"},{"attributes":{"args":{"other":{"id":"1455","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1459","type":"CustomJS"},{"attributes":{},"id":"1870","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1457","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1460","type":"CustomJS"},{"attributes":{"children":[{"id":"1534","type":"Button"},{"id":"1535","type":"Button"},{"id":"1548","type":"Dropdown"},{"id":"1255","type":"Select"},{"id":"1539","type":"TextInput"},{"id":"1552","type":"Button"}]},"id":"1652","type":"Row"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1871","type":"BoxAnnotation"},{"attributes":{"data_source":{"id":"1150","type":"AjaxDataSource"},"glyph":{"id":"1236","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1462","type":"CDSView"}},"id":"1461","type":"GlyphRenderer"},{"attributes":{"children":[{"id":"1536","type":"Spacer"},{"id":"1652","type":"Row"}]},"id":"1653","type":"Column"},{"attributes":{"bottom_units":"screen","fill_alpha":{"value":0.5},"fill_color":{"value":"lightgrey"},"left_units":"screen","level":"overlay","line_alpha":{"value":1.0},"line_color":{"value":"black"},"line_dash":[4,4],"line_width":{"value":2},"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1872","type":"BoxAnnotation"},{"attributes":{"children":[{"id":"1527","type":"TextInput"},{"id":"1528","type":"TextInput"},{"id":"1529","type":"TextInput"},{"id":"1530","type":"TextInput"},{"id":"1531","type":"TextInput"},{"id":"1653","type":"Column"}]},"id":"1654","type":"Row"},{"attributes":{"source":{"id":"1150","type":"AjaxDataSource"}},"id":"1462","type":"CDSView"},{"attributes":{},"id":"1873","type":"StringFormatter"},{"attributes":{"data_source":{"id":"1150","type":"AjaxDataSource"},"glyph":{"id":"1237","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1464","type":"CDSView"}},"id":"1463","type":"GlyphRenderer"},{"attributes":{"children":[{"id":"1525","type":"DataTable"},{"id":"1549","type":"DataTable"}]},"id":"1655","type":"Row"},{"attributes":{},"id":"1874","type":"StringEditor"},{"attributes":{"children":[{"id":"1654","type":"Row"},{"id":"1655","type":"Row"}],"visible":false},"id":"1656","type":"Column"},{"attributes":{"source":{"id":"1150","type":"AjaxDataSource"}},"id":"1464","type":"CDSView"},{"attributes":{},"id":"1875","type":"StringEditor"},{"attributes":{"data_source":{"id":"1151","type":"AjaxDataSource"},"glyph":{"id":"1238","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1466","type":"CDSView"},"visible":false},"id":"1465","type":"GlyphRenderer"},{"attributes":{"children":[{"id":"1648","type":"Row"},{"id":"1650","type":"Row"},{"id":"1651","type":"Row"},{"id":"1656","type":"Column"}]},"id":"1657","type":"Column"},{"attributes":{},"id":"1876","type":"StringEditor"},{"attributes":{"args":{"other":{"id":"1620","type":"Column"}},"code":"other.visible = this.active"},"id":"1658","type":"CustomJS"},{"attributes":{"source":{"id":"1151","type":"AjaxDataSource"}},"id":"1466","type":"CDSView"},{"attributes":{},"id":"1877","type":"StringEditor"},{"attributes":{"data_source":{"id":"1151","type":"AjaxDataSource"},"glyph":{"id":"1239","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1468","type":"CDSView"},"visible":false},"id":"1467","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1656","type":"Column"}},"code":"other.visible = this.active"},"id":"1659","type":"CustomJS"},{"attributes":{},"id":"1878","type":"StringEditor"},{"attributes":{"source":{"id":"1151","type":"AjaxDataSource"}},"id":"1468","type":"CDSView"},{"attributes":{},"id":"1879","type":"StringFormatter"},{"attributes":{"child":{"id":"1657","type":"Column"}},"id":"1660","type":"Panel"},{"attributes":{"args":{"other":{"id":"1465","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1469","type":"CustomJS"},{"attributes":{},"id":"1880","type":"StringEditor"},{"attributes":{"child":{"id":"1051","subtype":"Figure","type":"Plot"}},"id":"1661","type":"Panel"},{"attributes":{"args":{"other":{"id":"1467","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1470","type":"CustomJS"},{"attributes":{},"id":"1881","type":"StringEditor"},{"attributes":{"callback":null,"tabs":[{"id":"1660","type":"Panel"},{"id":"1661","type":"Panel"}],"tabs_location":"below"},"id":"1662","type":"Tabs"},{"attributes":{},"id":"1882","type":"StringEditor"},{"attributes":{"source":{"id":"1246","type":"AjaxDataSource"}},"id":"1472","type":"CDSView"},{"attributes":{"text":""},"id":"1884","type":"Title"},{"attributes":{"data_source":{"id":"1247","type":"AjaxDataSource"},"glyph":{"id":"1251","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1474","type":"CDSView"},"visible":false},"id":"1473","type":"GlyphRenderer"},{"attributes":{},"id":"1885","type":"BasicTickFormatter"},{"attributes":{"source":{"id":"1247","type":"AjaxDataSource"}},"id":"1474","type":"CDSView"},{"attributes":{"text":""},"id":"1664","type":"Title"},{"attributes":{},"id":"1887","type":"BasicTickFormatter"},{"attributes":{"data_source":{"id":"1126","type":"AjaxDataSource"},"glyph":{"id":"1213","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1404","type":"CDSView"}},"id":"1403","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1126","type":"AjaxDataSource"}},"id":"1404","type":"CDSView"},{"attributes":{"data_source":{"id":"1127","type":"AjaxDataSource"},"glyph":{"id":"1214","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1406","type":"CDSView"},"visible":false},"id":"1405","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1127","type":"AjaxDataSource"}},"id":"1406","type":"CDSView"},{"attributes":{"data_source":{"id":"1127","type":"AjaxDataSource"},"glyph":{"id":"1215","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1408","type":"CDSView"},"visible":false},"id":"1407","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1127","type":"AjaxDataSource"}},"id":"1408","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1405","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1409","type":"CustomJS"},{"attributes":{"args":{"other":{"id":"1407","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1410","type":"CustomJS"},{"attributes":{"data_source":{"id":"1130","type":"AjaxDataSource"},"glyph":{"id":"1216","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1412","type":"CDSView"}},"id":"1411","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1130","type":"AjaxDataSource"}},"id":"1412","type":"CDSView"},{"attributes":{"data_source":{"id":"1130","type":"AjaxDataSource"},"glyph":{"id":"1217","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1414","type":"CDSView"}},"id":"1413","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1130","type":"AjaxDataSource"}},"id":"1414","type":"CDSView"},{"attributes":{"data_source":{"id":"1131","type":"AjaxDataSource"},"glyph":{"id":"1218","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1416","type":"CDSView"},"visible":false},"id":"1415","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1131","type":"AjaxDataSource"}},"id":"1416","type":"CDSView"},{"attributes":{"data_source":{"id":"1131","type":"AjaxDataSource"},"glyph":{"id":"1219","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1418","type":"CDSView"},"visible":false},"id":"1417","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1131","type":"AjaxDataSource"}},"id":"1418","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1415","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1419","type":"CustomJS"},{"attributes":{"args":{"other":{"id":"1417","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1420","type":"CustomJS"},{"attributes":{"data_source":{"id":"1134","type":"AjaxDataSource"},"glyph":{"id":"1220","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1422","type":"CDSView"}},"id":"1421","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1134","type":"AjaxDataSource"}},"id":"1422","type":"CDSView"},{"attributes":{"data_source":{"id":"1134","type":"AjaxDataSource"},"glyph":{"id":"1221","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1424","type":"CDSView"}},"id":"1423","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1134","type":"AjaxDataSource"}},"id":"1424","type":"CDSView"},{"attributes":{"data_source":{"id":"1135","type":"AjaxDataSource"},"glyph":{"id":"1222","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1426","type":"CDSView"},"visible":false},"id":"1425","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1135","type":"AjaxDataSource"}},"id":"1426","type":"CDSView"},{"attributes":{"data_source":{"id":"1135","type":"AjaxDataSource"},"glyph":{"id":"1223","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1428","type":"CDSView"},"visible":false},"id":"1427","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1135","type":"AjaxDataSource"}},"id":"1428","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1425","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1429","type":"CustomJS"},{"attributes":{"callback":null},"id":"1002","type":"DataRange1d"},{"attributes":{"args":{"other":{"id":"1427","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1430","type":"CustomJS"},{"attributes":{"callback":null},"id":"1004","type":"DataRange1d"},{"attributes":{"data_source":{"id":"1138","type":"AjaxDataSource"},"glyph":{"id":"1224","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1432","type":"CDSView"}},"id":"1431","type":"GlyphRenderer"},{"attributes":{},"id":"1006","type":"LinearScale"},{"attributes":{"source":{"id":"1138","type":"AjaxDataSource"}},"id":"1432","type":"CDSView"},{"attributes":{},"id":"1008","type":"LinearScale"},{"attributes":{"data_source":{"id":"1138","type":"AjaxDataSource"},"glyph":{"id":"1225","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1434","type":"CDSView"}},"id":"1433","type":"GlyphRenderer"},{"attributes":{"axis_label":"m/z ","formatter":{"id":"1755","type":"BasicTickFormatter"},"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1010","type":"LinearAxis"},{"attributes":{"source":{"id":"1138","type":"AjaxDataSource"}},"id":"1434","type":"CDSView"},{"attributes":{},"id":"1011","type":"BasicTicker"},{"attributes":{"data_source":{"id":"1139","type":"AjaxDataSource"},"glyph":{"id":"1226","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1436","type":"CDSView"},"visible":false},"id":"1435","type":"GlyphRenderer"},{"attributes":{"ticker":{"id":"1011","type":"BasicTicker"}},"id":"1014","type":"Grid"},{"attributes":{"source":{"id":"1139","type":"AjaxDataSource"}},"id":"1436","type":"CDSView"},{"attributes":{"axis_label":"Rel. Abundance  [%]","formatter":{"id":"1753","type":"BasicTickFormatter"},"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1015","type":"LinearAxis"},{"attributes":{"data_source":{"id":"1139","type":"AjaxDataSource"},"glyph":{"id":"1227","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1438","type":"CDSView"},"visible":false},"id":"1437","type":"GlyphRenderer"},{"attributes":{},"id":"1016","type":"BasicTicker"},{"attributes":{"source":{"id":"1139","type":"AjaxDataSource"}},"id":"1438","type":"CDSView"},{"attributes":{"dimension":1,"ticker":{"id":"1016","type":"BasicTicker"}},"id":"1019","type":"Grid"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1841","type":"Selection"},"selection_policy":{"id":"1842","type":"UnionRenderers"}},"id":"1113","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1098","type":"AjaxDataSource"},"glyph":{"id":"1184","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1332","type":"CDSView"}},"id":"1331","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1111","type":"AjaxDataSource"},"glyph":{"id":"1199","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1368","type":"CDSView"},"visible":false},"id":"1367","type":"GlyphRenderer"},{"attributes":{},"id":"1704","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1713","type":"Selection"},"selection_policy":{"id":"1714","type":"UnionRenderers"}},"id":"1114","type":"AjaxDataSource"},{"attributes":{},"id":"1814","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1058","type":"LinearAxis"}},"code":"other.major_tick_line_alpha = this.active"},"id":"1596","type":"CustomJS"},{"attributes":{"source":{"id":"1111","type":"AjaxDataSource"}},"id":"1368","type":"CDSView"},{"attributes":{},"id":"1705","type":"Selection"},{"attributes":{"source":{"id":"1098","type":"AjaxDataSource"}},"id":"1332","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1715","type":"Selection"},"selection_policy":{"id":"1716","type":"UnionRenderers"}},"id":"1115","type":"AjaxDataSource"},{"attributes":{},"id":"1815","type":"Selection"},{"attributes":{"args":{"other":{"id":"1058","type":"LinearAxis"}},"code":"other.minor_tick_line_alpha = this.active"},"id":"1597","type":"CustomJS"},{"attributes":{"data_source":{"id":"1098","type":"AjaxDataSource"},"glyph":{"id":"1185","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1334","type":"CDSView"}},"id":"1333","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1365","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1369","type":"CustomJS"},{"attributes":{},"id":"1706","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1803","type":"Selection"},"selection_policy":{"id":"1804","type":"UnionRenderers"}},"id":"1116","type":"AjaxDataSource"},{"attributes":{"overlay":{"id":"1871","type":"BoxAnnotation"}},"id":"1020","type":"BoxZoomTool"},{"attributes":{},"id":"1816","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1063","type":"LinearAxis"}},"code":"other.axis_label_text_alpha = this.active"},"id":"1598","type":"CustomJS"},{"attributes":{"source":{"id":"1098","type":"AjaxDataSource"}},"id":"1334","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1367","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1370","type":"CustomJS"},{"attributes":{},"id":"1707","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1843","type":"Selection"},"selection_policy":{"id":"1844","type":"UnionRenderers"}},"id":"1117","type":"AjaxDataSource"},{"attributes":{},"id":"1021","type":"ResetTool"},{"attributes":{},"id":"1817","type":"Selection"},{"attributes":{"args":{"other":{"id":"1063","type":"LinearAxis"}},"code":"other.major_label_text_alpha = this.active"},"id":"1599","type":"CustomJS"},{"attributes":{"data_source":{"id":"1099","type":"AjaxDataSource"},"glyph":{"id":"1186","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1336","type":"CDSView"},"visible":false},"id":"1335","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1114","type":"AjaxDataSource"},"glyph":{"id":"1200","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1372","type":"CDSView"}},"id":"1371","type":"GlyphRenderer"},{"attributes":{},"id":"1708","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1717","type":"Selection"},"selection_policy":{"id":"1718","type":"UnionRenderers"}},"id":"1118","type":"AjaxDataSource"},{"attributes":{},"id":"1022","type":"PanTool"},{"attributes":{},"id":"1818","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1063","type":"LinearAxis"}},"code":"other.major_tick_line_alpha = this.active"},"id":"1600","type":"CustomJS"},{"attributes":{},"id":"1709","type":"Selection"},{"attributes":{"source":{"id":"1099","type":"AjaxDataSource"}},"id":"1336","type":"CDSView"},{"attributes":{"source":{"id":"1114","type":"AjaxDataSource"}},"id":"1372","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1719","type":"Selection"},"selection_policy":{"id":"1720","type":"UnionRenderers"}},"id":"1119","type":"AjaxDataSource"},{"attributes":{},"id":"1023","type":"WheelZoomTool"},{"attributes":{},"id":"1819","type":"Selection"},{"attributes":{"args":{"other":{"id":"1063","type":"LinearAxis"}},"code":"other.minor_tick_line_alpha = this.active"},"id":"1601","type":"CustomJS"},{"attributes":{"data_source":{"id":"1099","type":"AjaxDataSource"},"glyph":{"id":"1187","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1338","type":"CDSView"},"visible":false},"id":"1337","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1114","type":"AjaxDataSource"},"glyph":{"id":"1201","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1374","type":"CDSView"}},"id":"1373","type":"GlyphRenderer"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":null,"tools":[{"id":"1020","type":"BoxZoomTool"},{"id":"1021","type":"ResetTool"},{"id":"1022","type":"PanTool"},{"id":"1023","type":"WheelZoomTool"},{"id":"1483","type":"HoverTool"},{"id":"1265","type":"BoxSelectTool"},{"id":"1266","type":"TapTool"}]},"id":"1024","type":"Toolbar"},{"attributes":{},"id":"1710","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1805","type":"Selection"},"selection_policy":{"id":"1806","type":"UnionRenderers"}},"id":"1120","type":"AjaxDataSource"},{"attributes":{},"id":"1820","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1010","type":"LinearAxis"}},"code":"other.axis_line_alpha = this.active"},"id":"1602","type":"CustomJS"},{"attributes":{"source":{"id":"1099","type":"AjaxDataSource"}},"id":"1338","type":"CDSView"},{"attributes":{"source":{"id":"1114","type":"AjaxDataSource"}},"id":"1374","type":"CDSView"},{"attributes":{},"id":"1711","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1845","type":"Selection"},"selection_policy":{"id":"1846","type":"UnionRenderers"}},"id":"1121","type":"AjaxDataSource"},{"attributes":{},"id":"1821","type":"Selection"},{"attributes":{"args":{"other":{"id":"1015","type":"LinearAxis"}},"code":"other.axis_line_alpha = this.active"},"id":"1603","type":"CustomJS"},{"attributes":{"callback":null},"id":"1032","type":"DataRange1d"},{"attributes":{"args":{"other":{"id":"1335","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1339","type":"CustomJS"},{"attributes":{"data_source":{"id":"1115","type":"AjaxDataSource"},"glyph":{"id":"1202","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1376","type":"CDSView"},"visible":false},"id":"1375","type":"GlyphRenderer"},{"attributes":{},"id":"1712","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1721","type":"Selection"},"selection_policy":{"id":"1722","type":"UnionRenderers"}},"id":"1122","type":"AjaxDataSource"},{"attributes":{},"id":"1822","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1058","type":"LinearAxis"}},"code":"other.axis_line_alpha = this.active"},"id":"1604","type":"CustomJS"},{"attributes":{},"id":"1034","type":"LinearScale"},{"attributes":{"args":{"other":{"id":"1337","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1340","type":"CustomJS"},{"attributes":{},"id":"1713","type":"Selection"},{"attributes":{"source":{"id":"1115","type":"AjaxDataSource"}},"id":"1376","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1723","type":"Selection"},"selection_policy":{"id":"1724","type":"UnionRenderers"}},"id":"1123","type":"AjaxDataSource"},{"attributes":{},"id":"1823","type":"Selection"},{"attributes":{"args":{"other":{"id":"1063","type":"LinearAxis"}},"code":"other.axis_line_alpha = this.active"},"id":"1605","type":"CustomJS"},{"attributes":{},"id":"1036","type":"LinearScale"},{"attributes":{"data_source":{"id":"1115","type":"AjaxDataSource"},"glyph":{"id":"1203","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1378","type":"CDSView"},"visible":false},"id":"1377","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1102","type":"AjaxDataSource"},"glyph":{"id":"1188","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1342","type":"CDSView"}},"id":"1341","type":"GlyphRenderer"},{"attributes":{},"id":"1714","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1807","type":"Selection"},"selection_policy":{"id":"1808","type":"UnionRenderers"}},"id":"1124","type":"AjaxDataSource"},{"attributes":{},"id":"1824","type":"UnionRenderers"},{"attributes":{"height":30,"text":" Line width ","width":150},"id":"1607","type":"Div"},{"attributes":{"axis_label":"m/z ","formatter":{"id":"1887","type":"BasicTickFormatter"},"ticker":{"id":"1039","type":"BasicTicker"}},"id":"1038","type":"LinearAxis"},{"attributes":{"source":{"id":"1115","type":"AjaxDataSource"}},"id":"1378","type":"CDSView"},{"attributes":{},"id":"1715","type":"Selection"},{"attributes":{"source":{"id":"1102","type":"AjaxDataSource"}},"id":"1342","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1847","type":"Selection"},"selection_policy":{"id":"1848","type":"UnionRenderers"}},"id":"1125","type":"AjaxDataSource"},{"attributes":{},"id":"1825","type":"Selection"},{"attributes":{},"id":"1039","type":"BasicTicker"},{"attributes":{"data_source":{"id":"1102","type":"AjaxDataSource"},"glyph":{"id":"1189","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1344","type":"CDSView"}},"id":"1343","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1375","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1379","type":"CustomJS"},{"attributes":{},"id":"1716","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1725","type":"Selection"},"selection_policy":{"id":"1726","type":"UnionRenderers"}},"id":"1126","type":"AjaxDataSource"},{"attributes":{},"id":"1826","type":"UnionRenderers"},{"attributes":{"callback":null,"height":30,"js_property_callbacks":{"change:value":[{"id":"1644","type":"CustomJS"}]},"value":"1","width":100},"id":"1608","type":"TextInput"},{"attributes":{"ticker":{"id":"1039","type":"BasicTicker"}},"id":"1042","type":"Grid"},{"attributes":{"args":{"other":{"id":"1377","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1380","type":"CustomJS"},{"attributes":{"source":{"id":"1102","type":"AjaxDataSource"}},"id":"1344","type":"CDSView"},{"attributes":{},"id":"1717","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1727","type":"Selection"},"selection_policy":{"id":"1728","type":"UnionRenderers"}},"id":"1127","type":"AjaxDataSource"},{"attributes":{},"id":"1827","type":"Selection"},{"attributes":{"toolbar":{"id":"1611","type":"Toolbar"},"toolbar_location":"above"},"id":"1609","type":"ToolbarBox"},{"attributes":{"axis_label":"Rel. Abundance  [%]","formatter":{"id":"1885","type":"BasicTickFormatter"},"ticker":{"id":"1044","type":"BasicTicker"}},"id":"1043","type":"LinearAxis"},{"attributes":{"data_source":{"id":"1103","type":"AjaxDataSource"},"glyph":{"id":"1190","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1346","type":"CDSView"},"visible":false},"id":"1345","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1118","type":"AjaxDataSource"},"glyph":{"id":"1204","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1382","type":"CDSView"}},"id":"1381","type":"GlyphRenderer"},{"attributes":{},"id":"1718","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1809","type":"Selection"},"selection_policy":{"id":"1810","type":"UnionRenderers"}},"id":"1128","type":"AjaxDataSource"},{"attributes":{},"id":"1828","type":"UnionRenderers"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","logo":null,"tools":[{"id":"1068","type":"SaveTool"}]},"id":"1611","type":"Toolbar"},{"attributes":{},"id":"1044","type":"BasicTicker"},{"attributes":{},"id":"1719","type":"Selection"},{"attributes":{"source":{"id":"1103","type":"AjaxDataSource"}},"id":"1346","type":"CDSView"},{"attributes":{"source":{"id":"1118","type":"AjaxDataSource"}},"id":"1382","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1849","type":"Selection"},"selection_policy":{"id":"1850","type":"UnionRenderers"}},"id":"1129","type":"AjaxDataSource"},{"attributes":{},"id":"1829","type":"Selection"},{"attributes":{"children":[{"id":"1572","type":"Div"},{"id":"1580","type":"Div"},{"id":"1582","type":"Div"},{"id":"1584","type":"Div"},{"id":"1607","type":"Div"}]},"id":"1612","type":"Column"},{"attributes":{"dimension":1,"ticker":{"id":"1044","type":"BasicTicker"}},"id":"1047","type":"Grid"},{"attributes":{"data_source":{"id":"1118","type":"AjaxDataSource"},"glyph":{"id":"1205","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1384","type":"CDSView"}},"id":"1383","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1103","type":"AjaxDataSource"},"glyph":{"id":"1191","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1348","type":"CDSView"},"visible":false},"id":"1347","type":"GlyphRenderer"},{"attributes":{},"id":"1720","type":"UnionRenderers"},{"attributes":{"background_fill_color":{"value":null},"below":[{"id":"1058","type":"LinearAxis"}],"border_fill_color":{"value":null},"center":[{"id":"1062","type":"Grid"},{"id":"1067","type":"Grid"}],"left":[{"id":"1063","type":"LinearAxis"}],"plot_height":2160,"plot_width":3840,"renderers":[{"id":"1269","type":"GlyphRenderer"},{"id":"1273","type":"GlyphRenderer"},{"id":"1277","type":"GlyphRenderer"},{"id":"1283","type":"GlyphRenderer"},{"id":"1287","type":"GlyphRenderer"},{"id":"1293","type":"GlyphRenderer"},{"id":"1297","type":"GlyphRenderer"},{"id":"1303","type":"GlyphRenderer"},{"id":"1307","type":"GlyphRenderer"},{"id":"1313","type":"GlyphRenderer"},{"id":"1317","type":"GlyphRenderer"},{"id":"1323","type":"GlyphRenderer"},{"id":"1327","type":"GlyphRenderer"},{"id":"1333","type":"GlyphRenderer"},{"id":"1337","type":"GlyphRenderer"},{"id":"1343","type":"GlyphRenderer"},{"id":"1347","type":"GlyphRenderer"},{"id":"1353","type":"GlyphRenderer"},{"id":"1357","type":"GlyphRenderer"},{"id":"1363","type":"GlyphRenderer"},{"id":"1367","type":"GlyphRenderer"},{"id":"1373","type":"GlyphRenderer"},{"id":"1377","type":"GlyphRenderer"},{"id":"1383","type":"GlyphRenderer"},{"id":"1387","type":"GlyphRenderer"},{"id":"1393","type":"GlyphRenderer"},{"id":"1397","type":"GlyphRenderer"},{"id":"1403","type":"GlyphRenderer"},{"id":"1407","type":"GlyphRenderer"},{"id":"1413","type":"GlyphRenderer"},{"id":"1417","type":"GlyphRenderer"},{"id":"1423","type":"GlyphRenderer"},{"id":"1427","type":"GlyphRenderer"},{"id":"1433","type":"GlyphRenderer"},{"id":"1437","type":"GlyphRenderer"},{"id":"1443","type":"GlyphRenderer"},{"id":"1447","type":"GlyphRenderer"},{"id":"1453","type":"GlyphRenderer"},{"id":"1457","type":"GlyphRenderer"},{"id":"1463","type":"GlyphRenderer"},{"id":"1467","type":"GlyphRenderer"}],"title":{"id":"1664","type":"Title"},"toolbar":{"id":"1069","type":"Toolbar"},"toolbar_location":null,"x_range":{"id":"1002","type":"DataRange1d"},"x_scale":{"id":"1054","type":"LinearScale"},"y_range":{"id":"1004","type":"DataRange1d"},"y_scale":{"id":"1056","type":"LinearScale"}},"id":"1051","subtype":"Figure","type":"Plot"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1729","type":"Selection"},"selection_policy":{"id":"1730","type":"UnionRenderers"}},"id":"1130","type":"AjaxDataSource"},{"attributes":{},"id":"1830","type":"UnionRenderers"},{"attributes":{"children":[{"id":"1573","type":"Toggle"},{"id":"1581","type":"Toggle"},{"id":"1583","type":"Toggle"},{"id":"1585","type":"Toggle"},{"id":"1608","type":"TextInput"}]},"id":"1613","type":"Column"},{"attributes":{"source":{"id":"1103","type":"AjaxDataSource"}},"id":"1348","type":"CDSView"},{"attributes":{"source":{"id":"1118","type":"AjaxDataSource"}},"id":"1384","type":"CDSView"},{"attributes":{},"id":"1721","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1731","type":"Selection"},"selection_policy":{"id":"1732","type":"UnionRenderers"}},"id":"1131","type":"AjaxDataSource"},{"attributes":{},"id":"1831","type":"Selection"},{"attributes":{"height":30,"text":" Ion Charge","width":150},"id":"1614","type":"Div"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1048","type":"SaveTool"}]},"id":"1049","type":"Toolbar"},{"attributes":{"args":{"other":{"id":"1345","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1349","type":"CustomJS"},{"attributes":{"data_source":{"id":"1119","type":"AjaxDataSource"},"glyph":{"id":"1206","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1386","type":"CDSView"},"visible":false},"id":"1385","type":"GlyphRenderer"},{"attributes":{},"id":"1722","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1811","type":"Selection"},"selection_policy":{"id":"1812","type":"UnionRenderers"}},"id":"1132","type":"AjaxDataSource"},{"attributes":{"height":45,"text":" &lt;h2&gt;Data Processing&lt;/h2&gt;","width":400},"id":"1615","type":"Div"},{"attributes":{},"id":"1832","type":"UnionRenderers"},{"attributes":{},"id":"1048","type":"SaveTool"},{"attributes":{"args":{"other":{"id":"1347","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1350","type":"CustomJS"},{"attributes":{},"id":"1723","type":"Selection"},{"attributes":{"source":{"id":"1119","type":"AjaxDataSource"}},"id":"1386","type":"CDSView"},{"attributes":{},"id":"1054","type":"LinearScale"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1851","type":"Selection"},"selection_policy":{"id":"1852","type":"UnionRenderers"}},"id":"1133","type":"AjaxDataSource"},{"attributes":{"height":45,"text":" &lt;h2&gt;Instrument Mode&lt;/h2&gt;","width":400},"id":"1616","type":"Div"},{"attributes":{},"id":"1833","type":"Selection"},{"attributes":{"data_source":{"id":"1119","type":"AjaxDataSource"},"glyph":{"id":"1207","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1388","type":"CDSView"},"visible":false},"id":"1387","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1106","type":"AjaxDataSource"},"glyph":{"id":"1192","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1352","type":"CDSView"}},"id":"1351","type":"GlyphRenderer"},{"attributes":{},"id":"1724","type":"UnionRenderers"},{"attributes":{},"id":"1056","type":"LinearScale"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1733","type":"Selection"},"selection_policy":{"id":"1734","type":"UnionRenderers"}},"id":"1134","type":"AjaxDataSource"},{"attributes":{"height":70,"text":"Note: The data processing might take a couple of seconds. Please stay patient and refrain from pressing the Process Data button repeatedly. \n","width":300},"id":"1617","type":"Div"},{"attributes":{},"id":"1834","type":"UnionRenderers"},{"attributes":{"source":{"id":"1119","type":"AjaxDataSource"}},"id":"1388","type":"CDSView"},{"attributes":{},"id":"1725","type":"Selection"},{"attributes":{"source":{"id":"1106","type":"AjaxDataSource"}},"id":"1352","type":"CDSView"},{"attributes":{"axis_label":"m/z ","axis_label_text_font_size":{"value":"40px"},"axis_line_width":{"value":3},"formatter":{"id":"1667","type":"BasicTickFormatter"},"major_label_text_font_size":{"value":"32px"},"major_tick_line_width":{"value":3},"major_tick_out":14,"minor_tick_line_width":{"value":3},"minor_tick_out":10,"ticker":{"id":"1059","type":"BasicTicker"}},"id":"1058","type":"LinearAxis"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1735","type":"Selection"},"selection_policy":{"id":"1736","type":"UnionRenderers"}},"id":"1135","type":"AjaxDataSource"},{"attributes":{"children":[{"id":"1570","type":"Column"},{"id":"1571","type":"Column"}]},"id":"1618","type":"Row"},{"attributes":{},"id":"1835","type":"Selection"},{"attributes":{"data_source":{"id":"1106","type":"AjaxDataSource"},"glyph":{"id":"1193","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1354","type":"CDSView"}},"id":"1353","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1385","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1389","type":"CustomJS"},{"attributes":{},"id":"1726","type":"UnionRenderers"},{"attributes":{},"id":"1059","type":"BasicTicker"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1813","type":"Selection"},"selection_policy":{"id":"1814","type":"UnionRenderers"}},"id":"1136","type":"AjaxDataSource"},{"attributes":{"children":[{"id":"1614","type":"Div"},{"id":"1257","type":"Select"}]},"id":"1619","type":"Row"},{"attributes":{},"id":"1836","type":"UnionRenderers"},{"attributes":{"source":{"id":"1106","type":"AjaxDataSource"}},"id":"1354","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1387","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1390","type":"CustomJS"},{"attributes":{"children":[{"id":"1615","type":"Div"},{"id":"1618","type":"Row"},{"id":"1617","type":"Div"},{"id":"1616","type":"Div"},{"id":"1619","type":"Row"}],"name":"Data Processing","visible":false},"id":"1620","type":"Column"},{"attributes":{"grid_line_width":2,"ticker":{"id":"1059","type":"BasicTicker"}},"id":"1062","type":"Grid"},{"attributes":{},"id":"1727","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1853","type":"Selection"},"selection_policy":{"id":"1854","type":"UnionRenderers"}},"id":"1137","type":"AjaxDataSource"},{"attributes":{},"id":"1837","type":"Selection"},{"attributes":{"data_source":{"id":"1107","type":"AjaxDataSource"},"glyph":{"id":"1194","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1356","type":"CDSView"},"visible":false},"id":"1355","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1122","type":"AjaxDataSource"},"glyph":{"id":"1208","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1392","type":"CDSView"}},"id":"1391","type":"GlyphRenderer"},{"attributes":{},"id":"1728","type":"UnionRenderers"},{"attributes":{"axis_label":"Rel. Abundance  [%]","axis_label_text_font_size":{"value":"40px"},"axis_line_width":{"value":3},"formatter":{"id":"1665","type":"BasicTickFormatter"},"major_label_text_font_size":{"value":"32px"},"major_tick_line_width":{"value":3},"major_tick_out":14,"minor_tick_line_width":{"value":3},"minor_tick_out":10,"ticker":{"id":"1064","type":"BasicTicker"}},"id":"1063","type":"LinearAxis"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1737","type":"Selection"},"selection_policy":{"id":"1738","type":"UnionRenderers"}},"id":"1138","type":"AjaxDataSource"},{"attributes":{"children":[{"id":"1612","type":"Column"},{"id":"1613","type":"Column"}],"width":150},"id":"1621","type":"Row"},{"attributes":{},"id":"1838","type":"UnionRenderers"},{"attributes":{},"id":"1729","type":"Selection"},{"attributes":{"source":{"id":"1107","type":"AjaxDataSource"}},"id":"1356","type":"CDSView"},{"attributes":{"source":{"id":"1122","type":"AjaxDataSource"}},"id":"1392","type":"CDSView"},{"attributes":{},"id":"1064","type":"BasicTicker"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1739","type":"Selection"},"selection_policy":{"id":"1740","type":"UnionRenderers"}},"id":"1139","type":"AjaxDataSource"},{"attributes":{"height":45,"text":" &lt;h2&gt;Graphics options&lt;/h2&gt;","width":400},"id":"1622","type":"Div"},{"attributes":{},"id":"1839","type":"Selection"},{"attributes":{"data_source":{"id":"1107","type":"AjaxDataSource"},"glyph":{"id":"1195","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1358","type":"CDSView"},"visible":false},"id":"1357","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1122","type":"AjaxDataSource"},"glyph":{"id":"1209","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1394","type":"CDSView"}},"id":"1393","type":"GlyphRenderer"},{"attributes":{},"id":"1730","type":"UnionRenderers"},{"attributes":{"dimension":1,"grid_line_width":2,"ticker":{"id":"1064","type":"BasicTicker"}},"id":"1067","type":"Grid"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1815","type":"Selection"},"selection_policy":{"id":"1816","type":"UnionRenderers"}},"id":"1140","type":"AjaxDataSource"},{"attributes":{"height":45,"text":" &lt;h2&gt;Window Range&lt;/h2&gt;","width":400},"id":"1623","type":"Div"},{"attributes":{},"id":"1840","type":"UnionRenderers"},{"attributes":{"source":{"id":"1107","type":"AjaxDataSource"}},"id":"1358","type":"CDSView"},{"attributes":{"source":{"id":"1122","type":"AjaxDataSource"}},"id":"1394","type":"CDSView"},{"attributes":{},"id":"1731","type":"Selection"},{"attributes":{},"id":"1071","type":"Legend"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1855","type":"Selection"},"selection_policy":{"id":"1856","type":"UnionRenderers"}},"id":"1141","type":"AjaxDataSource"},{"attributes":{},"id":"1841","type":"Selection"},{"attributes":{"height":20,"width":100},"id":"1624","type":"Div"},{"attributes":{"args":{"other":{"id":"1355","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1359","type":"CustomJS"},{"attributes":{"data_source":{"id":"1123","type":"AjaxDataSource"},"glyph":{"id":"1210","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1396","type":"CDSView"},"visible":false},"id":"1395","type":"GlyphRenderer"},{"attributes":{},"id":"1732","type":"UnionRenderers"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1068","type":"SaveTool"}]},"id":"1069","type":"Toolbar"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1741","type":"Selection"},"selection_policy":{"id":"1742","type":"UnionRenderers"}},"id":"1142","type":"AjaxDataSource"},{"attributes":{},"id":"1842","type":"UnionRenderers"},{"attributes":{"height":20,"text":"&lt;b&gt;Min&lt;/b&gt;","width":70},"id":"1625","type":"Div"},{"attributes":{},"id":"1068","type":"SaveTool"},{"attributes":{"args":{"other":{"id":"1357","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1360","type":"CustomJS"},{"attributes":{},"id":"1733","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1743","type":"Selection"},"selection_policy":{"id":"1744","type":"UnionRenderers"}},"id":"1143","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1123","type":"AjaxDataSource"}},"id":"1396","type":"CDSView"},{"attributes":{},"id":"1843","type":"Selection"},{"attributes":{"height":20,"text":"&lt;b&gt;Max&lt;/b&gt;","width":70},"id":"1626","type":"Div"},{"attributes":{"adapter":null,"callback":null,"data":{"Mass":[],"Old_Mass":[],"Old_Uncertainty":[],"Series":[],"Uncertainty":[]},"selected":{"id":"1769","type":"Selection"},"selection_policy":{"id":"1770","type":"UnionRenderers"}},"id":"1152","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1110","type":"AjaxDataSource"},"glyph":{"id":"1196","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1362","type":"CDSView"}},"id":"1361","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1123","type":"AjaxDataSource"},"glyph":{"id":"1211","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1398","type":"CDSView"},"visible":false},"id":"1397","type":"GlyphRenderer"},{"attributes":{},"id":"1734","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1781","type":"Selection"},"selection_policy":{"id":"1782","type":"UnionRenderers"}},"id":"1072","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1817","type":"Selection"},"selection_policy":{"id":"1818","type":"UnionRenderers"}},"id":"1144","type":"AjaxDataSource"},{"attributes":{},"id":"1844","type":"UnionRenderers"},{"attributes":{"source":{"id":"1123","type":"AjaxDataSource"}},"id":"1398","type":"CDSView"},{"attributes":{},"id":"1735","type":"Selection"},{"attributes":{"source":{"id":"1110","type":"AjaxDataSource"}},"id":"1362","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1821","type":"Selection"},"selection_policy":{"id":"1822","type":"UnionRenderers"}},"id":"1073","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1857","type":"Selection"},"selection_policy":{"id":"1858","type":"UnionRenderers"}},"id":"1145","type":"AjaxDataSource"},{"attributes":{},"id":"1845","type":"Selection"},{"attributes":{"height":30,"text":" &lt;b&gt;Y-Range (%)&lt;/b&gt;","width":100},"id":"1628","type":"Div"},{"attributes":{"data_source":{"id":"1110","type":"AjaxDataSource"},"glyph":{"id":"1197","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1364","type":"CDSView"}},"id":"1363","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1395","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1399","type":"CustomJS"},{"attributes":{},"id":"1736","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1673","type":"Selection"},"selection_policy":{"id":"1674","type":"UnionRenderers"}},"id":"1074","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1745","type":"Selection"},"selection_policy":{"id":"1746","type":"UnionRenderers"}},"id":"1146","type":"AjaxDataSource"},{"attributes":{},"id":"1846","type":"UnionRenderers"},{"attributes":{"callback":null,"height":30,"value":"1000.0","width":70},"id":"1629","type":"TextInput"},{"attributes":{"args":{"other":{"id":"1397","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1400","type":"CustomJS"},{"attributes":{"source":{"id":"1110","type":"AjaxDataSource"}},"id":"1364","type":"CDSView"},{"attributes":{},"id":"1737","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1675","type":"Selection"},"selection_policy":{"id":"1676","type":"UnionRenderers"}},"id":"1075","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1747","type":"Selection"},"selection_policy":{"id":"1748","type":"UnionRenderers"}},"id":"1147","type":"AjaxDataSource"},{"attributes":{},"id":"1847","type":"Selection"},{"attributes":{"data_source":{"id":"1111","type":"AjaxDataSource"},"glyph":{"id":"1198","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1366","type":"CDSView"},"visible":false},"id":"1365","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1126","type":"AjaxDataSource"},"glyph":{"id":"1212","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1402","type":"CDSView"}},"id":"1401","type":"GlyphRenderer"},{"attributes":{},"id":"1738","type":"UnionRenderers"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1783","type":"Selection"},"selection_policy":{"id":"1784","type":"UnionRenderers"}},"id":"1076","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1819","type":"Selection"},"selection_policy":{"id":"1820","type":"UnionRenderers"}},"id":"1148","type":"AjaxDataSource"},{"attributes":{},"id":"1848","type":"UnionRenderers"},{"attributes":{"callback":null,"height":30,"value":"20000.0","width":70},"id":"1630","type":"TextInput"},{"attributes":{},"id":"1739","type":"Selection"},{"attributes":{"source":{"id":"1111","type":"AjaxDataSource"}},"id":"1366","type":"CDSView"},{"attributes":{"source":{"id":"1126","type":"AjaxDataSource"}},"id":"1402","type":"CDSView"},{"attributes":{},"id":"1849","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1859","type":"Selection"},"selection_policy":{"id":"1860","type":"UnionRenderers"}},"id":"1149","type":"AjaxDataSource"},{"attributes":{},"id":"1740","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#c49c94"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1222","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1749","type":"Selection"},"selection_policy":{"id":"1750","type":"UnionRenderers"}},"id":"1150","type":"AjaxDataSource"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#c49c94"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1223","type":"MultiLine"},{"attributes":{},"id":"1741","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1751","type":"Selection"},"selection_policy":{"id":"1752","type":"UnionRenderers"}},"id":"1151","type":"AjaxDataSource"},{"attributes":{},"id":"1742","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#f7b6d2"},"name":"Series 17","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1224","type":"MultiLine"},{"attributes":{"line_color":{"value":"#f7b6d2"},"line_width":{"value":4},"name":"Series 17","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1225","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1763","type":"Selection"},"selection_policy":{"id":"1764","type":"UnionRenderers"}},"id":"1153","type":"AjaxDataSource"},{"attributes":{},"id":"1743","type":"Selection"},{"attributes":{"height":30,"text":" Gaussian Smoothing:","width":150},"id":"1559","type":"Div"},{"attributes":{},"id":"1744","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#f7b6d2"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1226","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"]},"selected":{"id":"1777","type":"Selection"},"selection_policy":{"id":"1778","type":"UnionRenderers"}},"id":"1154","type":"AjaxDataSource"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#f7b6d2"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1227","type":"MultiLine"},{"attributes":{},"id":"1745","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1861","type":"Selection"},"selection_policy":{"id":"1862","type":"UnionRenderers"}},"id":"1155","type":"AjaxDataSource"},{"attributes":{},"id":"1746","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#c7c7c7"},"name":"Series 18","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1228","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1863","type":"Selection"},"selection_policy":{"id":"1864","type":"UnionRenderers"}},"id":"1156","type":"AjaxDataSource"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1671","type":"Selection"},"selection_policy":{"id":"1672","type":"UnionRenderers"}},"id":"1157","type":"AjaxDataSource"},{"attributes":{"line_color":{"value":"#c7c7c7"},"line_width":{"value":4},"name":"Series 18","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1229","type":"MultiLine"},{"attributes":{},"id":"1747","type":"Selection"},{"attributes":{},"id":"1748","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#c7c7c7"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1230","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"gau_rep":[1],"gau_sigma":[0.0],"intensity_threshold":[0.0],"mz_low":[0.0],"mz_upp":[20000.0],"sub_mode":["Substract Minimum"],"sub_value":[0.0]},"selected":{"id":"1779","type":"Selection"},"selection_policy":{"id":"1780","type":"UnionRenderers"}},"id":"1158","type":"AjaxDataSource"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#c7c7c7"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1231","type":"MultiLine"},{"attributes":{},"id":"1749","type":"Selection"},{"attributes":{"adapter":null,"callback":null,"data":{"colour":["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d","#9edae5","#000000"],"series":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20","Background"]},"selected":{"id":"1775","type":"Selection"},"selection_policy":{"id":"1776","type":"UnionRenderers"}},"id":"1159","type":"AjaxDataSource"},{"attributes":{},"id":"1750","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#1f77b4"},"name":"Series 1","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1160","type":"MultiLine"},{"attributes":{"line_color":{"value":"#dbdb8d"},"name":"Series 19","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1232","type":"MultiLine"},{"attributes":{"line_color":{"value":"#1f77b4"},"line_width":{"value":4},"name":"Series 1","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1161","type":"MultiLine"},{"attributes":{"line_color":{"value":"#dbdb8d"},"line_width":{"value":4},"name":"Series 19","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1233","type":"MultiLine"},{"attributes":{},"id":"1751","type":"Selection"},{"attributes":{},"id":"1752","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#1f77b4"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1162","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#dbdb8d"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1234","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#1f77b4"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1163","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#dbdb8d"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1235","type":"MultiLine"},{"attributes":{},"id":"1753","type":"BasicTickFormatter"},{"attributes":{"line_color":{"value":"#ff7f0e"},"name":"Series 2","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1164","type":"MultiLine"},{"attributes":{"line_color":{"value":"#9edae5"},"name":"Series 20","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1236","type":"MultiLine"},{"attributes":{},"id":"1755","type":"BasicTickFormatter"},{"attributes":{"line_color":{"value":"#ff7f0e"},"line_width":{"value":4},"name":"Series 2","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1165","type":"MultiLine"},{"attributes":{"line_color":{"value":"#9edae5"},"line_width":{"value":4},"name":"Series 20","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1237","type":"MultiLine"},{"attributes":{},"id":"1757","type":"StringEditor"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#ff7f0e"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1166","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#9edae5"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1238","type":"MultiLine"},{"attributes":{},"id":"1758","type":"StringEditor"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#ff7f0e"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1167","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#9edae5"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1239","type":"MultiLine"},{"attributes":{},"id":"1759","type":"StringEditor"},{"attributes":{"line_color":{"value":"#000000"},"line_width":{"value":4},"name":"Background","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1245","type":"MultiLine"},{"attributes":{"line_color":{"value":"#2ca02c"},"name":"Series 3","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1168","type":"MultiLine"},{"attributes":{},"id":"1760","type":"StringEditor"},{"attributes":{"line_color":{"value":"#2ca02c"},"line_width":{"value":4},"name":"Series 3","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1169","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1865","type":"Selection"},"selection_policy":{"id":"1866","type":"UnionRenderers"}},"id":"1246","type":"AjaxDataSource"},{"attributes":{},"id":"1761","type":"StringFormatter"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#2ca02c"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1170","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#000000"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1242","type":"MultiLine"},{"attributes":{},"id":"1762","type":"StringEditor"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#2ca02c"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1171","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#000000"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1243","type":"MultiLine"},{"attributes":{},"id":"1763","type":"Selection"},{"attributes":{"line_color":{"value":"#d62728"},"name":"Series 4","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1172","type":"MultiLine"},{"attributes":{"line_color":{"value":"#000000"},"name":"Background","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1244","type":"MultiLine"},{"attributes":{},"id":"1764","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#d62728"},"line_width":{"value":4},"name":"Series 4","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1173","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1867","type":"Selection"},"selection_policy":{"id":"1868","type":"UnionRenderers"}},"id":"1247","type":"AjaxDataSource"},{"attributes":{},"id":"1765","type":"StringFormatter"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1476","type":"CustomJS"},{"id":"1477","type":"CustomJS"}]},"label":"Peak prediction","width":150},"id":"1248","type":"Toggle"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#d62728"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1174","type":"MultiLine"},{"attributes":{},"id":"1766","type":"StringEditor"},{"attributes":{},"id":"1813","type":"Selection"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1279","type":"CustomJS"},{"id":"1280","type":"CustomJS"},{"id":"1289","type":"CustomJS"},{"id":"1290","type":"CustomJS"},{"id":"1299","type":"CustomJS"},{"id":"1300","type":"CustomJS"},{"id":"1309","type":"CustomJS"},{"id":"1310","type":"CustomJS"},{"id":"1319","type":"CustomJS"},{"id":"1320","type":"CustomJS"},{"id":"1329","type":"CustomJS"},{"id":"1330","type":"CustomJS"},{"id":"1339","type":"CustomJS"},{"id":"1340","type":"CustomJS"},{"id":"1349","type":"CustomJS"},{"id":"1350","type":"CustomJS"},{"id":"1359","type":"CustomJS"},{"id":"1360","type":"CustomJS"},{"id":"1369","type":"CustomJS"},{"id":"1370","type":"CustomJS"},{"id":"1379","type":"CustomJS"},{"id":"1380","type":"CustomJS"},{"id":"1389","type":"CustomJS"},{"id":"1390","type":"CustomJS"},{"id":"1399","type":"CustomJS"},{"id":"1400","type":"CustomJS"},{"id":"1409","type":"CustomJS"},{"id":"1410","type":"CustomJS"},{"id":"1419","type":"CustomJS"},{"id":"1420","type":"CustomJS"},{"id":"1429","type":"CustomJS"},{"id":"1430","type":"CustomJS"},{"id":"1439","type":"CustomJS"},{"id":"1440","type":"CustomJS"},{"id":"1449","type":"CustomJS"},{"id":"1450","type":"CustomJS"},{"id":"1459","type":"CustomJS"},{"id":"1460","type":"CustomJS"},{"id":"1469","type":"CustomJS"},{"id":"1470","type":"CustomJS"}]},"label":"Peak mz","width":130},"id":"1249","type":"Toggle"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#d62728"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1175","type":"MultiLine"},{"attributes":{},"id":"1767","type":"StringEditor"},{"attributes":{"line_color":{"value":"#9467bd"},"name":"Series 5","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1176","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#1f77b4"},"line_width":{"value":2},"name":"pp_mean","xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1250","type":"MultiLine"},{"attributes":{},"id":"1768","type":"StringEditor"},{"attributes":{"line_color":{"value":"#9467bd"},"line_width":{"value":4},"name":"Series 5","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1177","type":"MultiLine"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#1f77b4"},"line_dash":[6],"line_width":{"value":2},"name":"pp_std","xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1251","type":"MultiLine"},{"attributes":{},"id":"1769","type":"Selection"},{"attributes":{"callback":null,"height":30,"js_property_callbacks":{"change:value":[{"id":"1256","type":"CustomJS"}]},"options":["Background","New Series"],"value":"Background","width":120},"id":"1252","type":"Select"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#9467bd"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1178","type":"MultiLine"},{"attributes":{},"id":"1770","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#9467bd"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1179","type":"MultiLine"},{"attributes":{},"id":"1771","type":"Selection"},{"attributes":{"callback":{"id":"1253","type":"CustomJS"},"height":30,"width":50},"id":"1254","type":"ColorPicker"},{"attributes":{"args":{"peak_lines":{"Background":{"id":"1242","type":"MultiLine"},"Series 1":{"id":"1162","type":"MultiLine"},"Series 10":{"id":"1198","type":"MultiLine"},"Series 11":{"id":"1202","type":"MultiLine"},"Series 12":{"id":"1206","type":"MultiLine"},"Series 13":{"id":"1210","type":"MultiLine"},"Series 14":{"id":"1214","type":"MultiLine"},"Series 15":{"id":"1218","type":"MultiLine"},"Series 16":{"id":"1222","type":"MultiLine"},"Series 17":{"id":"1226","type":"MultiLine"},"Series 18":{"id":"1230","type":"MultiLine"},"Series 19":{"id":"1234","type":"MultiLine"},"Series 2":{"id":"1166","type":"MultiLine"},"Series 20":{"id":"1238","type":"MultiLine"},"Series 3":{"id":"1170","type":"MultiLine"},"Series 4":{"id":"1174","type":"MultiLine"},"Series 5":{"id":"1178","type":"MultiLine"},"Series 6":{"id":"1182","type":"MultiLine"},"Series 7":{"id":"1186","type":"MultiLine"},"Series 8":{"id":"1190","type":"MultiLine"},"Series 9":{"id":"1194","type":"MultiLine"}},"peak_lines4k":{"Background":{"id":"1243","type":"MultiLine"},"Series 1":{"id":"1163","type":"MultiLine"},"Series 10":{"id":"1199","type":"MultiLine"},"Series 11":{"id":"1203","type":"MultiLine"},"Series 12":{"id":"1207","type":"MultiLine"},"Series 13":{"id":"1211","type":"MultiLine"},"Series 14":{"id":"1215","type":"MultiLine"},"Series 15":{"id":"1219","type":"MultiLine"},"Series 16":{"id":"1223","type":"MultiLine"},"Series 17":{"id":"1227","type":"MultiLine"},"Series 18":{"id":"1231","type":"MultiLine"},"Series 19":{"id":"1235","type":"MultiLine"},"Series 2":{"id":"1167","type":"MultiLine"},"Series 20":{"id":"1239","type":"MultiLine"},"Series 3":{"id":"1171","type":"MultiLine"},"Series 4":{"id":"1175","type":"MultiLine"},"Series 5":{"id":"1179","type":"MultiLine"},"Series 6":{"id":"1183","type":"MultiLine"},"Series 7":{"id":"1187","type":"MultiLine"},"Series 8":{"id":"1191","type":"MultiLine"},"Series 9":{"id":"1195","type":"MultiLine"}},"pp_mean":{"id":"1250","type":"MultiLine"},"pp_std":{"id":"1251","type":"MultiLine"},"sel_lines":{"Background":{"id":"1244","type":"MultiLine"},"Series 1":{"id":"1160","type":"MultiLine"},"Series 10":{"id":"1196","type":"MultiLine"},"Series 11":{"id":"1200","type":"MultiLine"},"Series 12":{"id":"1204","type":"MultiLine"},"Series 13":{"id":"1208","type":"MultiLine"},"Series 14":{"id":"1212","type":"MultiLine"},"Series 15":{"id":"1216","type":"MultiLine"},"Series 16":{"id":"1220","type":"MultiLine"},"Series 17":{"id":"1224","type":"MultiLine"},"Series 18":{"id":"1228","type":"MultiLine"},"Series 19":{"id":"1232","type":"MultiLine"},"Series 2":{"id":"1164","type":"MultiLine"},"Series 20":{"id":"1236","type":"MultiLine"},"Series 3":{"id":"1168","type":"MultiLine"},"Series 4":{"id":"1172","type":"MultiLine"},"Series 5":{"id":"1176","type":"MultiLine"},"Series 6":{"id":"1180","type":"MultiLine"},"Series 7":{"id":"1184","type":"MultiLine"},"Series 8":{"id":"1188","type":"MultiLine"},"Series 9":{"id":"1192","type":"MultiLine"}},"ser_act":{"id":"1252","type":"Select"},"series_colours_DS":{"id":"1159","type":"AjaxDataSource"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"]},"code":"var act = ser_act.value;\nvar names = series_names;\nvar line = sel_lines[act]\nvar pline= peak_lines[act]\nvar pline4k= peak_lines4k[act]\n\npline.line_color = cb_obj.color;\npline4k.line_color = cb_obj.color;\nline.line_color = cb_obj.color;\npp_mean.line_color = cb_obj.color;\npp_std.line_color = cb_obj.color;\n\nser_colours=series_colours_DS.data\nfor(var i=0; i&lt;ser_colours['series'].length; i++){\n\tif(act == ser_colours['series'][i]){\n\t\tconsole.log(ser_colours['series'][i] + ' ' + ser_colours['colour'][i] + ' ' + cb_obj.color)\n\t\tser_colours['colour'][i]=cb_obj.color;\n\t\t\n\t}\n}\n"},"id":"1253","type":"CustomJS"},{"attributes":{"line_color":{"value":"#8c564b"},"name":"Series 6","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1180","type":"MultiLine"},{"attributes":{},"id":"1772","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#8c564b"},"line_width":{"value":4},"name":"Series 6","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1181","type":"MultiLine"},{"attributes":{"callback":null,"height":30,"options":[],"width":150},"id":"1255","type":"Select"},{"attributes":{},"id":"1773","type":"Selection"},{"attributes":{"args":{"aser_data":{"id":"1153","type":"AjaxDataSource"},"col":{"id":"1254","type":"ColorPicker"},"pp_mean":{"id":"1250","type":"MultiLine"},"pp_mean_data":{"id":"1246","type":"AjaxDataSource"},"pp_std":{"id":"1251","type":"MultiLine"},"pp_std_data":{"id":"1247","type":"AjaxDataSource"},"sel_lines":{"Background":{"id":"1244","type":"MultiLine"},"Series 1":{"id":"1160","type":"MultiLine"},"Series 10":{"id":"1196","type":"MultiLine"},"Series 11":{"id":"1200","type":"MultiLine"},"Series 12":{"id":"1204","type":"MultiLine"},"Series 13":{"id":"1208","type":"MultiLine"},"Series 14":{"id":"1212","type":"MultiLine"},"Series 15":{"id":"1216","type":"MultiLine"},"Series 16":{"id":"1220","type":"MultiLine"},"Series 17":{"id":"1224","type":"MultiLine"},"Series 18":{"id":"1228","type":"MultiLine"},"Series 19":{"id":"1232","type":"MultiLine"},"Series 2":{"id":"1164","type":"MultiLine"},"Series 20":{"id":"1236","type":"MultiLine"},"Series 3":{"id":"1168","type":"MultiLine"},"Series 4":{"id":"1172","type":"MultiLine"},"Series 5":{"id":"1176","type":"MultiLine"},"Series 6":{"id":"1180","type":"MultiLine"},"Series 7":{"id":"1184","type":"MultiLine"},"Series 8":{"id":"1188","type":"MultiLine"},"Series 9":{"id":"1192","type":"MultiLine"}},"ser_match":{"id":"1255","type":"Select"},"series_colours_DS":{"id":"1159","type":"AjaxDataSource"},"series_data":{"Series 1":{"id":"1072","type":"AjaxDataSource"},"Series 10":{"id":"1108","type":"AjaxDataSource"},"Series 11":{"id":"1112","type":"AjaxDataSource"},"Series 12":{"id":"1116","type":"AjaxDataSource"},"Series 13":{"id":"1120","type":"AjaxDataSource"},"Series 14":{"id":"1124","type":"AjaxDataSource"},"Series 15":{"id":"1128","type":"AjaxDataSource"},"Series 16":{"id":"1132","type":"AjaxDataSource"},"Series 17":{"id":"1136","type":"AjaxDataSource"},"Series 18":{"id":"1140","type":"AjaxDataSource"},"Series 19":{"id":"1144","type":"AjaxDataSource"},"Series 2":{"id":"1076","type":"AjaxDataSource"},"Series 20":{"id":"1148","type":"AjaxDataSource"},"Series 3":{"id":"1080","type":"AjaxDataSource"},"Series 4":{"id":"1084","type":"AjaxDataSource"},"Series 5":{"id":"1088","type":"AjaxDataSource"},"Series 6":{"id":"1092","type":"AjaxDataSource"},"Series 7":{"id":"1096","type":"AjaxDataSource"},"Series 8":{"id":"1100","type":"AjaxDataSource"},"Series 9":{"id":"1104","type":"AjaxDataSource"}},"series_masses":{"id":"1152","type":"AjaxDataSource"},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"]},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max, posneg){\n    sign = 1.0\n    if (posneg.value == \"Negative\"){\n        sign = -1.0\n    }\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h*sign)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data, series_mz){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        console.log(\"There are selections\")\n        bg_mz.data=backg_mz;\n    }\n    if (low_inds.length == 0) {\n        console.log(\"In BG mode\")\n        mz=[]\n        Intensity=[]\n        len_data=data['mz'].length\n        console.log(len_data)\n        for(i=0; i&lt;len_data; i++){\n            mz.push(data['mz'][i])\n            Intensity.push(data['Intensity'][i])\n        }\n        new_bg = {'mz': [mz], 'Intensity': [Intensity]}\n        bg_mz.data = new_bg\n\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_peak_lines(ser_data,peak_data, names){\n    for(i_ser in names){\n        if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n            peak_xy={'xs':[], 'ys':[]}\n            for(i_peak=0; i_peak &lt; ser_data[names[i_ser]]['x_low'].length; i_peak++){\n                peak_xy['xs'].push()\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n            }\n        }\n        series_sele[names[i_ser]].change.emit()\n    }\n    return;\n\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n        peak_data[act]['xs'].push([data['mz'][i_max], data['mz'][i_max]])\n        peak_data[act]['ys'].push([0.0, data[\"Intensity\"][i_max]])\n        console.log(act + ' ' + peak_data[act]['xs']+ ' ' + peak_data[act]['ys'])\n\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses, posneg){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'], posneg)\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                // masses[\"Old_Mass\"].push(MacSED_res[1][i])\n                // masses[\"Old_Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                // masses[\"Old_Mass\"][i] = MacSED_res[1][i]\n                // masses[\"Old_Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/*Finding indices for mz values (the martial name refers to a Linear Algebra lecture of Prof Valentin Blomer the program author \nattended as a first year studentat the University of Goettingen. The same Prof Blomer also told his students in the same lecture\nseries not to implement a BubbleSort algorithm which the author remembered and promptly implemented because of the short lists to \nsort. )*/\nfunction indexkrieg(data, sele, ser_data, names, peak_mz){\n    console.log('Indexkrieg eingeleitet.')\n    for(i_ser in names){\n        peak_xy={'xs':[], 'ys':[]}\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n                // Now correct intensity bc of smooothing etc\n                ser_data[names[i_ser]]['max_int'][i_peak]=data['Intensity'][sele[names[i_ser]]['i_max'][i_peak]];\n                peak_xy['xs'].push([ser_data[names[i_ser]]['x_max'][i_peak],ser_data[names[i_ser]]['x_max'][i_peak]])\n                peak_xy['ys'].push([0.0,ser_data[names[i_ser]]['max_int'][i_peak]])\n            }\n        }\n        peak_mz[names[i_ser]].data=peak_xy\n        series_sele[names[i_ser]].change.emit()\n        series_data[names[i_ser]].change.emit()\n    }\n    return;\n}\n\nfunction cropping_data(data, cropping_min, cropping_max, sele, ser_data, names){\n    i_min=closest(data['mz'],cropping_min)\n    i_max=closest(data['mz'],cropping_max)\n    len_data=data['mz'].length\n    console.log(i_min + ' ' + i_max)\n    // data['mz'].slice(i_min,i_max)\n    // data['Intensity'].slice(i_min,i_max)\n    // data['mz'].splice(0,cropping_min)\n    // data['Intensity'].splice(0,cropping_min)\n    mz=data['mz'].slice(i_min,i_max)\n    Intensity=data['Intensity'].slice(i_min,i_max)\n    new_data={'mz':mz, 'Intensity':Intensity}\n    return new_data\n}\n\nfunction gaussian_filter(data, sigma){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    var len_y=array_y.length\n    console.log('in gaussian')\n    min_dist=10\n    for(i=0; i&lt;array_x.length-2; i++){\n        dist=array_x[i+1]-array_x[i]\n        if(dist &lt; min_dist){\n            min_dist=dist\n        }\n    }\n    sigma2div2=0.5*sigma*sigma\n    var smooth_array=array_y\n    var trunc=Math.ceil(4*sigma/min_dist)    \n    for(i=0; i &lt; len_y; i++){\n        weights= new Array(2*trunc)\n        if((i&gt;trunc) &amp;&amp;  (i &lt; (len_y-1-trunc))){\n            arr_ind=0\n            sum_arr=0.0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            new_val=0.0\n            arr_ind=0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n    \n        if (i&lt;trunc){\n            new_val=0.0\n            arr_ind=0\n            sum_arr=0.0\n\n            for(j=0; j &lt;=i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                x=array_x[j] + array_x[i] - array_x[0] - array_x[0]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            arr_ind=0\n            for(j=0; j &lt;=i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n\n        if (i&gt;len_y-1-trunc){\n            arr_ind=0\n            sum_arr=0.0\n            new_val=0.0\n            for(j=i-trunc; j &lt; len_y; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n\n            }\n            var last_x2= 2*array_x[len_y-1] /// Multiply klast entry of array_x to get end point\n            for(j=len_y-1; j &gt; len_y -trunc; j--){\n                x= last_x2  - array_x[j] - array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n\n            arr_ind=0\n            for(j=i-trunc; j &lt;len_y; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            for(j=len_y-1; j &gt;len_y-trunc; j--){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n\n        smooth_array[i]=new_val\n        }\n        smooth_array[trunc]=0.5*(smooth_array[trunc+1]+smooth_array[trunc-1])\n        smooth_array[array_y.length-1-trunc]=0.5*(smooth_array[array_y.length-trunc]+smooth_array[array_y.length-trunc-2])\n        }\n        returndata={'mz':array_x, 'Intensity':smooth_array}\n    return returndata;\n}\n\nfunction smoothing(data, sigma, n){\n\n    if (sigma !=0.0){\n    n_gau=parseInt(n)\n    console.log('Applying Gaussian Filter of sigma=' + sigma + ' for ' + n_gau + ' times.')\n    for(i=0; i &lt; n_gau; i++){\n        data=gaussian_filter(data, sigma)\n        console.log('Gaussian Filter successful for ' + i + ' times.')\n\n    }\n    }\n    return data\n    console.log('Smoothing complete')\n}\n\nfunction baseline_substraction(data, substraction_mode, substraction_value){\n    console.log('Performing baseline substraction')\n    var array_x=data['mz']\n    var array_y=data['Intensity'] \n\n    if (substraction_mode == 'Substract Minimum' &amp;&amp; substraction_value &gt; 0.0){\n    console.log('Mode: ' + substraction_mode)\n    y_min = array_y[closest(array_y, 0.0)]\n    console.log('Minimum: ' + y_min + ' %.')\n    for(var i=0; i&lt; array_y.length; i++){\n        array_y[i]-=y_min\n    }\n    }\n\n    if (substraction_mode == 'Substract Line' &amp;&amp; substraction_value &gt; 0.0){\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        console.log(n_points)\n        var frontpart=0.0\n        var backpart =0.0\n        for(var i=0; i&lt; n_points; i++){\n            frontpart+=array_y[i]\n            backpart +=array_y[array_y.length-1-i]\n            console.log(frontpart + ' ' + backpart)\n\n        }\n        frontpart = frontpart / n_points\n        backpart  =  backpart / n_points\n        slope = (backpart - frontpart)/ (array_x[array_x.length-1] - array_x[0])\n\n        console.log(frontpart + ' ' + backpart + ' ' + slope)\n\n        for(var i=0; i &lt; array_y.length; i++){\n            array_y[i]-=slope * (array_x[i] - array_x[0]) + frontpart\n        }\n\n    }\n\n    if (substraction_mode == 'Substract Curved' &amp;&amp; substraction_value &gt; 0.0){\n\n        /* \n        Taken from Massign Paper (and UniDEC)\n        First creates an array that matches the data but has the minimum value within a window of +/- buff.\n        Then, smooths the minimum array with a Gaussian filter of width buff * 2 to form the background array.\n        Finally, subtracts the background array from the data intensities.\n        :param datatop: Data array\n        :param buff: Width parameter\n        :return: Subtracted data\n        \"\"\"\n        length = len(datatop)\n        mins = list(range(0, length))\n        indexes = list(range(0, length))\n        for i in indexes:\n            mins[i] = np.amin(datatop[int(max([0, i - abs(buff)])):int(min([i + abs(buff), length])), 1])\n        background = filt.gaussian_filter(mins, abs(buff) * 2)\n        datatop[:, 1] = datatop[:, 1] - background\n        return datatop\n        */\n\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        var len_y=array_y.length\n        var mins= []\n        for(i=0; i &lt; len_y; i++){\n            low_ind=Math.max(0, i-n_points)\n            upp_ind=Math.min(len_y, i+n_points)\n            deduct_min=100.0\n            for (j=low_ind; j&lt; upp_ind; j++){\n                if(deduct_min &gt; array_y[j]){\n                    deduct_min=array_y[j]\n                }\n            }\n            // console.log(low_ind + ' ' + upp_ind + ' ' + deduct_min)\n            mins.push(deduct_min)\n        }\n        console.log('Array of minima created.')\n        temp_data={'mz':array_x, 'Intensity':mins}\n        temp_data=gaussian_filter(temp_data,2.0*substraction_value, 1)\n        mins=temp_data['Intensity']\n        console.log('Array of minima smoothened.')\n        for(var i=0; i&lt; len_y; i++){\n            array_y[i]-=mins[i]\n        }\n        console.log('Mimima from data deducted.')\n\n    }\n\n\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Baseline substraction complete.\")\n}\n\nfunction normalising_and_thresholding(data,intensity_threshold, sele){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    ///Normailisation\n    y_max = array_y[closest(array_y, 1000.0)]\n    var mult = 100.0/y_max\n    for (i=0; i&lt; array_y.length; i++){\n        array_y[i]=array_y[i]*mult\n    }\n    console.log('Normalisation complete')\n    ///Thresholding\n    console.log('Thresholding value: ' + intensity_threshold + ' %.')    \n    for (var i = array_y.length - 1; i &gt;= 0; i--) {\n        if (array_y[i] &lt; intensity_threshold) {\n            array_y[i] = 0.0   \n        }    \n    }\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Thresholding complete.\")\n}\n\nfunction data_processing(data, dtp, sele, ser_data, names, peak_mz){\n    var crop_dat=cropping_data(data, dtp['mz_low'][0], dtp['mz_upp'][0], sele, ser_data, names)\n    var nat_data=normalising_and_thresholding(crop_dat,dtp['intensity_threshold'][0])\n    var bld_data=baseline_substraction(nat_data, dtp['sub_mode'][0], dtp['sub_value'][0])\n    var smo_data=smoothing(bld_data, dtp['gau_sigma'][0],dtp['gau_rep'][0])\n    var final_data=normalising_and_thresholding(smo_data,0.0) // Renormailising\n    indexkrieg(final_data, sele, ser_data, names, peak_mz)\n    return final_data\n}\n\n\n\n\n\n\n\n\nvar names = series_names;\nvar sele_lines = {};\nvar masses = series_masses.data\nvar ser_data = {};\n\nif (cb_obj.value == \"New Series\"){\n        cb_obj.options.splice(cb_obj.options.length-1,1)\n        i = cb_obj.options.length\n        cb_obj.options.push(\"Series \" + i)\n        cb_obj.options.push(\"New Series\")\n        cb_obj.value=\"Series \" + i\n        ser_match.options.push(\"Series \" + i)\n        ser_match.value=\"Series \" + i\n    }\n// for(i in ser_cols['series']){\n//     sel_lines[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n//     sel_lines4k[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n//     peak_lines[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n//     peak_lines4k[ser_cols['series'][i]].line_color.value=ser_cols['colour'][i]\n// }\n\nfor(i_ser in names){\n    sele_lines[names[i_ser]]=sel_lines[names[i_ser]];\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    }\nsele_lines['Background']=sel_lines['Background'];\n\n\nvar act = cb_obj.value;\n// for(var i=0; i&lt;ser_colours['series'].length; i++){\n//     if(act == ser_colours['series'][i]){\n//         console.log(ser_colours['series'][i] + ' ' + ser_colours['colour'][i] + ' ' + cb_obj.color)\n//         col.color.value=ser_colours['colour'][i];\n        \n//     }\n// }\nconsole.log(act)\npeakprediction(masses, ser_data, act);\nconsole.log(col.color)\nconsole.log(sele_lines[act].line_color)\nif(act != 'Background'){\n    col.color = sele_lines[act].line_color.value;\n\tpp_mean.line_color.value = sele_lines[act].line_color.value;\n\tpp_std.line_color.value = sele_lines[act].line_color.value;\n\taser_data.data = series_data[act].data;\n}\nelse{\n    col.color = sele_lines['Background'].line_color;\n    empty_aser={ 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    aser_data.data = empty_aser\n} \n\n"},"id":"1256","type":"CustomJS"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#8c564b"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1182","type":"MultiLine"},{"attributes":{},"id":"1774","type":"UnionRenderers"},{"attributes":{"callback":null,"height":30,"js_property_callbacks":{"change:value":[{"id":"1264","type":"CustomJS"}]},"options":["Positive","Negative"],"value":"Positive","width":100},"id":"1257","type":"Select"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#8c564b"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1183","type":"MultiLine"},{"attributes":{},"id":"1775","type":"Selection"},{"attributes":{"line_color":{"value":"#e377c2"},"name":"Series 7","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1184","type":"MultiLine"},{"attributes":{},"id":"1776","type":"UnionRenderers"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1643","type":"CustomJS"}]},"label":"Figure options/export","width":150},"id":"1258","type":"Toggle"},{"attributes":{"line_color":{"value":"#e377c2"},"line_width":{"value":4},"name":"Series 7","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1185","type":"MultiLine"},{"attributes":{},"id":"1777","type":"Selection"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1482","type":"CustomJS"}]},"label":"Mass Finder","width":150},"id":"1259","type":"Toggle"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1823","type":"Selection"},"selection_policy":{"id":"1824","type":"UnionRenderers"}},"id":"1077","type":"AjaxDataSource"},{"attributes":{"height":30,"text":" Repeats of Smoothing:","width":150},"id":"1560","type":"Div"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1659","type":"CustomJS"}]},"label":"Mass Matching ","width":150},"id":"1260","type":"Toggle"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1677","type":"Selection"},"selection_policy":{"id":"1678","type":"UnionRenderers"}},"id":"1078","type":"AjaxDataSource"},{"attributes":{"height":30,"text":" Intensity Threshold (%)","width":150},"id":"1561","type":"Div"},{"attributes":{"callback":null,"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1658","type":"CustomJS"}]},"label":"Data Processing","width":150},"id":"1261","type":"Toggle"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1679","type":"Selection"},"selection_policy":{"id":"1680","type":"UnionRenderers"}},"id":"1079","type":"AjaxDataSource"},{"attributes":{"callback":null,"height":30,"js_property_callbacks":{"change:value":[{"id":"1564","type":"CustomJS"}]},"name":"sub_mode","options":["Substract Minimum","Substract Line","Substract Curved"],"value":"Substract Minimum","width":150},"id":"1562","type":"Select"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1785","type":"Selection"},"selection_policy":{"id":"1786","type":"UnionRenderers"}},"id":"1080","type":"AjaxDataSource"},{"attributes":{"callback":{"id":"1262","type":"CustomJS"},"dimensions":"width","name":"Select Peak","overlay":{"id":"1872","type":"BoxAnnotation"}},"id":"1265","type":"BoxSelectTool"},{"attributes":{"args":{"aser_data":{"id":"1153","type":"AjaxDataSource"},"bg_mz":{"id":"1157","type":"AjaxDataSource"},"peak_mz":{"Series 1":{"id":"1075","type":"AjaxDataSource"},"Series 10":{"id":"1111","type":"AjaxDataSource"},"Series 11":{"id":"1115","type":"AjaxDataSource"},"Series 12":{"id":"1119","type":"AjaxDataSource"},"Series 13":{"id":"1123","type":"AjaxDataSource"},"Series 14":{"id":"1127","type":"AjaxDataSource"},"Series 15":{"id":"1131","type":"AjaxDataSource"},"Series 16":{"id":"1135","type":"AjaxDataSource"},"Series 17":{"id":"1139","type":"AjaxDataSource"},"Series 18":{"id":"1143","type":"AjaxDataSource"},"Series 19":{"id":"1147","type":"AjaxDataSource"},"Series 2":{"id":"1079","type":"AjaxDataSource"},"Series 20":{"id":"1151","type":"AjaxDataSource"},"Series 3":{"id":"1083","type":"AjaxDataSource"},"Series 4":{"id":"1087","type":"AjaxDataSource"},"Series 5":{"id":"1091","type":"AjaxDataSource"},"Series 6":{"id":"1095","type":"AjaxDataSource"},"Series 7":{"id":"1099","type":"AjaxDataSource"},"Series 8":{"id":"1103","type":"AjaxDataSource"},"Series 9":{"id":"1107","type":"AjaxDataSource"}},"posneg":{"id":"1257","type":"Select"},"pp_mean_data":{"id":"1246","type":"AjaxDataSource"},"pp_std_data":{"id":"1247","type":"AjaxDataSource"},"proc_mz":{"id":"1156","type":"AjaxDataSource"},"ser_act":{"id":"1252","type":"Select"},"series_data":{"Series 1":{"id":"1072","type":"AjaxDataSource"},"Series 10":{"id":"1108","type":"AjaxDataSource"},"Series 11":{"id":"1112","type":"AjaxDataSource"},"Series 12":{"id":"1116","type":"AjaxDataSource"},"Series 13":{"id":"1120","type":"AjaxDataSource"},"Series 14":{"id":"1124","type":"AjaxDataSource"},"Series 15":{"id":"1128","type":"AjaxDataSource"},"Series 16":{"id":"1132","type":"AjaxDataSource"},"Series 17":{"id":"1136","type":"AjaxDataSource"},"Series 18":{"id":"1140","type":"AjaxDataSource"},"Series 19":{"id":"1144","type":"AjaxDataSource"},"Series 2":{"id":"1076","type":"AjaxDataSource"},"Series 20":{"id":"1148","type":"AjaxDataSource"},"Series 3":{"id":"1080","type":"AjaxDataSource"},"Series 4":{"id":"1084","type":"AjaxDataSource"},"Series 5":{"id":"1088","type":"AjaxDataSource"},"Series 6":{"id":"1092","type":"AjaxDataSource"},"Series 7":{"id":"1096","type":"AjaxDataSource"},"Series 8":{"id":"1100","type":"AjaxDataSource"},"Series 9":{"id":"1104","type":"AjaxDataSource"}},"series_masses":{"id":"1152","type":"AjaxDataSource"},"series_mz":{"Series 1":{"id":"1074","type":"AjaxDataSource"},"Series 10":{"id":"1110","type":"AjaxDataSource"},"Series 11":{"id":"1114","type":"AjaxDataSource"},"Series 12":{"id":"1118","type":"AjaxDataSource"},"Series 13":{"id":"1122","type":"AjaxDataSource"},"Series 14":{"id":"1126","type":"AjaxDataSource"},"Series 15":{"id":"1130","type":"AjaxDataSource"},"Series 16":{"id":"1134","type":"AjaxDataSource"},"Series 17":{"id":"1138","type":"AjaxDataSource"},"Series 18":{"id":"1142","type":"AjaxDataSource"},"Series 19":{"id":"1146","type":"AjaxDataSource"},"Series 2":{"id":"1078","type":"AjaxDataSource"},"Series 20":{"id":"1150","type":"AjaxDataSource"},"Series 3":{"id":"1082","type":"AjaxDataSource"},"Series 4":{"id":"1086","type":"AjaxDataSource"},"Series 5":{"id":"1090","type":"AjaxDataSource"},"Series 6":{"id":"1094","type":"AjaxDataSource"},"Series 7":{"id":"1098","type":"AjaxDataSource"},"Series 8":{"id":"1102","type":"AjaxDataSource"},"Series 9":{"id":"1106","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1073","type":"AjaxDataSource"},"Series 10":{"id":"1109","type":"AjaxDataSource"},"Series 11":{"id":"1113","type":"AjaxDataSource"},"Series 12":{"id":"1117","type":"AjaxDataSource"},"Series 13":{"id":"1121","type":"AjaxDataSource"},"Series 14":{"id":"1125","type":"AjaxDataSource"},"Series 15":{"id":"1129","type":"AjaxDataSource"},"Series 16":{"id":"1133","type":"AjaxDataSource"},"Series 17":{"id":"1137","type":"AjaxDataSource"},"Series 18":{"id":"1141","type":"AjaxDataSource"},"Series 19":{"id":"1145","type":"AjaxDataSource"},"Series 2":{"id":"1077","type":"AjaxDataSource"},"Series 20":{"id":"1149","type":"AjaxDataSource"},"Series 3":{"id":"1081","type":"AjaxDataSource"},"Series 4":{"id":"1085","type":"AjaxDataSource"},"Series 5":{"id":"1089","type":"AjaxDataSource"},"Series 6":{"id":"1093","type":"AjaxDataSource"},"Series 7":{"id":"1097","type":"AjaxDataSource"},"Series 8":{"id":"1101","type":"AjaxDataSource"},"Series 9":{"id":"1105","type":"AjaxDataSource"}}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max, posneg){\n    sign = 1.0\n    if (posneg.value == \"Negative\"){\n        sign = -1.0\n    }\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h*sign)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data, series_mz){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        console.log(\"There are selections\")\n        bg_mz.data=backg_mz;\n    }\n    if (low_inds.length == 0) {\n        console.log(\"In BG mode\")\n        mz=[]\n        Intensity=[]\n        len_data=data['mz'].length\n        console.log(len_data)\n        for(i=0; i&lt;len_data; i++){\n            mz.push(data['mz'][i])\n            Intensity.push(data['Intensity'][i])\n        }\n        new_bg = {'mz': [mz], 'Intensity': [Intensity]}\n        bg_mz.data = new_bg\n\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_peak_lines(ser_data,peak_data, names){\n    for(i_ser in names){\n        if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n            peak_xy={'xs':[], 'ys':[]}\n            for(i_peak=0; i_peak &lt; ser_data[names[i_ser]]['x_low'].length; i_peak++){\n                peak_xy['xs'].push()\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n            }\n        }\n        series_sele[names[i_ser]].change.emit()\n    }\n    return;\n\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n        peak_data[act]['xs'].push([data['mz'][i_max], data['mz'][i_max]])\n        peak_data[act]['ys'].push([0.0, data[\"Intensity\"][i_max]])\n        console.log(act + ' ' + peak_data[act]['xs']+ ' ' + peak_data[act]['ys'])\n\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses, posneg){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'], posneg)\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                // masses[\"Old_Mass\"].push(MacSED_res[1][i])\n                // masses[\"Old_Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                // masses[\"Old_Mass\"][i] = MacSED_res[1][i]\n                // masses[\"Old_Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/*Finding indices for mz values (the martial name refers to a Linear Algebra lecture of Prof Valentin Blomer the program author \nattended as a first year studentat the University of Goettingen. The same Prof Blomer also told his students in the same lecture\nseries not to implement a BubbleSort algorithm which the author remembered and promptly implemented because of the short lists to \nsort. )*/\nfunction indexkrieg(data, sele, ser_data, names, peak_mz){\n    console.log('Indexkrieg eingeleitet.')\n    for(i_ser in names){\n        peak_xy={'xs':[], 'ys':[]}\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n                // Now correct intensity bc of smooothing etc\n                ser_data[names[i_ser]]['max_int'][i_peak]=data['Intensity'][sele[names[i_ser]]['i_max'][i_peak]];\n                peak_xy['xs'].push([ser_data[names[i_ser]]['x_max'][i_peak],ser_data[names[i_ser]]['x_max'][i_peak]])\n                peak_xy['ys'].push([0.0,ser_data[names[i_ser]]['max_int'][i_peak]])\n            }\n        }\n        peak_mz[names[i_ser]].data=peak_xy\n        series_sele[names[i_ser]].change.emit()\n        series_data[names[i_ser]].change.emit()\n    }\n    return;\n}\n\nfunction cropping_data(data, cropping_min, cropping_max, sele, ser_data, names){\n    i_min=closest(data['mz'],cropping_min)\n    i_max=closest(data['mz'],cropping_max)\n    len_data=data['mz'].length\n    console.log(i_min + ' ' + i_max)\n    // data['mz'].slice(i_min,i_max)\n    // data['Intensity'].slice(i_min,i_max)\n    // data['mz'].splice(0,cropping_min)\n    // data['Intensity'].splice(0,cropping_min)\n    mz=data['mz'].slice(i_min,i_max)\n    Intensity=data['Intensity'].slice(i_min,i_max)\n    new_data={'mz':mz, 'Intensity':Intensity}\n    return new_data\n}\n\nfunction gaussian_filter(data, sigma){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    var len_y=array_y.length\n    console.log('in gaussian')\n    min_dist=10\n    for(i=0; i&lt;array_x.length-2; i++){\n        dist=array_x[i+1]-array_x[i]\n        if(dist &lt; min_dist){\n            min_dist=dist\n        }\n    }\n    sigma2div2=0.5*sigma*sigma\n    var smooth_array=array_y\n    var trunc=Math.ceil(4*sigma/min_dist)    \n    for(i=0; i &lt; len_y; i++){\n        weights= new Array(2*trunc)\n        if((i&gt;trunc) &amp;&amp;  (i &lt; (len_y-1-trunc))){\n            arr_ind=0\n            sum_arr=0.0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            new_val=0.0\n            arr_ind=0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n    \n        if (i&lt;trunc){\n            new_val=0.0\n            arr_ind=0\n            sum_arr=0.0\n\n            for(j=0; j &lt;=i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                x=array_x[j] + array_x[i] - array_x[0] - array_x[0]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            arr_ind=0\n            for(j=0; j &lt;=i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n\n        if (i&gt;len_y-1-trunc){\n            arr_ind=0\n            sum_arr=0.0\n            new_val=0.0\n            for(j=i-trunc; j &lt; len_y; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n\n            }\n            var last_x2= 2*array_x[len_y-1] /// Multiply klast entry of array_x to get end point\n            for(j=len_y-1; j &gt; len_y -trunc; j--){\n                x= last_x2  - array_x[j] - array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n\n            arr_ind=0\n            for(j=i-trunc; j &lt;len_y; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            for(j=len_y-1; j &gt;len_y-trunc; j--){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n\n        smooth_array[i]=new_val\n        }\n        smooth_array[trunc]=0.5*(smooth_array[trunc+1]+smooth_array[trunc-1])\n        smooth_array[array_y.length-1-trunc]=0.5*(smooth_array[array_y.length-trunc]+smooth_array[array_y.length-trunc-2])\n        }\n        returndata={'mz':array_x, 'Intensity':smooth_array}\n    return returndata;\n}\n\nfunction smoothing(data, sigma, n){\n\n    if (sigma !=0.0){\n    n_gau=parseInt(n)\n    console.log('Applying Gaussian Filter of sigma=' + sigma + ' for ' + n_gau + ' times.')\n    for(i=0; i &lt; n_gau; i++){\n        data=gaussian_filter(data, sigma)\n        console.log('Gaussian Filter successful for ' + i + ' times.')\n\n    }\n    }\n    return data\n    console.log('Smoothing complete')\n}\n\nfunction baseline_substraction(data, substraction_mode, substraction_value){\n    console.log('Performing baseline substraction')\n    var array_x=data['mz']\n    var array_y=data['Intensity'] \n\n    if (substraction_mode == 'Substract Minimum' &amp;&amp; substraction_value &gt; 0.0){\n    console.log('Mode: ' + substraction_mode)\n    y_min = array_y[closest(array_y, 0.0)]\n    console.log('Minimum: ' + y_min + ' %.')\n    for(var i=0; i&lt; array_y.length; i++){\n        array_y[i]-=y_min\n    }\n    }\n\n    if (substraction_mode == 'Substract Line' &amp;&amp; substraction_value &gt; 0.0){\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        console.log(n_points)\n        var frontpart=0.0\n        var backpart =0.0\n        for(var i=0; i&lt; n_points; i++){\n            frontpart+=array_y[i]\n            backpart +=array_y[array_y.length-1-i]\n            console.log(frontpart + ' ' + backpart)\n\n        }\n        frontpart = frontpart / n_points\n        backpart  =  backpart / n_points\n        slope = (backpart - frontpart)/ (array_x[array_x.length-1] - array_x[0])\n\n        console.log(frontpart + ' ' + backpart + ' ' + slope)\n\n        for(var i=0; i &lt; array_y.length; i++){\n            array_y[i]-=slope * (array_x[i] - array_x[0]) + frontpart\n        }\n\n    }\n\n    if (substraction_mode == 'Substract Curved' &amp;&amp; substraction_value &gt; 0.0){\n\n        /* \n        Taken from Massign Paper (and UniDEC)\n        First creates an array that matches the data but has the minimum value within a window of +/- buff.\n        Then, smooths the minimum array with a Gaussian filter of width buff * 2 to form the background array.\n        Finally, subtracts the background array from the data intensities.\n        :param datatop: Data array\n        :param buff: Width parameter\n        :return: Subtracted data\n        \"\"\"\n        length = len(datatop)\n        mins = list(range(0, length))\n        indexes = list(range(0, length))\n        for i in indexes:\n            mins[i] = np.amin(datatop[int(max([0, i - abs(buff)])):int(min([i + abs(buff), length])), 1])\n        background = filt.gaussian_filter(mins, abs(buff) * 2)\n        datatop[:, 1] = datatop[:, 1] - background\n        return datatop\n        */\n\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        var len_y=array_y.length\n        var mins= []\n        for(i=0; i &lt; len_y; i++){\n            low_ind=Math.max(0, i-n_points)\n            upp_ind=Math.min(len_y, i+n_points)\n            deduct_min=100.0\n            for (j=low_ind; j&lt; upp_ind; j++){\n                if(deduct_min &gt; array_y[j]){\n                    deduct_min=array_y[j]\n                }\n            }\n            // console.log(low_ind + ' ' + upp_ind + ' ' + deduct_min)\n            mins.push(deduct_min)\n        }\n        console.log('Array of minima created.')\n        temp_data={'mz':array_x, 'Intensity':mins}\n        temp_data=gaussian_filter(temp_data,2.0*substraction_value, 1)\n        mins=temp_data['Intensity']\n        console.log('Array of minima smoothened.')\n        for(var i=0; i&lt; len_y; i++){\n            array_y[i]-=mins[i]\n        }\n        console.log('Mimima from data deducted.')\n\n    }\n\n\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Baseline substraction complete.\")\n}\n\nfunction normalising_and_thresholding(data,intensity_threshold, sele){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    ///Normailisation\n    y_max = array_y[closest(array_y, 1000.0)]\n    var mult = 100.0/y_max\n    for (i=0; i&lt; array_y.length; i++){\n        array_y[i]=array_y[i]*mult\n    }\n    console.log('Normalisation complete')\n    ///Thresholding\n    console.log('Thresholding value: ' + intensity_threshold + ' %.')    \n    for (var i = array_y.length - 1; i &gt;= 0; i--) {\n        if (array_y[i] &lt; intensity_threshold) {\n            array_y[i] = 0.0   \n        }    \n    }\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Thresholding complete.\")\n}\n\nfunction data_processing(data, dtp, sele, ser_data, names, peak_mz){\n    var crop_dat=cropping_data(data, dtp['mz_low'][0], dtp['mz_upp'][0], sele, ser_data, names)\n    var nat_data=normalising_and_thresholding(crop_dat,dtp['intensity_threshold'][0])\n    var bld_data=baseline_substraction(nat_data, dtp['sub_mode'][0], dtp['sub_value'][0])\n    var smo_data=smoothing(bld_data, dtp['gau_sigma'][0],dtp['gau_rep'][0])\n    var final_data=normalising_and_thresholding(smo_data,0.0) // Renormailising\n    indexkrieg(final_data, sele, ser_data, names, peak_mz)\n    return final_data\n}\n\n\n\n\n\n\n\n\n/// Get data source from Callback args\n\n\n// if ((ser_act.value == \"Background\") &amp;&amp; (ser_act.options.length ==2)){\n//         ser_act.options.splice(ser_act.options.length-1,1)\n//         i = ser_act.options.length\n//         ser_act.options.push(\"Series \" + i)\n//         ser_act.options.push(\"New Series\")\n//         ser_act.value=\"Series \" + i\n//         ser_match.options.push(\"Series \" + i)\n//         ser_match.value=\"Series \" + i\n//     }\n\n// for(i_ser in names){\n//     sele_lines[names[i_ser]]=sel_lines[names[i_ser]];\n//     ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n//     }\n// sele_lines['Background']=sel_lines['Background'];\n\n\n// peakprediction(masses, ser_data, act);\n\n// if(act != 'Background'){\n//     col.color = sele_lines[act].line_color.value;\n// \tpp_mean.line_color = sele_lines[act].line_color;\n// \tpp_std.line_color = sele_lines[act].line_color;\n// \taser_data.data = series_data[act].data;\n// }\n\n\nvar data = proc_mz.data;\nvar peak_data={};\nvar act = ser_act.value;\n\nvar sele = {};\nvar ser_data={};\nvar act_data=aser_data.data;\nvar masses = series_masses.data;\n\nvar names = series_names;\n\n/// remember i in x gives ith element\nfor(i_ser in names){\n    sele[names[i_ser]]=series_sele[names[i_ser]].data;\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    peak_data[names[i_ser]]=peak_mz[names[i_ser]].data;\n}\n    \n/// get BoxSelectTool dimensions from cb_data parameter of Callback and find indices of lower/upper range marked\n\nvar geometry = cb_data['geometry'];\ni_low = closest(data['mz'], geometry['x0']);\ni_upp = closest(data['mz'], geometry['x1']);\n\n\n/// Boolean to decide whether to append new selection\n\nvar nopush = sele_logics(i_low, i_upp, sele, names, ser_data, act);\n\npush_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data);\n\ndata2sources(names, sele, data, series_mz);\n\nDoMacSED(masses, ser_data, names, series_masses, posneg)\n\npeakprediction(masses,ser_data, act);\n\ndata2active_table(ser_data[act], aser_data, act);\n\n    "},"id":"1262","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1825","type":"Selection"},"selection_policy":{"id":"1826","type":"UnionRenderers"}},"id":"1081","type":"AjaxDataSource"},{"attributes":{"args":{"aser_data":{"id":"1153","type":"AjaxDataSource"},"bg_mz":{"id":"1157","type":"AjaxDataSource"},"peak_mz":{"Series 1":{"id":"1075","type":"AjaxDataSource"},"Series 10":{"id":"1111","type":"AjaxDataSource"},"Series 11":{"id":"1115","type":"AjaxDataSource"},"Series 12":{"id":"1119","type":"AjaxDataSource"},"Series 13":{"id":"1123","type":"AjaxDataSource"},"Series 14":{"id":"1127","type":"AjaxDataSource"},"Series 15":{"id":"1131","type":"AjaxDataSource"},"Series 16":{"id":"1135","type":"AjaxDataSource"},"Series 17":{"id":"1139","type":"AjaxDataSource"},"Series 18":{"id":"1143","type":"AjaxDataSource"},"Series 19":{"id":"1147","type":"AjaxDataSource"},"Series 2":{"id":"1079","type":"AjaxDataSource"},"Series 20":{"id":"1151","type":"AjaxDataSource"},"Series 3":{"id":"1083","type":"AjaxDataSource"},"Series 4":{"id":"1087","type":"AjaxDataSource"},"Series 5":{"id":"1091","type":"AjaxDataSource"},"Series 6":{"id":"1095","type":"AjaxDataSource"},"Series 7":{"id":"1099","type":"AjaxDataSource"},"Series 8":{"id":"1103","type":"AjaxDataSource"},"Series 9":{"id":"1107","type":"AjaxDataSource"}},"posneg":{"id":"1257","type":"Select"},"pp_mean_data":{"id":"1246","type":"AjaxDataSource"},"pp_std_data":{"id":"1247","type":"AjaxDataSource"},"proc_mz":{"id":"1156","type":"AjaxDataSource"},"ser_act":{"id":"1252","type":"Select"},"series_data":{"Series 1":{"id":"1072","type":"AjaxDataSource"},"Series 10":{"id":"1108","type":"AjaxDataSource"},"Series 11":{"id":"1112","type":"AjaxDataSource"},"Series 12":{"id":"1116","type":"AjaxDataSource"},"Series 13":{"id":"1120","type":"AjaxDataSource"},"Series 14":{"id":"1124","type":"AjaxDataSource"},"Series 15":{"id":"1128","type":"AjaxDataSource"},"Series 16":{"id":"1132","type":"AjaxDataSource"},"Series 17":{"id":"1136","type":"AjaxDataSource"},"Series 18":{"id":"1140","type":"AjaxDataSource"},"Series 19":{"id":"1144","type":"AjaxDataSource"},"Series 2":{"id":"1076","type":"AjaxDataSource"},"Series 20":{"id":"1148","type":"AjaxDataSource"},"Series 3":{"id":"1080","type":"AjaxDataSource"},"Series 4":{"id":"1084","type":"AjaxDataSource"},"Series 5":{"id":"1088","type":"AjaxDataSource"},"Series 6":{"id":"1092","type":"AjaxDataSource"},"Series 7":{"id":"1096","type":"AjaxDataSource"},"Series 8":{"id":"1100","type":"AjaxDataSource"},"Series 9":{"id":"1104","type":"AjaxDataSource"}},"series_masses":{"id":"1152","type":"AjaxDataSource"},"series_mz":{"Series 1":{"id":"1074","type":"AjaxDataSource"},"Series 10":{"id":"1110","type":"AjaxDataSource"},"Series 11":{"id":"1114","type":"AjaxDataSource"},"Series 12":{"id":"1118","type":"AjaxDataSource"},"Series 13":{"id":"1122","type":"AjaxDataSource"},"Series 14":{"id":"1126","type":"AjaxDataSource"},"Series 15":{"id":"1130","type":"AjaxDataSource"},"Series 16":{"id":"1134","type":"AjaxDataSource"},"Series 17":{"id":"1138","type":"AjaxDataSource"},"Series 18":{"id":"1142","type":"AjaxDataSource"},"Series 19":{"id":"1146","type":"AjaxDataSource"},"Series 2":{"id":"1078","type":"AjaxDataSource"},"Series 20":{"id":"1150","type":"AjaxDataSource"},"Series 3":{"id":"1082","type":"AjaxDataSource"},"Series 4":{"id":"1086","type":"AjaxDataSource"},"Series 5":{"id":"1090","type":"AjaxDataSource"},"Series 6":{"id":"1094","type":"AjaxDataSource"},"Series 7":{"id":"1098","type":"AjaxDataSource"},"Series 8":{"id":"1102","type":"AjaxDataSource"},"Series 9":{"id":"1106","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1073","type":"AjaxDataSource"},"Series 10":{"id":"1109","type":"AjaxDataSource"},"Series 11":{"id":"1113","type":"AjaxDataSource"},"Series 12":{"id":"1117","type":"AjaxDataSource"},"Series 13":{"id":"1121","type":"AjaxDataSource"},"Series 14":{"id":"1125","type":"AjaxDataSource"},"Series 15":{"id":"1129","type":"AjaxDataSource"},"Series 16":{"id":"1133","type":"AjaxDataSource"},"Series 17":{"id":"1137","type":"AjaxDataSource"},"Series 18":{"id":"1141","type":"AjaxDataSource"},"Series 19":{"id":"1145","type":"AjaxDataSource"},"Series 2":{"id":"1077","type":"AjaxDataSource"},"Series 20":{"id":"1149","type":"AjaxDataSource"},"Series 3":{"id":"1081","type":"AjaxDataSource"},"Series 4":{"id":"1085","type":"AjaxDataSource"},"Series 5":{"id":"1089","type":"AjaxDataSource"},"Series 6":{"id":"1093","type":"AjaxDataSource"},"Series 7":{"id":"1097","type":"AjaxDataSource"},"Series 8":{"id":"1101","type":"AjaxDataSource"},"Series 9":{"id":"1105","type":"AjaxDataSource"}}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max, posneg){\n    sign = 1.0\n    if (posneg.value == \"Negative\"){\n        sign = -1.0\n    }\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h*sign)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data, series_mz){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        console.log(\"There are selections\")\n        bg_mz.data=backg_mz;\n    }\n    if (low_inds.length == 0) {\n        console.log(\"In BG mode\")\n        mz=[]\n        Intensity=[]\n        len_data=data['mz'].length\n        console.log(len_data)\n        for(i=0; i&lt;len_data; i++){\n            mz.push(data['mz'][i])\n            Intensity.push(data['Intensity'][i])\n        }\n        new_bg = {'mz': [mz], 'Intensity': [Intensity]}\n        bg_mz.data = new_bg\n\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_peak_lines(ser_data,peak_data, names){\n    for(i_ser in names){\n        if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n            peak_xy={'xs':[], 'ys':[]}\n            for(i_peak=0; i_peak &lt; ser_data[names[i_ser]]['x_low'].length; i_peak++){\n                peak_xy['xs'].push()\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n            }\n        }\n        series_sele[names[i_ser]].change.emit()\n    }\n    return;\n\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n        peak_data[act]['xs'].push([data['mz'][i_max], data['mz'][i_max]])\n        peak_data[act]['ys'].push([0.0, data[\"Intensity\"][i_max]])\n        console.log(act + ' ' + peak_data[act]['xs']+ ' ' + peak_data[act]['ys'])\n\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses, posneg){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'], posneg)\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                // masses[\"Old_Mass\"].push(MacSED_res[1][i])\n                // masses[\"Old_Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                // masses[\"Old_Mass\"][i] = MacSED_res[1][i]\n                // masses[\"Old_Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/*Finding indices for mz values (the martial name refers to a Linear Algebra lecture of Prof Valentin Blomer the program author \nattended as a first year studentat the University of Goettingen. The same Prof Blomer also told his students in the same lecture\nseries not to implement a BubbleSort algorithm which the author remembered and promptly implemented because of the short lists to \nsort. )*/\nfunction indexkrieg(data, sele, ser_data, names, peak_mz){\n    console.log('Indexkrieg eingeleitet.')\n    for(i_ser in names){\n        peak_xy={'xs':[], 'ys':[]}\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n                // Now correct intensity bc of smooothing etc\n                ser_data[names[i_ser]]['max_int'][i_peak]=data['Intensity'][sele[names[i_ser]]['i_max'][i_peak]];\n                peak_xy['xs'].push([ser_data[names[i_ser]]['x_max'][i_peak],ser_data[names[i_ser]]['x_max'][i_peak]])\n                peak_xy['ys'].push([0.0,ser_data[names[i_ser]]['max_int'][i_peak]])\n            }\n        }\n        peak_mz[names[i_ser]].data=peak_xy\n        series_sele[names[i_ser]].change.emit()\n        series_data[names[i_ser]].change.emit()\n    }\n    return;\n}\n\nfunction cropping_data(data, cropping_min, cropping_max, sele, ser_data, names){\n    i_min=closest(data['mz'],cropping_min)\n    i_max=closest(data['mz'],cropping_max)\n    len_data=data['mz'].length\n    console.log(i_min + ' ' + i_max)\n    // data['mz'].slice(i_min,i_max)\n    // data['Intensity'].slice(i_min,i_max)\n    // data['mz'].splice(0,cropping_min)\n    // data['Intensity'].splice(0,cropping_min)\n    mz=data['mz'].slice(i_min,i_max)\n    Intensity=data['Intensity'].slice(i_min,i_max)\n    new_data={'mz':mz, 'Intensity':Intensity}\n    return new_data\n}\n\nfunction gaussian_filter(data, sigma){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    var len_y=array_y.length\n    console.log('in gaussian')\n    min_dist=10\n    for(i=0; i&lt;array_x.length-2; i++){\n        dist=array_x[i+1]-array_x[i]\n        if(dist &lt; min_dist){\n            min_dist=dist\n        }\n    }\n    sigma2div2=0.5*sigma*sigma\n    var smooth_array=array_y\n    var trunc=Math.ceil(4*sigma/min_dist)    \n    for(i=0; i &lt; len_y; i++){\n        weights= new Array(2*trunc)\n        if((i&gt;trunc) &amp;&amp;  (i &lt; (len_y-1-trunc))){\n            arr_ind=0\n            sum_arr=0.0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            new_val=0.0\n            arr_ind=0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n    \n        if (i&lt;trunc){\n            new_val=0.0\n            arr_ind=0\n            sum_arr=0.0\n\n            for(j=0; j &lt;=i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                x=array_x[j] + array_x[i] - array_x[0] - array_x[0]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            arr_ind=0\n            for(j=0; j &lt;=i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n\n        if (i&gt;len_y-1-trunc){\n            arr_ind=0\n            sum_arr=0.0\n            new_val=0.0\n            for(j=i-trunc; j &lt; len_y; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n\n            }\n            var last_x2= 2*array_x[len_y-1] /// Multiply klast entry of array_x to get end point\n            for(j=len_y-1; j &gt; len_y -trunc; j--){\n                x= last_x2  - array_x[j] - array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n\n            arr_ind=0\n            for(j=i-trunc; j &lt;len_y; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            for(j=len_y-1; j &gt;len_y-trunc; j--){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n\n        smooth_array[i]=new_val\n        }\n        smooth_array[trunc]=0.5*(smooth_array[trunc+1]+smooth_array[trunc-1])\n        smooth_array[array_y.length-1-trunc]=0.5*(smooth_array[array_y.length-trunc]+smooth_array[array_y.length-trunc-2])\n        }\n        returndata={'mz':array_x, 'Intensity':smooth_array}\n    return returndata;\n}\n\nfunction smoothing(data, sigma, n){\n\n    if (sigma !=0.0){\n    n_gau=parseInt(n)\n    console.log('Applying Gaussian Filter of sigma=' + sigma + ' for ' + n_gau + ' times.')\n    for(i=0; i &lt; n_gau; i++){\n        data=gaussian_filter(data, sigma)\n        console.log('Gaussian Filter successful for ' + i + ' times.')\n\n    }\n    }\n    return data\n    console.log('Smoothing complete')\n}\n\nfunction baseline_substraction(data, substraction_mode, substraction_value){\n    console.log('Performing baseline substraction')\n    var array_x=data['mz']\n    var array_y=data['Intensity'] \n\n    if (substraction_mode == 'Substract Minimum' &amp;&amp; substraction_value &gt; 0.0){\n    console.log('Mode: ' + substraction_mode)\n    y_min = array_y[closest(array_y, 0.0)]\n    console.log('Minimum: ' + y_min + ' %.')\n    for(var i=0; i&lt; array_y.length; i++){\n        array_y[i]-=y_min\n    }\n    }\n\n    if (substraction_mode == 'Substract Line' &amp;&amp; substraction_value &gt; 0.0){\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        console.log(n_points)\n        var frontpart=0.0\n        var backpart =0.0\n        for(var i=0; i&lt; n_points; i++){\n            frontpart+=array_y[i]\n            backpart +=array_y[array_y.length-1-i]\n            console.log(frontpart + ' ' + backpart)\n\n        }\n        frontpart = frontpart / n_points\n        backpart  =  backpart / n_points\n        slope = (backpart - frontpart)/ (array_x[array_x.length-1] - array_x[0])\n\n        console.log(frontpart + ' ' + backpart + ' ' + slope)\n\n        for(var i=0; i &lt; array_y.length; i++){\n            array_y[i]-=slope * (array_x[i] - array_x[0]) + frontpart\n        }\n\n    }\n\n    if (substraction_mode == 'Substract Curved' &amp;&amp; substraction_value &gt; 0.0){\n\n        /* \n        Taken from Massign Paper (and UniDEC)\n        First creates an array that matches the data but has the minimum value within a window of +/- buff.\n        Then, smooths the minimum array with a Gaussian filter of width buff * 2 to form the background array.\n        Finally, subtracts the background array from the data intensities.\n        :param datatop: Data array\n        :param buff: Width parameter\n        :return: Subtracted data\n        \"\"\"\n        length = len(datatop)\n        mins = list(range(0, length))\n        indexes = list(range(0, length))\n        for i in indexes:\n            mins[i] = np.amin(datatop[int(max([0, i - abs(buff)])):int(min([i + abs(buff), length])), 1])\n        background = filt.gaussian_filter(mins, abs(buff) * 2)\n        datatop[:, 1] = datatop[:, 1] - background\n        return datatop\n        */\n\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        var len_y=array_y.length\n        var mins= []\n        for(i=0; i &lt; len_y; i++){\n            low_ind=Math.max(0, i-n_points)\n            upp_ind=Math.min(len_y, i+n_points)\n            deduct_min=100.0\n            for (j=low_ind; j&lt; upp_ind; j++){\n                if(deduct_min &gt; array_y[j]){\n                    deduct_min=array_y[j]\n                }\n            }\n            // console.log(low_ind + ' ' + upp_ind + ' ' + deduct_min)\n            mins.push(deduct_min)\n        }\n        console.log('Array of minima created.')\n        temp_data={'mz':array_x, 'Intensity':mins}\n        temp_data=gaussian_filter(temp_data,2.0*substraction_value, 1)\n        mins=temp_data['Intensity']\n        console.log('Array of minima smoothened.')\n        for(var i=0; i&lt; len_y; i++){\n            array_y[i]-=mins[i]\n        }\n        console.log('Mimima from data deducted.')\n\n    }\n\n\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Baseline substraction complete.\")\n}\n\nfunction normalising_and_thresholding(data,intensity_threshold, sele){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    ///Normailisation\n    y_max = array_y[closest(array_y, 1000.0)]\n    var mult = 100.0/y_max\n    for (i=0; i&lt; array_y.length; i++){\n        array_y[i]=array_y[i]*mult\n    }\n    console.log('Normalisation complete')\n    ///Thresholding\n    console.log('Thresholding value: ' + intensity_threshold + ' %.')    \n    for (var i = array_y.length - 1; i &gt;= 0; i--) {\n        if (array_y[i] &lt; intensity_threshold) {\n            array_y[i] = 0.0   \n        }    \n    }\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Thresholding complete.\")\n}\n\nfunction data_processing(data, dtp, sele, ser_data, names, peak_mz){\n    var crop_dat=cropping_data(data, dtp['mz_low'][0], dtp['mz_upp'][0], sele, ser_data, names)\n    var nat_data=normalising_and_thresholding(crop_dat,dtp['intensity_threshold'][0])\n    var bld_data=baseline_substraction(nat_data, dtp['sub_mode'][0], dtp['sub_value'][0])\n    var smo_data=smoothing(bld_data, dtp['gau_sigma'][0],dtp['gau_rep'][0])\n    var final_data=normalising_and_thresholding(smo_data,0.0) // Renormailising\n    indexkrieg(final_data, sele, ser_data, names, peak_mz)\n    return final_data\n}\n\n\n\n\n\n\n\n\nx=cb_data['geometries']['x']\n\ni_closest=closest(proc_mz.data['mz'], x)\n// console.log(i_closest)\nlen_dat=proc_mz.data['mz'].length\n// console.log(len_dat)\nlow_ind=Math.max(0, i_closest-5)\n// console.log(low_ind)\nupp_ind=Math.min(len_dat-1, i_closest+5)\n// console.log(upp_ind)\nslice_for_max =[]\nfor (var i = low_ind; i &lt; upp_ind; i++) {\n\tslice_for_max.push(proc_mz.data['Intensity'][i])\n}\n// slice_for_max=proc_mz.data['Intensity'].splice(low_ind,upp_ind-low_ind)\n// console.log(slice_for_max)\ni_new_max=closest(slice_for_max, 100.0)\n// console.log(i_new_max)\ni_new_max+=low_ind\n// console.log(i_new_max)\n// console.log(low_ind + ' ' +  upp_ind-low_ind + ' ' +  slice_for_max + ' ' +  i_new_max)\n\n/// Get data source from Callback args\n\nvar data = proc_mz.data;\nvar peak_data={};\nvar act = ser_act.value;\n\nvar sele = {};\nvar ser_data={};\nvar act_data=aser_data.data;\nvar masses = series_masses.data;\n\nvar names = series_names;\n\n/// remember i in x gives ith element\nfor(i_ser in names){\n    sele[names[i_ser]]=series_sele[names[i_ser]].data;\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    peak_data[names[i_ser]]=peak_mz[names[i_ser]].data;\n}\n    \n\nfor(i_ser in names){\n    if (sele[names[i_ser]]['i_max'].length &gt; 0){\n        for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_max'].length; i_peak++){\n            if((sele[names[i_ser]]['i_low'][i_peak] &lt;= i_new_max) &amp;&amp; (sele[names[i_ser]]['i_upp'][i_peak] &gt;= i_new_max)){\n            \tsele[names[i_ser]]['i_max'][i_peak]     = i_new_max\n            \tser_data[names[i_ser]]['max_int'][i_peak] = data[\"Intensity\"][i_new_max]\n            \tser_data[names[i_ser]]['x_max'][i_peak]   = data['mz'][i_new_max]\n            \tpeak_data[names[i_ser]]['xs'][i_peak]     = [data['mz'][i_new_max], data['mz'][i_new_max]]\n        \t\tpeak_data[names[i_ser]]['ys'][i_peak]     = [0.0, data[\"Intensity\"][i_new_max]]\n            }\n  \t\t}\n    }\n}\nconsole.log('yep')\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('correction ok')\n\nDoMacSED(masses, ser_data, names, series_masses, posneg)\n\npeakprediction(masses,ser_data, act);\n\ndata2active_table(ser_data[act], aser_data, act);\n"},"id":"1263","type":"CustomJS"},{"attributes":{"code":" if(cb_obj.active == true){\n                              cb_obj.label='on'\n                            }\n                            else{\n                              cb_obj.label='off'\n                            }\n                            "},"id":"1565","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1681","type":"Selection"},"selection_policy":{"id":"1682","type":"UnionRenderers"}},"id":"1082","type":"AjaxDataSource"},{"attributes":{"args":{"DataProcessingParameters":{"id":"1158","type":"AjaxDataSource"}},"code":"var dtp = DataProcessingParameters.data\nif (cb_obj.name == 'cropping_slider'){\n\tdtp['mz_low'][0]= cb_obj.value[0]\n\tdtp['mz_upp'][0]= cb_obj.value[1]\n}\nelse{\n\tdtp[cb_obj.name][0]=cb_obj.value\n}\nDataProcessingParameters.change.emit()"},"id":"1564","type":"CustomJS"},{"attributes":{"args":{"aser_data":{"id":"1153","type":"AjaxDataSource"},"bg_mz":{"id":"1157","type":"AjaxDataSource"},"peak_mz":{"Series 1":{"id":"1075","type":"AjaxDataSource"},"Series 10":{"id":"1111","type":"AjaxDataSource"},"Series 11":{"id":"1115","type":"AjaxDataSource"},"Series 12":{"id":"1119","type":"AjaxDataSource"},"Series 13":{"id":"1123","type":"AjaxDataSource"},"Series 14":{"id":"1127","type":"AjaxDataSource"},"Series 15":{"id":"1131","type":"AjaxDataSource"},"Series 16":{"id":"1135","type":"AjaxDataSource"},"Series 17":{"id":"1139","type":"AjaxDataSource"},"Series 18":{"id":"1143","type":"AjaxDataSource"},"Series 19":{"id":"1147","type":"AjaxDataSource"},"Series 2":{"id":"1079","type":"AjaxDataSource"},"Series 20":{"id":"1151","type":"AjaxDataSource"},"Series 3":{"id":"1083","type":"AjaxDataSource"},"Series 4":{"id":"1087","type":"AjaxDataSource"},"Series 5":{"id":"1091","type":"AjaxDataSource"},"Series 6":{"id":"1095","type":"AjaxDataSource"},"Series 7":{"id":"1099","type":"AjaxDataSource"},"Series 8":{"id":"1103","type":"AjaxDataSource"},"Series 9":{"id":"1107","type":"AjaxDataSource"}},"posneg":{"id":"1257","type":"Select"},"pp_mean_data":{"id":"1246","type":"AjaxDataSource"},"pp_std_data":{"id":"1247","type":"AjaxDataSource"},"proc_mz":{"id":"1156","type":"AjaxDataSource"},"ser_act":{"id":"1252","type":"Select"},"series_data":{"Series 1":{"id":"1072","type":"AjaxDataSource"},"Series 10":{"id":"1108","type":"AjaxDataSource"},"Series 11":{"id":"1112","type":"AjaxDataSource"},"Series 12":{"id":"1116","type":"AjaxDataSource"},"Series 13":{"id":"1120","type":"AjaxDataSource"},"Series 14":{"id":"1124","type":"AjaxDataSource"},"Series 15":{"id":"1128","type":"AjaxDataSource"},"Series 16":{"id":"1132","type":"AjaxDataSource"},"Series 17":{"id":"1136","type":"AjaxDataSource"},"Series 18":{"id":"1140","type":"AjaxDataSource"},"Series 19":{"id":"1144","type":"AjaxDataSource"},"Series 2":{"id":"1076","type":"AjaxDataSource"},"Series 20":{"id":"1148","type":"AjaxDataSource"},"Series 3":{"id":"1080","type":"AjaxDataSource"},"Series 4":{"id":"1084","type":"AjaxDataSource"},"Series 5":{"id":"1088","type":"AjaxDataSource"},"Series 6":{"id":"1092","type":"AjaxDataSource"},"Series 7":{"id":"1096","type":"AjaxDataSource"},"Series 8":{"id":"1100","type":"AjaxDataSource"},"Series 9":{"id":"1104","type":"AjaxDataSource"}},"series_masses":{"id":"1152","type":"AjaxDataSource"},"series_mz":{"Series 1":{"id":"1074","type":"AjaxDataSource"},"Series 10":{"id":"1110","type":"AjaxDataSource"},"Series 11":{"id":"1114","type":"AjaxDataSource"},"Series 12":{"id":"1118","type":"AjaxDataSource"},"Series 13":{"id":"1122","type":"AjaxDataSource"},"Series 14":{"id":"1126","type":"AjaxDataSource"},"Series 15":{"id":"1130","type":"AjaxDataSource"},"Series 16":{"id":"1134","type":"AjaxDataSource"},"Series 17":{"id":"1138","type":"AjaxDataSource"},"Series 18":{"id":"1142","type":"AjaxDataSource"},"Series 19":{"id":"1146","type":"AjaxDataSource"},"Series 2":{"id":"1078","type":"AjaxDataSource"},"Series 20":{"id":"1150","type":"AjaxDataSource"},"Series 3":{"id":"1082","type":"AjaxDataSource"},"Series 4":{"id":"1086","type":"AjaxDataSource"},"Series 5":{"id":"1090","type":"AjaxDataSource"},"Series 6":{"id":"1094","type":"AjaxDataSource"},"Series 7":{"id":"1098","type":"AjaxDataSource"},"Series 8":{"id":"1102","type":"AjaxDataSource"},"Series 9":{"id":"1106","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1073","type":"AjaxDataSource"},"Series 10":{"id":"1109","type":"AjaxDataSource"},"Series 11":{"id":"1113","type":"AjaxDataSource"},"Series 12":{"id":"1117","type":"AjaxDataSource"},"Series 13":{"id":"1121","type":"AjaxDataSource"},"Series 14":{"id":"1125","type":"AjaxDataSource"},"Series 15":{"id":"1129","type":"AjaxDataSource"},"Series 16":{"id":"1133","type":"AjaxDataSource"},"Series 17":{"id":"1137","type":"AjaxDataSource"},"Series 18":{"id":"1141","type":"AjaxDataSource"},"Series 19":{"id":"1145","type":"AjaxDataSource"},"Series 2":{"id":"1077","type":"AjaxDataSource"},"Series 20":{"id":"1149","type":"AjaxDataSource"},"Series 3":{"id":"1081","type":"AjaxDataSource"},"Series 4":{"id":"1085","type":"AjaxDataSource"},"Series 5":{"id":"1089","type":"AjaxDataSource"},"Series 6":{"id":"1093","type":"AjaxDataSource"},"Series 7":{"id":"1097","type":"AjaxDataSource"},"Series 8":{"id":"1101","type":"AjaxDataSource"},"Series 9":{"id":"1105","type":"AjaxDataSource"}}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max, posneg){\n    sign = 1.0\n    if (posneg.value == \"Negative\"){\n        sign = -1.0\n    }\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h*sign)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data, series_mz){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        console.log(\"There are selections\")\n        bg_mz.data=backg_mz;\n    }\n    if (low_inds.length == 0) {\n        console.log(\"In BG mode\")\n        mz=[]\n        Intensity=[]\n        len_data=data['mz'].length\n        console.log(len_data)\n        for(i=0; i&lt;len_data; i++){\n            mz.push(data['mz'][i])\n            Intensity.push(data['Intensity'][i])\n        }\n        new_bg = {'mz': [mz], 'Intensity': [Intensity]}\n        bg_mz.data = new_bg\n\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_peak_lines(ser_data,peak_data, names){\n    for(i_ser in names){\n        if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n            peak_xy={'xs':[], 'ys':[]}\n            for(i_peak=0; i_peak &lt; ser_data[names[i_ser]]['x_low'].length; i_peak++){\n                peak_xy['xs'].push()\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n            }\n        }\n        series_sele[names[i_ser]].change.emit()\n    }\n    return;\n\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n        peak_data[act]['xs'].push([data['mz'][i_max], data['mz'][i_max]])\n        peak_data[act]['ys'].push([0.0, data[\"Intensity\"][i_max]])\n        console.log(act + ' ' + peak_data[act]['xs']+ ' ' + peak_data[act]['ys'])\n\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses, posneg){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'], posneg)\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                // masses[\"Old_Mass\"].push(MacSED_res[1][i])\n                // masses[\"Old_Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                // masses[\"Old_Mass\"][i] = MacSED_res[1][i]\n                // masses[\"Old_Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/*Finding indices for mz values (the martial name refers to a Linear Algebra lecture of Prof Valentin Blomer the program author \nattended as a first year studentat the University of Goettingen. The same Prof Blomer also told his students in the same lecture\nseries not to implement a BubbleSort algorithm which the author remembered and promptly implemented because of the short lists to \nsort. )*/\nfunction indexkrieg(data, sele, ser_data, names, peak_mz){\n    console.log('Indexkrieg eingeleitet.')\n    for(i_ser in names){\n        peak_xy={'xs':[], 'ys':[]}\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n                // Now correct intensity bc of smooothing etc\n                ser_data[names[i_ser]]['max_int'][i_peak]=data['Intensity'][sele[names[i_ser]]['i_max'][i_peak]];\n                peak_xy['xs'].push([ser_data[names[i_ser]]['x_max'][i_peak],ser_data[names[i_ser]]['x_max'][i_peak]])\n                peak_xy['ys'].push([0.0,ser_data[names[i_ser]]['max_int'][i_peak]])\n            }\n        }\n        peak_mz[names[i_ser]].data=peak_xy\n        series_sele[names[i_ser]].change.emit()\n        series_data[names[i_ser]].change.emit()\n    }\n    return;\n}\n\nfunction cropping_data(data, cropping_min, cropping_max, sele, ser_data, names){\n    i_min=closest(data['mz'],cropping_min)\n    i_max=closest(data['mz'],cropping_max)\n    len_data=data['mz'].length\n    console.log(i_min + ' ' + i_max)\n    // data['mz'].slice(i_min,i_max)\n    // data['Intensity'].slice(i_min,i_max)\n    // data['mz'].splice(0,cropping_min)\n    // data['Intensity'].splice(0,cropping_min)\n    mz=data['mz'].slice(i_min,i_max)\n    Intensity=data['Intensity'].slice(i_min,i_max)\n    new_data={'mz':mz, 'Intensity':Intensity}\n    return new_data\n}\n\nfunction gaussian_filter(data, sigma){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    var len_y=array_y.length\n    console.log('in gaussian')\n    min_dist=10\n    for(i=0; i&lt;array_x.length-2; i++){\n        dist=array_x[i+1]-array_x[i]\n        if(dist &lt; min_dist){\n            min_dist=dist\n        }\n    }\n    sigma2div2=0.5*sigma*sigma\n    var smooth_array=array_y\n    var trunc=Math.ceil(4*sigma/min_dist)    \n    for(i=0; i &lt; len_y; i++){\n        weights= new Array(2*trunc)\n        if((i&gt;trunc) &amp;&amp;  (i &lt; (len_y-1-trunc))){\n            arr_ind=0\n            sum_arr=0.0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            new_val=0.0\n            arr_ind=0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n    \n        if (i&lt;trunc){\n            new_val=0.0\n            arr_ind=0\n            sum_arr=0.0\n\n            for(j=0; j &lt;=i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                x=array_x[j] + array_x[i] - array_x[0] - array_x[0]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            arr_ind=0\n            for(j=0; j &lt;=i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n\n        if (i&gt;len_y-1-trunc){\n            arr_ind=0\n            sum_arr=0.0\n            new_val=0.0\n            for(j=i-trunc; j &lt; len_y; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n\n            }\n            var last_x2= 2*array_x[len_y-1] /// Multiply klast entry of array_x to get end point\n            for(j=len_y-1; j &gt; len_y -trunc; j--){\n                x= last_x2  - array_x[j] - array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n\n            arr_ind=0\n            for(j=i-trunc; j &lt;len_y; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            for(j=len_y-1; j &gt;len_y-trunc; j--){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n\n        smooth_array[i]=new_val\n        }\n        smooth_array[trunc]=0.5*(smooth_array[trunc+1]+smooth_array[trunc-1])\n        smooth_array[array_y.length-1-trunc]=0.5*(smooth_array[array_y.length-trunc]+smooth_array[array_y.length-trunc-2])\n        }\n        returndata={'mz':array_x, 'Intensity':smooth_array}\n    return returndata;\n}\n\nfunction smoothing(data, sigma, n){\n\n    if (sigma !=0.0){\n    n_gau=parseInt(n)\n    console.log('Applying Gaussian Filter of sigma=' + sigma + ' for ' + n_gau + ' times.')\n    for(i=0; i &lt; n_gau; i++){\n        data=gaussian_filter(data, sigma)\n        console.log('Gaussian Filter successful for ' + i + ' times.')\n\n    }\n    }\n    return data\n    console.log('Smoothing complete')\n}\n\nfunction baseline_substraction(data, substraction_mode, substraction_value){\n    console.log('Performing baseline substraction')\n    var array_x=data['mz']\n    var array_y=data['Intensity'] \n\n    if (substraction_mode == 'Substract Minimum' &amp;&amp; substraction_value &gt; 0.0){\n    console.log('Mode: ' + substraction_mode)\n    y_min = array_y[closest(array_y, 0.0)]\n    console.log('Minimum: ' + y_min + ' %.')\n    for(var i=0; i&lt; array_y.length; i++){\n        array_y[i]-=y_min\n    }\n    }\n\n    if (substraction_mode == 'Substract Line' &amp;&amp; substraction_value &gt; 0.0){\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        console.log(n_points)\n        var frontpart=0.0\n        var backpart =0.0\n        for(var i=0; i&lt; n_points; i++){\n            frontpart+=array_y[i]\n            backpart +=array_y[array_y.length-1-i]\n            console.log(frontpart + ' ' + backpart)\n\n        }\n        frontpart = frontpart / n_points\n        backpart  =  backpart / n_points\n        slope = (backpart - frontpart)/ (array_x[array_x.length-1] - array_x[0])\n\n        console.log(frontpart + ' ' + backpart + ' ' + slope)\n\n        for(var i=0; i &lt; array_y.length; i++){\n            array_y[i]-=slope * (array_x[i] - array_x[0]) + frontpart\n        }\n\n    }\n\n    if (substraction_mode == 'Substract Curved' &amp;&amp; substraction_value &gt; 0.0){\n\n        /* \n        Taken from Massign Paper (and UniDEC)\n        First creates an array that matches the data but has the minimum value within a window of +/- buff.\n        Then, smooths the minimum array with a Gaussian filter of width buff * 2 to form the background array.\n        Finally, subtracts the background array from the data intensities.\n        :param datatop: Data array\n        :param buff: Width parameter\n        :return: Subtracted data\n        \"\"\"\n        length = len(datatop)\n        mins = list(range(0, length))\n        indexes = list(range(0, length))\n        for i in indexes:\n            mins[i] = np.amin(datatop[int(max([0, i - abs(buff)])):int(min([i + abs(buff), length])), 1])\n        background = filt.gaussian_filter(mins, abs(buff) * 2)\n        datatop[:, 1] = datatop[:, 1] - background\n        return datatop\n        */\n\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        var len_y=array_y.length\n        var mins= []\n        for(i=0; i &lt; len_y; i++){\n            low_ind=Math.max(0, i-n_points)\n            upp_ind=Math.min(len_y, i+n_points)\n            deduct_min=100.0\n            for (j=low_ind; j&lt; upp_ind; j++){\n                if(deduct_min &gt; array_y[j]){\n                    deduct_min=array_y[j]\n                }\n            }\n            // console.log(low_ind + ' ' + upp_ind + ' ' + deduct_min)\n            mins.push(deduct_min)\n        }\n        console.log('Array of minima created.')\n        temp_data={'mz':array_x, 'Intensity':mins}\n        temp_data=gaussian_filter(temp_data,2.0*substraction_value, 1)\n        mins=temp_data['Intensity']\n        console.log('Array of minima smoothened.')\n        for(var i=0; i&lt; len_y; i++){\n            array_y[i]-=mins[i]\n        }\n        console.log('Mimima from data deducted.')\n\n    }\n\n\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Baseline substraction complete.\")\n}\n\nfunction normalising_and_thresholding(data,intensity_threshold, sele){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    ///Normailisation\n    y_max = array_y[closest(array_y, 1000.0)]\n    var mult = 100.0/y_max\n    for (i=0; i&lt; array_y.length; i++){\n        array_y[i]=array_y[i]*mult\n    }\n    console.log('Normalisation complete')\n    ///Thresholding\n    console.log('Thresholding value: ' + intensity_threshold + ' %.')    \n    for (var i = array_y.length - 1; i &gt;= 0; i--) {\n        if (array_y[i] &lt; intensity_threshold) {\n            array_y[i] = 0.0   \n        }    \n    }\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Thresholding complete.\")\n}\n\nfunction data_processing(data, dtp, sele, ser_data, names, peak_mz){\n    var crop_dat=cropping_data(data, dtp['mz_low'][0], dtp['mz_upp'][0], sele, ser_data, names)\n    var nat_data=normalising_and_thresholding(crop_dat,dtp['intensity_threshold'][0])\n    var bld_data=baseline_substraction(nat_data, dtp['sub_mode'][0], dtp['sub_value'][0])\n    var smo_data=smoothing(bld_data, dtp['gau_sigma'][0],dtp['gau_rep'][0])\n    var final_data=normalising_and_thresholding(smo_data,0.0) // Renormailising\n    indexkrieg(final_data, sele, ser_data, names, peak_mz)\n    return final_data\n}\n\n\n\n\n\n\n\n\n/// Get data source from Callback args\n\nvar data = proc_mz.data;\nvar act = ser_act.value;\nvar peak_data={};\n\nvar sele = {};\nvar ser_data={};\nvar act_data=aser_data.data;\nvar masses = series_masses.data;\n\nvar names = series_names;\n\n/// remember i in x gives ith element\nfor(i_ser in names){\n    sele[names[i_ser]]=series_sele[names[i_ser]].data;\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n    peak_data[names[i_ser]]=peak_mz[names[i_ser]].data;\n}\n\n\n/// Boolean to decide whether to append new selection\n\nDoMacSED(masses, ser_data, names, series_masses, posneg)\ndata2active_table(ser_data[act], aser_data, act);"},"id":"1264","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1683","type":"Selection"},"selection_policy":{"id":"1684","type":"UnionRenderers"}},"id":"1083","type":"AjaxDataSource"},{"attributes":{"button_type":"success","callback":{"id":"1566","type":"CustomJS"},"height":30,"icon":null,"label":"Process Data","width":100},"id":"1567","type":"Button"},{"attributes":{"args":{"DataProcessingParameters":{"id":"1158","type":"AjaxDataSource"},"bg_mz":{"id":"1157","type":"AjaxDataSource"},"peak_mz":{"Series 1":{"id":"1075","type":"AjaxDataSource"},"Series 10":{"id":"1111","type":"AjaxDataSource"},"Series 11":{"id":"1115","type":"AjaxDataSource"},"Series 12":{"id":"1119","type":"AjaxDataSource"},"Series 13":{"id":"1123","type":"AjaxDataSource"},"Series 14":{"id":"1127","type":"AjaxDataSource"},"Series 15":{"id":"1131","type":"AjaxDataSource"},"Series 16":{"id":"1135","type":"AjaxDataSource"},"Series 17":{"id":"1139","type":"AjaxDataSource"},"Series 18":{"id":"1143","type":"AjaxDataSource"},"Series 19":{"id":"1147","type":"AjaxDataSource"},"Series 2":{"id":"1079","type":"AjaxDataSource"},"Series 20":{"id":"1151","type":"AjaxDataSource"},"Series 3":{"id":"1083","type":"AjaxDataSource"},"Series 4":{"id":"1087","type":"AjaxDataSource"},"Series 5":{"id":"1091","type":"AjaxDataSource"},"Series 6":{"id":"1095","type":"AjaxDataSource"},"Series 7":{"id":"1099","type":"AjaxDataSource"},"Series 8":{"id":"1103","type":"AjaxDataSource"},"Series 9":{"id":"1107","type":"AjaxDataSource"}},"proc_mz":{"id":"1156","type":"AjaxDataSource"},"raw_mz":{"id":"1155","type":"AjaxDataSource"},"series_data":{"Series 1":{"id":"1072","type":"AjaxDataSource"},"Series 10":{"id":"1108","type":"AjaxDataSource"},"Series 11":{"id":"1112","type":"AjaxDataSource"},"Series 12":{"id":"1116","type":"AjaxDataSource"},"Series 13":{"id":"1120","type":"AjaxDataSource"},"Series 14":{"id":"1124","type":"AjaxDataSource"},"Series 15":{"id":"1128","type":"AjaxDataSource"},"Series 16":{"id":"1132","type":"AjaxDataSource"},"Series 17":{"id":"1136","type":"AjaxDataSource"},"Series 18":{"id":"1140","type":"AjaxDataSource"},"Series 19":{"id":"1144","type":"AjaxDataSource"},"Series 2":{"id":"1076","type":"AjaxDataSource"},"Series 20":{"id":"1148","type":"AjaxDataSource"},"Series 3":{"id":"1080","type":"AjaxDataSource"},"Series 4":{"id":"1084","type":"AjaxDataSource"},"Series 5":{"id":"1088","type":"AjaxDataSource"},"Series 6":{"id":"1092","type":"AjaxDataSource"},"Series 7":{"id":"1096","type":"AjaxDataSource"},"Series 8":{"id":"1100","type":"AjaxDataSource"},"Series 9":{"id":"1104","type":"AjaxDataSource"}},"series_mz":{"Series 1":{"id":"1074","type":"AjaxDataSource"},"Series 10":{"id":"1110","type":"AjaxDataSource"},"Series 11":{"id":"1114","type":"AjaxDataSource"},"Series 12":{"id":"1118","type":"AjaxDataSource"},"Series 13":{"id":"1122","type":"AjaxDataSource"},"Series 14":{"id":"1126","type":"AjaxDataSource"},"Series 15":{"id":"1130","type":"AjaxDataSource"},"Series 16":{"id":"1134","type":"AjaxDataSource"},"Series 17":{"id":"1138","type":"AjaxDataSource"},"Series 18":{"id":"1142","type":"AjaxDataSource"},"Series 19":{"id":"1146","type":"AjaxDataSource"},"Series 2":{"id":"1078","type":"AjaxDataSource"},"Series 20":{"id":"1150","type":"AjaxDataSource"},"Series 3":{"id":"1082","type":"AjaxDataSource"},"Series 4":{"id":"1086","type":"AjaxDataSource"},"Series 5":{"id":"1090","type":"AjaxDataSource"},"Series 6":{"id":"1094","type":"AjaxDataSource"},"Series 7":{"id":"1098","type":"AjaxDataSource"},"Series 8":{"id":"1102","type":"AjaxDataSource"},"Series 9":{"id":"1106","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1073","type":"AjaxDataSource"},"Series 10":{"id":"1109","type":"AjaxDataSource"},"Series 11":{"id":"1113","type":"AjaxDataSource"},"Series 12":{"id":"1117","type":"AjaxDataSource"},"Series 13":{"id":"1121","type":"AjaxDataSource"},"Series 14":{"id":"1125","type":"AjaxDataSource"},"Series 15":{"id":"1129","type":"AjaxDataSource"},"Series 16":{"id":"1133","type":"AjaxDataSource"},"Series 17":{"id":"1137","type":"AjaxDataSource"},"Series 18":{"id":"1141","type":"AjaxDataSource"},"Series 19":{"id":"1145","type":"AjaxDataSource"},"Series 2":{"id":"1077","type":"AjaxDataSource"},"Series 20":{"id":"1149","type":"AjaxDataSource"},"Series 3":{"id":"1081","type":"AjaxDataSource"},"Series 4":{"id":"1085","type":"AjaxDataSource"},"Series 5":{"id":"1089","type":"AjaxDataSource"},"Series 6":{"id":"1093","type":"AjaxDataSource"},"Series 7":{"id":"1097","type":"AjaxDataSource"},"Series 8":{"id":"1101","type":"AjaxDataSource"},"Series 9":{"id":"1105","type":"AjaxDataSource"}}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max, posneg){\n    sign = 1.0\n    if (posneg.value == \"Negative\"){\n        sign = -1.0\n    }\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h*sign)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data, series_mz){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        console.log(\"There are selections\")\n        bg_mz.data=backg_mz;\n    }\n    if (low_inds.length == 0) {\n        console.log(\"In BG mode\")\n        mz=[]\n        Intensity=[]\n        len_data=data['mz'].length\n        console.log(len_data)\n        for(i=0; i&lt;len_data; i++){\n            mz.push(data['mz'][i])\n            Intensity.push(data['Intensity'][i])\n        }\n        new_bg = {'mz': [mz], 'Intensity': [Intensity]}\n        bg_mz.data = new_bg\n\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_peak_lines(ser_data,peak_data, names){\n    for(i_ser in names){\n        if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n            peak_xy={'xs':[], 'ys':[]}\n            for(i_peak=0; i_peak &lt; ser_data[names[i_ser]]['x_low'].length; i_peak++){\n                peak_xy['xs'].push()\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n            }\n        }\n        series_sele[names[i_ser]].change.emit()\n    }\n    return;\n\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n        peak_data[act]['xs'].push([data['mz'][i_max], data['mz'][i_max]])\n        peak_data[act]['ys'].push([0.0, data[\"Intensity\"][i_max]])\n        console.log(act + ' ' + peak_data[act]['xs']+ ' ' + peak_data[act]['ys'])\n\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses, posneg){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'], posneg)\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                // masses[\"Old_Mass\"].push(MacSED_res[1][i])\n                // masses[\"Old_Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                // masses[\"Old_Mass\"][i] = MacSED_res[1][i]\n                // masses[\"Old_Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/*Finding indices for mz values (the martial name refers to a Linear Algebra lecture of Prof Valentin Blomer the program author \nattended as a first year studentat the University of Goettingen. The same Prof Blomer also told his students in the same lecture\nseries not to implement a BubbleSort algorithm which the author remembered and promptly implemented because of the short lists to \nsort. )*/\nfunction indexkrieg(data, sele, ser_data, names, peak_mz){\n    console.log('Indexkrieg eingeleitet.')\n    for(i_ser in names){\n        peak_xy={'xs':[], 'ys':[]}\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n                // Now correct intensity bc of smooothing etc\n                ser_data[names[i_ser]]['max_int'][i_peak]=data['Intensity'][sele[names[i_ser]]['i_max'][i_peak]];\n                peak_xy['xs'].push([ser_data[names[i_ser]]['x_max'][i_peak],ser_data[names[i_ser]]['x_max'][i_peak]])\n                peak_xy['ys'].push([0.0,ser_data[names[i_ser]]['max_int'][i_peak]])\n            }\n        }\n        peak_mz[names[i_ser]].data=peak_xy\n        series_sele[names[i_ser]].change.emit()\n        series_data[names[i_ser]].change.emit()\n    }\n    return;\n}\n\nfunction cropping_data(data, cropping_min, cropping_max, sele, ser_data, names){\n    i_min=closest(data['mz'],cropping_min)\n    i_max=closest(data['mz'],cropping_max)\n    len_data=data['mz'].length\n    console.log(i_min + ' ' + i_max)\n    // data['mz'].slice(i_min,i_max)\n    // data['Intensity'].slice(i_min,i_max)\n    // data['mz'].splice(0,cropping_min)\n    // data['Intensity'].splice(0,cropping_min)\n    mz=data['mz'].slice(i_min,i_max)\n    Intensity=data['Intensity'].slice(i_min,i_max)\n    new_data={'mz':mz, 'Intensity':Intensity}\n    return new_data\n}\n\nfunction gaussian_filter(data, sigma){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    var len_y=array_y.length\n    console.log('in gaussian')\n    min_dist=10\n    for(i=0; i&lt;array_x.length-2; i++){\n        dist=array_x[i+1]-array_x[i]\n        if(dist &lt; min_dist){\n            min_dist=dist\n        }\n    }\n    sigma2div2=0.5*sigma*sigma\n    var smooth_array=array_y\n    var trunc=Math.ceil(4*sigma/min_dist)    \n    for(i=0; i &lt; len_y; i++){\n        weights= new Array(2*trunc)\n        if((i&gt;trunc) &amp;&amp;  (i &lt; (len_y-1-trunc))){\n            arr_ind=0\n            sum_arr=0.0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            new_val=0.0\n            arr_ind=0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n    \n        if (i&lt;trunc){\n            new_val=0.0\n            arr_ind=0\n            sum_arr=0.0\n\n            for(j=0; j &lt;=i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                x=array_x[j] + array_x[i] - array_x[0] - array_x[0]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            arr_ind=0\n            for(j=0; j &lt;=i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n\n        if (i&gt;len_y-1-trunc){\n            arr_ind=0\n            sum_arr=0.0\n            new_val=0.0\n            for(j=i-trunc; j &lt; len_y; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n\n            }\n            var last_x2= 2*array_x[len_y-1] /// Multiply klast entry of array_x to get end point\n            for(j=len_y-1; j &gt; len_y -trunc; j--){\n                x= last_x2  - array_x[j] - array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n\n            arr_ind=0\n            for(j=i-trunc; j &lt;len_y; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            for(j=len_y-1; j &gt;len_y-trunc; j--){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n\n        smooth_array[i]=new_val\n        }\n        smooth_array[trunc]=0.5*(smooth_array[trunc+1]+smooth_array[trunc-1])\n        smooth_array[array_y.length-1-trunc]=0.5*(smooth_array[array_y.length-trunc]+smooth_array[array_y.length-trunc-2])\n        }\n        returndata={'mz':array_x, 'Intensity':smooth_array}\n    return returndata;\n}\n\nfunction smoothing(data, sigma, n){\n\n    if (sigma !=0.0){\n    n_gau=parseInt(n)\n    console.log('Applying Gaussian Filter of sigma=' + sigma + ' for ' + n_gau + ' times.')\n    for(i=0; i &lt; n_gau; i++){\n        data=gaussian_filter(data, sigma)\n        console.log('Gaussian Filter successful for ' + i + ' times.')\n\n    }\n    }\n    return data\n    console.log('Smoothing complete')\n}\n\nfunction baseline_substraction(data, substraction_mode, substraction_value){\n    console.log('Performing baseline substraction')\n    var array_x=data['mz']\n    var array_y=data['Intensity'] \n\n    if (substraction_mode == 'Substract Minimum' &amp;&amp; substraction_value &gt; 0.0){\n    console.log('Mode: ' + substraction_mode)\n    y_min = array_y[closest(array_y, 0.0)]\n    console.log('Minimum: ' + y_min + ' %.')\n    for(var i=0; i&lt; array_y.length; i++){\n        array_y[i]-=y_min\n    }\n    }\n\n    if (substraction_mode == 'Substract Line' &amp;&amp; substraction_value &gt; 0.0){\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        console.log(n_points)\n        var frontpart=0.0\n        var backpart =0.0\n        for(var i=0; i&lt; n_points; i++){\n            frontpart+=array_y[i]\n            backpart +=array_y[array_y.length-1-i]\n            console.log(frontpart + ' ' + backpart)\n\n        }\n        frontpart = frontpart / n_points\n        backpart  =  backpart / n_points\n        slope = (backpart - frontpart)/ (array_x[array_x.length-1] - array_x[0])\n\n        console.log(frontpart + ' ' + backpart + ' ' + slope)\n\n        for(var i=0; i &lt; array_y.length; i++){\n            array_y[i]-=slope * (array_x[i] - array_x[0]) + frontpart\n        }\n\n    }\n\n    if (substraction_mode == 'Substract Curved' &amp;&amp; substraction_value &gt; 0.0){\n\n        /* \n        Taken from Massign Paper (and UniDEC)\n        First creates an array that matches the data but has the minimum value within a window of +/- buff.\n        Then, smooths the minimum array with a Gaussian filter of width buff * 2 to form the background array.\n        Finally, subtracts the background array from the data intensities.\n        :param datatop: Data array\n        :param buff: Width parameter\n        :return: Subtracted data\n        \"\"\"\n        length = len(datatop)\n        mins = list(range(0, length))\n        indexes = list(range(0, length))\n        for i in indexes:\n            mins[i] = np.amin(datatop[int(max([0, i - abs(buff)])):int(min([i + abs(buff), length])), 1])\n        background = filt.gaussian_filter(mins, abs(buff) * 2)\n        datatop[:, 1] = datatop[:, 1] - background\n        return datatop\n        */\n\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        var len_y=array_y.length\n        var mins= []\n        for(i=0; i &lt; len_y; i++){\n            low_ind=Math.max(0, i-n_points)\n            upp_ind=Math.min(len_y, i+n_points)\n            deduct_min=100.0\n            for (j=low_ind; j&lt; upp_ind; j++){\n                if(deduct_min &gt; array_y[j]){\n                    deduct_min=array_y[j]\n                }\n            }\n            // console.log(low_ind + ' ' + upp_ind + ' ' + deduct_min)\n            mins.push(deduct_min)\n        }\n        console.log('Array of minima created.')\n        temp_data={'mz':array_x, 'Intensity':mins}\n        temp_data=gaussian_filter(temp_data,2.0*substraction_value, 1)\n        mins=temp_data['Intensity']\n        console.log('Array of minima smoothened.')\n        for(var i=0; i&lt; len_y; i++){\n            array_y[i]-=mins[i]\n        }\n        console.log('Mimima from data deducted.')\n\n    }\n\n\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Baseline substraction complete.\")\n}\n\nfunction normalising_and_thresholding(data,intensity_threshold, sele){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    ///Normailisation\n    y_max = array_y[closest(array_y, 1000.0)]\n    var mult = 100.0/y_max\n    for (i=0; i&lt; array_y.length; i++){\n        array_y[i]=array_y[i]*mult\n    }\n    console.log('Normalisation complete')\n    ///Thresholding\n    console.log('Thresholding value: ' + intensity_threshold + ' %.')    \n    for (var i = array_y.length - 1; i &gt;= 0; i--) {\n        if (array_y[i] &lt; intensity_threshold) {\n            array_y[i] = 0.0   \n        }    \n    }\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Thresholding complete.\")\n}\n\nfunction data_processing(data, dtp, sele, ser_data, names, peak_mz){\n    var crop_dat=cropping_data(data, dtp['mz_low'][0], dtp['mz_upp'][0], sele, ser_data, names)\n    var nat_data=normalising_and_thresholding(crop_dat,dtp['intensity_threshold'][0])\n    var bld_data=baseline_substraction(nat_data, dtp['sub_mode'][0], dtp['sub_value'][0])\n    var smo_data=smoothing(bld_data, dtp['gau_sigma'][0],dtp['gau_rep'][0])\n    var final_data=normalising_and_thresholding(smo_data,0.0) // Renormailising\n    indexkrieg(final_data, sele, ser_data, names, peak_mz)\n    return final_data\n}\n\n\n\n\n\n\n\n\n/// Data Processing similar to UniDEC\n\n// 1. Load data\n// cb_obj.button_type='danger'\n// cb_obj.label='Processing data...'\nvar data = proc_mz.data;\nvar sele = {};\nvar ser_data={};\nvar dtp = DataProcessingParameters.data\n\nvar names = series_names;\n\n/// remember i in x gives ith element\nfor(i_ser in names){\n    sele[names[i_ser]]=series_sele[names[i_ser]].data;\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n}\n// 2. Process data\nproc_mz.data=data_processing(data, dtp, sele, ser_data, names, peak_mz)\n\n// 3. Put data into sources\ndata2sources(names, sele, proc_mz.data, series_mz);\n\n// 4. Tell console you are done\nconsole.log('Done')\ncb_obj.button_type='warning'\ncb_obj.label='Reprocess Data'\n"},"id":"1566","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1787","type":"Selection"},"selection_policy":{"id":"1788","type":"UnionRenderers"}},"id":"1084","type":"AjaxDataSource"},{"attributes":{"callback":{"id":"1263","type":"CustomJS"},"name":"Select Peak"},"id":"1266","type":"TapTool"},{"attributes":{"data_source":{"id":"1157","type":"AjaxDataSource"},"glyph":{"id":"1244","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1268","type":"CDSView"}},"id":"1267","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1827","type":"Selection"},"selection_policy":{"id":"1828","type":"UnionRenderers"}},"id":"1085","type":"AjaxDataSource"},{"attributes":{"button_type":"danger","callback":{"id":"1568","type":"CustomJS"},"height":30,"icon":null,"label":"Reset Processing","width":80},"id":"1569","type":"Button"},{"attributes":{"args":{"bg_mz":{"id":"1157","type":"AjaxDataSource"},"peak_mz":{"Series 1":{"id":"1075","type":"AjaxDataSource"},"Series 10":{"id":"1111","type":"AjaxDataSource"},"Series 11":{"id":"1115","type":"AjaxDataSource"},"Series 12":{"id":"1119","type":"AjaxDataSource"},"Series 13":{"id":"1123","type":"AjaxDataSource"},"Series 14":{"id":"1127","type":"AjaxDataSource"},"Series 15":{"id":"1131","type":"AjaxDataSource"},"Series 16":{"id":"1135","type":"AjaxDataSource"},"Series 17":{"id":"1139","type":"AjaxDataSource"},"Series 18":{"id":"1143","type":"AjaxDataSource"},"Series 19":{"id":"1147","type":"AjaxDataSource"},"Series 2":{"id":"1079","type":"AjaxDataSource"},"Series 20":{"id":"1151","type":"AjaxDataSource"},"Series 3":{"id":"1083","type":"AjaxDataSource"},"Series 4":{"id":"1087","type":"AjaxDataSource"},"Series 5":{"id":"1091","type":"AjaxDataSource"},"Series 6":{"id":"1095","type":"AjaxDataSource"},"Series 7":{"id":"1099","type":"AjaxDataSource"},"Series 8":{"id":"1103","type":"AjaxDataSource"},"Series 9":{"id":"1107","type":"AjaxDataSource"}},"proc_mz":{"id":"1156","type":"AjaxDataSource"},"process_data":{"id":"1567","type":"Button"},"raw_mz":{"id":"1155","type":"AjaxDataSource"},"series_data":{"Series 1":{"id":"1072","type":"AjaxDataSource"},"Series 10":{"id":"1108","type":"AjaxDataSource"},"Series 11":{"id":"1112","type":"AjaxDataSource"},"Series 12":{"id":"1116","type":"AjaxDataSource"},"Series 13":{"id":"1120","type":"AjaxDataSource"},"Series 14":{"id":"1124","type":"AjaxDataSource"},"Series 15":{"id":"1128","type":"AjaxDataSource"},"Series 16":{"id":"1132","type":"AjaxDataSource"},"Series 17":{"id":"1136","type":"AjaxDataSource"},"Series 18":{"id":"1140","type":"AjaxDataSource"},"Series 19":{"id":"1144","type":"AjaxDataSource"},"Series 2":{"id":"1076","type":"AjaxDataSource"},"Series 20":{"id":"1148","type":"AjaxDataSource"},"Series 3":{"id":"1080","type":"AjaxDataSource"},"Series 4":{"id":"1084","type":"AjaxDataSource"},"Series 5":{"id":"1088","type":"AjaxDataSource"},"Series 6":{"id":"1092","type":"AjaxDataSource"},"Series 7":{"id":"1096","type":"AjaxDataSource"},"Series 8":{"id":"1100","type":"AjaxDataSource"},"Series 9":{"id":"1104","type":"AjaxDataSource"}},"series_mz":{"Series 1":{"id":"1074","type":"AjaxDataSource"},"Series 10":{"id":"1110","type":"AjaxDataSource"},"Series 11":{"id":"1114","type":"AjaxDataSource"},"Series 12":{"id":"1118","type":"AjaxDataSource"},"Series 13":{"id":"1122","type":"AjaxDataSource"},"Series 14":{"id":"1126","type":"AjaxDataSource"},"Series 15":{"id":"1130","type":"AjaxDataSource"},"Series 16":{"id":"1134","type":"AjaxDataSource"},"Series 17":{"id":"1138","type":"AjaxDataSource"},"Series 18":{"id":"1142","type":"AjaxDataSource"},"Series 19":{"id":"1146","type":"AjaxDataSource"},"Series 2":{"id":"1078","type":"AjaxDataSource"},"Series 20":{"id":"1150","type":"AjaxDataSource"},"Series 3":{"id":"1082","type":"AjaxDataSource"},"Series 4":{"id":"1086","type":"AjaxDataSource"},"Series 5":{"id":"1090","type":"AjaxDataSource"},"Series 6":{"id":"1094","type":"AjaxDataSource"},"Series 7":{"id":"1098","type":"AjaxDataSource"},"Series 8":{"id":"1102","type":"AjaxDataSource"},"Series 9":{"id":"1106","type":"AjaxDataSource"}},"series_names":["Series 1","Series 2","Series 3","Series 4","Series 5","Series 6","Series 7","Series 8","Series 9","Series 10","Series 11","Series 12","Series 13","Series 14","Series 15","Series 16","Series 17","Series 18","Series 19","Series 20"],"series_sele":{"Series 1":{"id":"1073","type":"AjaxDataSource"},"Series 10":{"id":"1109","type":"AjaxDataSource"},"Series 11":{"id":"1113","type":"AjaxDataSource"},"Series 12":{"id":"1117","type":"AjaxDataSource"},"Series 13":{"id":"1121","type":"AjaxDataSource"},"Series 14":{"id":"1125","type":"AjaxDataSource"},"Series 15":{"id":"1129","type":"AjaxDataSource"},"Series 16":{"id":"1133","type":"AjaxDataSource"},"Series 17":{"id":"1137","type":"AjaxDataSource"},"Series 18":{"id":"1141","type":"AjaxDataSource"},"Series 19":{"id":"1145","type":"AjaxDataSource"},"Series 2":{"id":"1077","type":"AjaxDataSource"},"Series 20":{"id":"1149","type":"AjaxDataSource"},"Series 3":{"id":"1081","type":"AjaxDataSource"},"Series 4":{"id":"1085","type":"AjaxDataSource"},"Series 5":{"id":"1089","type":"AjaxDataSource"},"Series 6":{"id":"1093","type":"AjaxDataSource"},"Series 7":{"id":"1097","type":"AjaxDataSource"},"Series 8":{"id":"1101","type":"AjaxDataSource"},"Series 9":{"id":"1105","type":"AjaxDataSource"}}},"code":"/// Define closest, BubbleSort Peak Prediction and MacSED\n\n\nfunction mean_func(array){\n    mean_res = 0.0\n    for (i=0; i &lt; array.length; i++){\n        mean_res += array[i]\n    }\n    mean_res = mean_res / array.length\n    return mean_res\n}\n\n function std_func(array){\n    mean_res = mean_func(array)\n    std_res = 0\n    for (i=0; i &lt; array.length; i++){\n        std_res += (array[i]-mean_res)*(array[i]-mean_res)\n    }\n    std_res = Math.sqrt(std_res / (array.length-1))\n    return std_res\n}\n\n\nfunction closest(array,num){\n    var i=0;\n    var minDiff=10000;\n    var i_closest;\n    for(i=0; i&lt; array.length; i++){\n        var m=Math.abs(Math.abs(num)-array[i]);\n        if(m&lt;minDiff){ \n            minDiff=m; \n            i_closest=i; \n        }\n    }\n    return i_closest;\n}\n\nfunction BubbleSort(array){\nvar array= array;\n  for(i=0; i &lt; array.length-1; i++){\n        for(j=0; j &lt; array.length-1; j++){\n            if(array[j] &gt; array[j+1]){\n                dummy = array[j];\n                array[j] = array[j+1];\n                array[j+1] = dummy;\n            }\n        }\n        j=0\n    }\n    return array;\n}\n\nfunction MacSED(series_i_max, posneg){\n    sign = 1.0\n    if (posneg.value == \"Negative\"){\n        sign = -1.0\n    }\n    z_max=200\n    m_h=1.00784\n    maxima = []\n    for(i=series_i_max.length-1; i&gt;=0; i--){\n        maxima.push(series_i_max[i])\n    }\n    mass_mat = []\n    charge_mat = []\n    mean_arr = []\n    std_arr = []\n\n    for(z=0; z &lt; z_max; z++){\n        mass_mat.push([])\n        charge_mat.push([])\n        for(i_m=0; i_m &lt; maxima.length; i_m++){\n            mass_mat[z].push((z+1+i_m)*maxima[i_m]-(z+1+i_m)*m_h*sign)\n            charge_mat[z].push(z+1+i_m)\n        }\n        mean_arr.push(mean_func(mass_mat[z]))\n        std_arr.push(  std_func(mass_mat[z]))\n    }\n    i_best = closest(std_arr, 0.0)\n    charge_arr=[]\n\n    for (i=charge_mat[i_best].length-1; i&gt;=0; i--){\n        charge_arr.push(charge_mat[i_best][i])\n    } \n\n    res = [mean_arr[i_best], std_arr[i_best], charge_arr]\n    return res\n\n}\n\nfunction peakprediction(masses,ser_data, act){\n    var ppm_data = { \"xs\":[], \"ys\":[] }\n    var pps_data = { \"xs\":[], \"ys\":[] }\n\n    if (act != 'Background'){\n        if (ser_data[act]['x_max'].length &gt; 1){\n            i_act = 0\n            /// Find correct series index for calculing peak prediction\n            for (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n                if (masses['Series'][i_ms] == act){\n                    i_act=i_ms\n                }\n            }\n\n            ppm_low = masses['Mass'][i_act] / (ser_data[act]['charge'][0] + 1)\n            ppm_upp = masses['Mass'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n            pps_std_low = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][0] + 1)\n            pps_std_upp = masses['Uncertainty'][i_act] / (ser_data[act]['charge'][ser_data[act]['charge'].length -1] - 1)\n\n            ppm_data['xs'].push([ppm_low, ppm_low])\n            ppm_data['xs'].push([ppm_upp, ppm_upp])\n            ppm_data['ys'].push([0.0, 100.0])\n            ppm_data['ys'].push([0.0, 100.0])\n\n            pps_data['xs'].push([ppm_low - 5 * pps_std_low, ppm_low - 5 * pps_std_low])\n            pps_data['xs'].push([ppm_low + 5 * pps_std_low, ppm_low + 5 * pps_std_low])\n            pps_data['xs'].push([ppm_upp - 5 * pps_std_upp, ppm_upp - 5 * pps_std_upp])\n            pps_data['xs'].push([ppm_upp + 5 * pps_std_upp, ppm_upp + 5 * pps_std_upp])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n            pps_data['ys'].push([0.0, 100.0])\n        }\n    }\n    pp_mean_data.data = ppm_data;\n    pp_std_data.data  = pps_data;\n    console.log('peakprediction ok')\n}\n\nfunction data2sources(names, sele, data, series_mz){\n    sers_mz = {}\n    backg_mz = {'Intensity':[], 'mz':[]}\n    for (i in names){\n        sers_mz[names[i]]  = {'Intensity':[], 'mz':[]}\n    }\n\n    low_inds=[]\n    upp_inds=[]\n\n    // Put background to intensity \n\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                overlap_low = 1;\n                overlap_upp = 1;\n\n                if(sele[names[i_ser]]['i_low'][i_peak] &lt;= 1){\n                    overlap_low = sele[names[i_ser]]['i_low'][i_peak]\n                }\n                if(sele[names[i_ser]]['i_upp'][i_peak] &gt;= data['Intensity'].length-1){\n                    overlap_upp = data['Intensity'].length - sele[names[i_ser]]['i_upp'][i_peak]\n                }\n                low_inds.push(sele[names[i_ser]]['i_low'][i_peak])\n                upp_inds.push(sele[names[i_ser]]['i_upp'][i_peak])\n                mz=[]\n                Intensity=[]\n                for(i_dat=sele[names[i_ser]]['i_low'][i_peak] - overlap_low; i_dat &lt; sele[names[i_ser]]['i_upp'][i_peak] + overlap_upp; i_dat++){\n                    mz.push(data['mz'][i_dat])\n                    Intensity.push(data['Intensity'][i_dat]) \n                }\n                sers_mz[names[i_ser]]['mz'].push(mz)\n                sers_mz[names[i_ser]]['Intensity'].push(Intensity)\n            }\n        }\n        series_mz[names[i_ser]].data=sers_mz[names[i_ser]]\n    }\n    BubbleSort(low_inds)\n    BubbleSort(upp_inds)\n\n    if (low_inds[0] &gt; 0){\n        mz=[]\n        Intensity=[]\n        for (j=0; j &lt; low_inds[0]; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n    if (upp_inds[upp_inds.length-1] &lt; data['mz'].length){\n        mz=[]\n        Intensity=[]\n        for (j=upp_inds[upp_inds.length-1]; j &lt; data['mz'].length; j++){\n            mz.push(data['mz'][j])\n            Intensity.push(data['Intensity'][j])\n        }\n        backg_mz['mz'].push(mz)\n        backg_mz['Intensity'].push(Intensity)\n    }\n\n    if (low_inds.length &gt; 1){\n        for(i=1; i &lt; low_inds.length; i++){\n            mz=[]\n            Intensity=[]\n            for (j=upp_inds[i-1]; j &lt; low_inds[i]; j++){\n                mz.push(data['mz'][j])\n                Intensity.push(data['Intensity'][j])\n            }\n            backg_mz['mz'].push(mz)\n            backg_mz['Intensity'].push(Intensity)\n        }\n    }\n    if (low_inds.length &gt; 0){\n        console.log(\"There are selections\")\n        bg_mz.data=backg_mz;\n    }\n    if (low_inds.length == 0) {\n        console.log(\"In BG mode\")\n        mz=[]\n        Intensity=[]\n        len_data=data['mz'].length\n        console.log(len_data)\n        for(i=0; i&lt;len_data; i++){\n            mz.push(data['mz'][i])\n            Intensity.push(data['Intensity'][i])\n        }\n        new_bg = {'mz': [mz], 'Intensity': [Intensity]}\n        bg_mz.data = new_bg\n\n    }\n    console.log('data2sources ok')\n}\n\nfunction data2active_table(new_act_data, aser_data, act){\n\n     /// Fill shown table with active series\n    let adat = { 'x_low':[], 'x_upp':[], 'x_max':[], 'max_int':[], 'charge':[]}\n    if (act != 'Background'){\n        for (i=0; i &lt; new_act_data['x_low'].length; i++){\n            adat['x_low'].push(new_act_data['x_low'][i])\n            adat['x_upp'].push(new_act_data['x_upp'][i])\n            adat['x_max'].push(new_act_data['x_max'][i])\n            adat['max_int'].push(new_act_data['max_int'][i])\n            adat['charge'].push(new_act_data['charge'][i])  \n        }\n    }\n    \n    aser_data.data = adat;\n    console.log('data2active_table ok')\n}\n\n/// Loops &amp; logics which makes sure overlapping selections are handled cor-\n/// rectly (Compare i_low, and i_upp to prev selections and act accordingly)\n\nfunction sele_logics(i_low, i_upp, sele, names,ser_data, act){\n    nopush = false;\n    console.log(act)\n    if (act != 'Background'){\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=sele[names[i_ser]]['i_low'].length-1; i_peak &gt;= 0 ; i_peak--){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    }\n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak]  \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_upp];\n                        nopush = true;\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] == act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_low];\n                        nopush = true;\n                    }\n                    /// i_low in old selection of different series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of different series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; names[i_ser] != act){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    }\n    else{\n        for(i_ser in names){\n            if (sele[names[i_ser]]['i_low'].length &gt; 0){\n                for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n\n                    /// Case new selection in an old selection (WORKS)\n                    if( i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] ){\n                        nopush = true;\n                    } \n                    /// Case old selection in new selection\n                    else if ( i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_low'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_upp'].splice(i_peak,1);\n                        sele[names[i_ser]]['i_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_low'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_upp'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['x_max'].splice(i_peak,1);\n                        ser_data[names[i_ser]]['max_int'].splice(i_peak,1);\n                    }\n                    /// i_low in old selection of same series\n                    else if (i_low &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_low &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_upp &gt;= sele[names[i_ser]]['i_upp'][i_peak] ){\n                        sele[names[i_ser]]['i_upp'][i_peak]=i_low;\n                        ser_data[names[i_ser]]['x_upp'][i_peak]=data['mz'][i_low];\n                    }\n                    /// i_upp in old selection of same series\n                    else if (i_upp &gt; sele[names[i_ser]]['i_low'][i_peak] &amp;&amp; i_upp &lt; sele[names[i_ser]]['i_upp'][i_peak] \n                             &amp;&amp; i_low &lt;= sele[names[i_ser]]['i_low'][i_peak] ){\n                        sele[names[i_ser]]['i_low'][i_peak]=i_upp;\n                        ser_data[names[i_ser]]['x_low'][i_peak]=data['mz'][i_upp];\n                    }\n                } \n            }\n        }\n    nopush = true;\n    }\n    return nopush;\n}\n\nfunction push_peak_lines(ser_data,peak_data, names){\n    for(i_ser in names){\n        if (ser_data[names[i_ser]]['x_low'].length &gt; 0){\n            peak_xy={'xs':[], 'ys':[]}\n            for(i_peak=0; i_peak &lt; ser_data[names[i_ser]]['x_low'].length; i_peak++){\n                peak_xy['xs'].push()\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n            }\n        }\n        series_sele[names[i_ser]].change.emit()\n    }\n    return;\n\n}\n\nfunction push_sele(nopush, sele, data, i_low, i_upp, ser_data, act, peak_data){\n/// Append new indices if selection requires it\n\n    if (nopush == false){\n\n        /// Find index of maximum (i.e. closest to 100% intensity in spliced array) and correct for missing indices (i_low)\n\n        var data_to_find_max = [];\n        for(i_ind = i_low; i_ind &lt; i_upp; i_ind++){\n            data_to_find_max.push(data['Intensity'][i_ind]);\n        }\n\n        \n        i_max = closest(data_to_find_max, 100.0) + i_low\n\n        sele[act]['i_max'].push(i_max);\n        sele[act]['i_upp'].push(i_upp);\n        sele[act]['i_low'].push(i_low);\n\n        ser_data[act]['x_max'].push(data['mz'][i_max]);\n        ser_data[act]['x_upp'].push(data['mz'][i_upp]);\n        ser_data[act]['x_low'].push(data['mz'][i_low]);\n        ser_data[act]['max_int'].push(data[\"Intensity\"][i_max]);\n        peak_data[act]['xs'].push([data['mz'][i_max], data['mz'][i_max]])\n        peak_data[act]['ys'].push([0.0, data[\"Intensity\"][i_max]])\n        console.log(act + ' ' + peak_data[act]['xs']+ ' ' + peak_data[act]['ys'])\n\n         \n\n        if (ser_data[act]['x_max'].length &gt;1 ){\n            ser_data[act]['x_max'] = BubbleSort(ser_data[act]['x_max'])\n            ser_data[act]['x_upp'] = BubbleSort(ser_data[act]['x_upp'])\n            ser_data[act]['x_low'] = BubbleSort(ser_data[act]['x_low'])\n            sele[act]['i_max'] = BubbleSort(sele[act]['i_max'])\n            sele[act]['i_upp'] = BubbleSort(sele[act]['i_upp'])\n            sele[act]['i_low'] = BubbleSort(sele[act]['i_low'])\n            x = sele[act]['i_max']\n            for(i=0; i &lt; x.length; i++){\n                x[i]= data[\"Intensity\"][sele[act]['i_max'][i]]\n            }\n            ser_data[act][\"charge\"].push(0);\n\n            \n        }\n        else{\n            ser_data[act][\"charge\"].push(0);\n        }\n    }\n\n/// Selection of indices done, emit changes\n    for(i_ser in names){\n        peak_mz[names[i_ser]].change.emit()\n        series_sele[names[i_ser]].change.emit();\n        series_data[names[i_ser]].change.emit();\n    }\n    console.log('push_sele ok')\n}\n\n/// Do MacSED\n\nfunction DoMacSED(masses, ser_data, names, series_masses, posneg){\n    MacSED_res=[[],[],[]]\n    charges={}\n    for(i_ser in names){\n        if (sele[names[i_ser]]['i_max'].length &gt; 1){\n            mass_res=MacSED(ser_data[names[i_ser]]['x_max'], posneg)\n            charges[names[i_ser]]=ser_data[names[i_ser]][\"charge\"]\n            for(i_peak=0; i_peak &lt; mass_res[2].length; i_peak++){\n                charges[names[i_ser]][i_peak]=mass_res[2][i_peak]\n            }\n            series_data[names[i_ser]].change.emit()\n            MacSED_res[0].push(names[i_ser])\n            MacSED_res[1].push(mass_res[0])\n            MacSED_res[2].push(mass_res[1])\n\n        }\n    }\n\n    if (MacSED_res[0].length &gt; 0){\n        for (i=0; i &lt; MacSED_res[0].length; i++){\n            if(i &gt;= masses[\"Series\"].length){\n                masses[\"Series\"].push(MacSED_res[0][i])\n                masses[\"Mass\"].push(MacSED_res[1][i])\n                masses[\"Uncertainty\"].push(MacSED_res[2][i])\n                // masses[\"Old_Mass\"].push(MacSED_res[1][i])\n                // masses[\"Old_Uncertainty\"].push(MacSED_res[2][i])\n            }\n            else{\n                masses[\"Series\"][i] = MacSED_res[0][i]\n                masses[\"Mass\"][i] = MacSED_res[1][i]\n                masses[\"Uncertainty\"][i] = MacSED_res[2][i]\n                // masses[\"Old_Mass\"][i] = MacSED_res[1][i]\n                // masses[\"Old_Uncertainty\"][i] = MacSED_res[2][i]\n            }\n        }\n    }\n    series_masses.change.emit();\n    console.log('MacSED ok')\n}\n/*Finding indices for mz values (the martial name refers to a Linear Algebra lecture of Prof Valentin Blomer the program author \nattended as a first year studentat the University of Goettingen. The same Prof Blomer also told his students in the same lecture\nseries not to implement a BubbleSort algorithm which the author remembered and promptly implemented because of the short lists to \nsort. )*/\nfunction indexkrieg(data, sele, ser_data, names, peak_mz){\n    console.log('Indexkrieg eingeleitet.')\n    for(i_ser in names){\n        peak_xy={'xs':[], 'ys':[]}\n        if (sele[names[i_ser]]['i_low'].length &gt; 0){\n            for(i_peak=0; i_peak &lt; sele[names[i_ser]]['i_low'].length; i_peak++){\n                sele[names[i_ser]]['i_low'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_low'][i_peak]);\n                sele[names[i_ser]]['i_upp'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_upp'][i_peak]);\n                sele[names[i_ser]]['i_max'][i_peak]=closest(data['mz'], ser_data[names[i_ser]]['x_max'][i_peak]);\n                // Now correct intensity bc of smooothing etc\n                ser_data[names[i_ser]]['max_int'][i_peak]=data['Intensity'][sele[names[i_ser]]['i_max'][i_peak]];\n                peak_xy['xs'].push([ser_data[names[i_ser]]['x_max'][i_peak],ser_data[names[i_ser]]['x_max'][i_peak]])\n                peak_xy['ys'].push([0.0,ser_data[names[i_ser]]['max_int'][i_peak]])\n            }\n        }\n        peak_mz[names[i_ser]].data=peak_xy\n        series_sele[names[i_ser]].change.emit()\n        series_data[names[i_ser]].change.emit()\n    }\n    return;\n}\n\nfunction cropping_data(data, cropping_min, cropping_max, sele, ser_data, names){\n    i_min=closest(data['mz'],cropping_min)\n    i_max=closest(data['mz'],cropping_max)\n    len_data=data['mz'].length\n    console.log(i_min + ' ' + i_max)\n    // data['mz'].slice(i_min,i_max)\n    // data['Intensity'].slice(i_min,i_max)\n    // data['mz'].splice(0,cropping_min)\n    // data['Intensity'].splice(0,cropping_min)\n    mz=data['mz'].slice(i_min,i_max)\n    Intensity=data['Intensity'].slice(i_min,i_max)\n    new_data={'mz':mz, 'Intensity':Intensity}\n    return new_data\n}\n\nfunction gaussian_filter(data, sigma){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    var len_y=array_y.length\n    console.log('in gaussian')\n    min_dist=10\n    for(i=0; i&lt;array_x.length-2; i++){\n        dist=array_x[i+1]-array_x[i]\n        if(dist &lt; min_dist){\n            min_dist=dist\n        }\n    }\n    sigma2div2=0.5*sigma*sigma\n    var smooth_array=array_y\n    var trunc=Math.ceil(4*sigma/min_dist)    \n    for(i=0; i &lt; len_y; i++){\n        weights= new Array(2*trunc)\n        if((i&gt;trunc) &amp;&amp;  (i &lt; (len_y-1-trunc))){\n            arr_ind=0\n            sum_arr=0.0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            new_val=0.0\n            arr_ind=0\n            for(j=i-trunc; j &lt;i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n    \n        if (i&lt;trunc){\n            new_val=0.0\n            arr_ind=0\n            sum_arr=0.0\n\n            for(j=0; j &lt;=i+trunc; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                x=array_x[j] + array_x[i] - array_x[0] - array_x[0]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n            arr_ind=0\n            for(j=0; j &lt;=i+trunc; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            /// Part on the left which gets reflected\n            for(j=0; j &lt;=trunc-i; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            smooth_array[i]=new_val\n        }\n\n        if (i&gt;len_y-1-trunc){\n            arr_ind=0\n            sum_arr=0.0\n            new_val=0.0\n            for(j=i-trunc; j &lt; len_y; j++){\n                x=array_x[j]-array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n\n            }\n            var last_x2= 2*array_x[len_y-1] /// Multiply klast entry of array_x to get end point\n            for(j=len_y-1; j &gt; len_y -trunc; j--){\n                x= last_x2  - array_x[j] - array_x[i]\n                gauss_exponent = x*x/sigma2div2\n                weights[arr_ind] = Math.exp(-gauss_exponent)\n                sum_arr+= Math.exp(-gauss_exponent)\n                arr_ind+=1\n            }\n\n            arr_ind=0\n            for(j=i-trunc; j &lt;len_y; j++){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n            for(j=len_y-1; j &gt;len_y-trunc; j--){\n                new_val+= array_y[j]*weights[arr_ind]/sum_arr\n                arr_ind+=1\n            }\n\n        smooth_array[i]=new_val\n        }\n        smooth_array[trunc]=0.5*(smooth_array[trunc+1]+smooth_array[trunc-1])\n        smooth_array[array_y.length-1-trunc]=0.5*(smooth_array[array_y.length-trunc]+smooth_array[array_y.length-trunc-2])\n        }\n        returndata={'mz':array_x, 'Intensity':smooth_array}\n    return returndata;\n}\n\nfunction smoothing(data, sigma, n){\n\n    if (sigma !=0.0){\n    n_gau=parseInt(n)\n    console.log('Applying Gaussian Filter of sigma=' + sigma + ' for ' + n_gau + ' times.')\n    for(i=0; i &lt; n_gau; i++){\n        data=gaussian_filter(data, sigma)\n        console.log('Gaussian Filter successful for ' + i + ' times.')\n\n    }\n    }\n    return data\n    console.log('Smoothing complete')\n}\n\nfunction baseline_substraction(data, substraction_mode, substraction_value){\n    console.log('Performing baseline substraction')\n    var array_x=data['mz']\n    var array_y=data['Intensity'] \n\n    if (substraction_mode == 'Substract Minimum' &amp;&amp; substraction_value &gt; 0.0){\n    console.log('Mode: ' + substraction_mode)\n    y_min = array_y[closest(array_y, 0.0)]\n    console.log('Minimum: ' + y_min + ' %.')\n    for(var i=0; i&lt; array_y.length; i++){\n        array_y[i]-=y_min\n    }\n    }\n\n    if (substraction_mode == 'Substract Line' &amp;&amp; substraction_value &gt; 0.0){\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        console.log(n_points)\n        var frontpart=0.0\n        var backpart =0.0\n        for(var i=0; i&lt; n_points; i++){\n            frontpart+=array_y[i]\n            backpart +=array_y[array_y.length-1-i]\n            console.log(frontpart + ' ' + backpart)\n\n        }\n        frontpart = frontpart / n_points\n        backpart  =  backpart / n_points\n        slope = (backpart - frontpart)/ (array_x[array_x.length-1] - array_x[0])\n\n        console.log(frontpart + ' ' + backpart + ' ' + slope)\n\n        for(var i=0; i &lt; array_y.length; i++){\n            array_y[i]-=slope * (array_x[i] - array_x[0]) + frontpart\n        }\n\n    }\n\n    if (substraction_mode == 'Substract Curved' &amp;&amp; substraction_value &gt; 0.0){\n\n        /* \n        Taken from Massign Paper (and UniDEC)\n        First creates an array that matches the data but has the minimum value within a window of +/- buff.\n        Then, smooths the minimum array with a Gaussian filter of width buff * 2 to form the background array.\n        Finally, subtracts the background array from the data intensities.\n        :param datatop: Data array\n        :param buff: Width parameter\n        :return: Subtracted data\n        \"\"\"\n        length = len(datatop)\n        mins = list(range(0, length))\n        indexes = list(range(0, length))\n        for i in indexes:\n            mins[i] = np.amin(datatop[int(max([0, i - abs(buff)])):int(min([i + abs(buff), length])), 1])\n        background = filt.gaussian_filter(mins, abs(buff) * 2)\n        datatop[:, 1] = datatop[:, 1] - background\n        return datatop\n        */\n\n        console.log('Mode: ' + substraction_mode)\n        var n_points=Math.ceil(Number(substraction_value))\n        var len_y=array_y.length\n        var mins= []\n        for(i=0; i &lt; len_y; i++){\n            low_ind=Math.max(0, i-n_points)\n            upp_ind=Math.min(len_y, i+n_points)\n            deduct_min=100.0\n            for (j=low_ind; j&lt; upp_ind; j++){\n                if(deduct_min &gt; array_y[j]){\n                    deduct_min=array_y[j]\n                }\n            }\n            // console.log(low_ind + ' ' + upp_ind + ' ' + deduct_min)\n            mins.push(deduct_min)\n        }\n        console.log('Array of minima created.')\n        temp_data={'mz':array_x, 'Intensity':mins}\n        temp_data=gaussian_filter(temp_data,2.0*substraction_value, 1)\n        mins=temp_data['Intensity']\n        console.log('Array of minima smoothened.')\n        for(var i=0; i&lt; len_y; i++){\n            array_y[i]-=mins[i]\n        }\n        console.log('Mimima from data deducted.')\n\n    }\n\n\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Baseline substraction complete.\")\n}\n\nfunction normalising_and_thresholding(data,intensity_threshold, sele){\n    var array_x=data['mz']\n    var array_y=data['Intensity']\n    ///Normailisation\n    y_max = array_y[closest(array_y, 1000.0)]\n    var mult = 100.0/y_max\n    for (i=0; i&lt; array_y.length; i++){\n        array_y[i]=array_y[i]*mult\n    }\n    console.log('Normalisation complete')\n    ///Thresholding\n    console.log('Thresholding value: ' + intensity_threshold + ' %.')    \n    for (var i = array_y.length - 1; i &gt;= 0; i--) {\n        if (array_y[i] &lt; intensity_threshold) {\n            array_y[i] = 0.0   \n        }    \n    }\n    returndata={'mz':array_x, 'Intensity':array_y}\n    return returndata;\n    console.log(\"Thresholding complete.\")\n}\n\nfunction data_processing(data, dtp, sele, ser_data, names, peak_mz){\n    var crop_dat=cropping_data(data, dtp['mz_low'][0], dtp['mz_upp'][0], sele, ser_data, names)\n    var nat_data=normalising_and_thresholding(crop_dat,dtp['intensity_threshold'][0])\n    var bld_data=baseline_substraction(nat_data, dtp['sub_mode'][0], dtp['sub_value'][0])\n    var smo_data=smoothing(bld_data, dtp['gau_sigma'][0],dtp['gau_rep'][0])\n    var final_data=normalising_and_thresholding(smo_data,0.0) // Renormailising\n    indexkrieg(final_data, sele, ser_data, names, peak_mz)\n    return final_data\n}\n\n\n\n\n\n\n\n\n/// Data Processing similar to UniDEC\n\n// 1. Load data\nvar data = raw_mz.data;\nvar sele = {};\nvar ser_data={};\n\nvar names = series_names;\n\n/// remember i in x gives ith element\nfor(i_ser in names){\n    sele[names[i_ser]]=series_sele[names[i_ser]].data;\n    ser_data[names[i_ser]]=series_data[names[i_ser]].data;\n}\n// 2. Process data\nproc_mz.data=data\nindexkrieg(data, sele, ser_data, names, peak_mz)\n// 3. Put data into sources\ndata2sources(names, sele, proc_mz.data, series_mz);\n\n// 4. Tell console you are done\nprocess_data.button_type='success'\nprocess_data.label='Process Data'\nconsole.log('Done')"},"id":"1568","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1685","type":"Selection"},"selection_policy":{"id":"1686","type":"UnionRenderers"}},"id":"1086","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1157","type":"AjaxDataSource"}},"id":"1268","type":"CDSView"},{"attributes":{"data_source":{"id":"1157","type":"AjaxDataSource"},"glyph":{"id":"1245","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1270","type":"CDSView"}},"id":"1269","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1687","type":"Selection"},"selection_policy":{"id":"1688","type":"UnionRenderers"}},"id":"1087","type":"AjaxDataSource"},{"attributes":{"children":[{"id":"1558","type":"Div"},{"id":"1559","type":"Div"},{"id":"1560","type":"Div"},{"id":"1561","type":"Div"},{"id":"1562","type":"Select"},{"id":"1569","type":"Button"}]},"id":"1570","type":"Column"},{"attributes":{"source":{"id":"1157","type":"AjaxDataSource"}},"id":"1270","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1789","type":"Selection"},"selection_policy":{"id":"1790","type":"UnionRenderers"}},"id":"1088","type":"AjaxDataSource"},{"attributes":{"children":[{"id":"1553","type":"RangeSlider"},{"id":"1554","type":"Slider"},{"id":"1555","type":"Slider"},{"id":"1556","type":"Slider"},{"id":"1557","type":"Slider"},{"id":"1567","type":"Button"}]},"id":"1571","type":"Column"},{"attributes":{"data_source":{"id":"1246","type":"AjaxDataSource"},"glyph":{"id":"1250","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1472","type":"CDSView"},"visible":false},"id":"1471","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1829","type":"Selection"},"selection_policy":{"id":"1830","type":"UnionRenderers"}},"id":"1089","type":"AjaxDataSource"},{"attributes":{"height":30,"text":" Show Grid","width":150},"id":"1572","type":"Div"},{"attributes":{"data_source":{"id":"1074","type":"AjaxDataSource"},"glyph":{"id":"1160","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1272","type":"CDSView"}},"id":"1271","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1689","type":"Selection"},"selection_policy":{"id":"1690","type":"UnionRenderers"}},"id":"1090","type":"AjaxDataSource"},{"attributes":{"active":true,"callback":{"id":"1565","type":"CustomJS"},"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1574","type":"CustomJS"},{"id":"1575","type":"CustomJS"},{"id":"1576","type":"CustomJS"},{"id":"1577","type":"CustomJS"},{"id":"1578","type":"CustomJS"},{"id":"1579","type":"CustomJS"}]},"label":"on","width":100},"id":"1573","type":"Toggle"},{"attributes":{"source":{"id":"1074","type":"AjaxDataSource"}},"id":"1272","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1691","type":"Selection"},"selection_policy":{"id":"1692","type":"UnionRenderers"}},"id":"1091","type":"AjaxDataSource"},{"attributes":{"args":{"other":{"id":"1001","subtype":"Figure","type":"Plot"}},"code":"other.outline_line_alpha = this.active"},"id":"1578","type":"CustomJS"},{"attributes":{"data_source":{"id":"1074","type":"AjaxDataSource"},"glyph":{"id":"1161","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1274","type":"CDSView"}},"id":"1273","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1014","type":"Grid"}},"code":"other.visible = this.active"},"id":"1574","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1791","type":"Selection"},"selection_policy":{"id":"1792","type":"UnionRenderers"}},"id":"1092","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1074","type":"AjaxDataSource"}},"id":"1274","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1019","type":"Grid"}},"code":"other.visible = this.active"},"id":"1575","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1831","type":"Selection"},"selection_policy":{"id":"1832","type":"UnionRenderers"}},"id":"1093","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1075","type":"AjaxDataSource"},"glyph":{"id":"1162","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1276","type":"CDSView"},"visible":false},"id":"1275","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1062","type":"Grid"}},"code":"other.visible = this.active"},"id":"1576","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1693","type":"Selection"},"selection_policy":{"id":"1694","type":"UnionRenderers"}},"id":"1094","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1075","type":"AjaxDataSource"}},"id":"1276","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1067","type":"Grid"}},"code":"other.visible = this.active"},"id":"1577","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1695","type":"Selection"},"selection_policy":{"id":"1696","type":"UnionRenderers"}},"id":"1095","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1075","type":"AjaxDataSource"},"glyph":{"id":"1163","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1278","type":"CDSView"},"visible":false},"id":"1277","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1793","type":"Selection"},"selection_policy":{"id":"1794","type":"UnionRenderers"}},"id":"1096","type":"AjaxDataSource"},{"attributes":{"args":{"other":{"id":"1051","subtype":"Figure","type":"Plot"}},"code":"other.outline_line_alpha = this.active"},"id":"1579","type":"CustomJS"},{"attributes":{"source":{"id":"1075","type":"AjaxDataSource"}},"id":"1278","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1833","type":"Selection"},"selection_policy":{"id":"1834","type":"UnionRenderers"}},"id":"1097","type":"AjaxDataSource"},{"attributes":{"height":30,"text":" Show labels","width":150},"id":"1580","type":"Div"},{"attributes":{"args":{"other":{"id":"1275","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1279","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1697","type":"Selection"},"selection_policy":{"id":"1698","type":"UnionRenderers"}},"id":"1098","type":"AjaxDataSource"},{"attributes":{"active":true,"callback":{"id":"1565","type":"CustomJS"},"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1586","type":"CustomJS"},{"id":"1587","type":"CustomJS"},{"id":"1590","type":"CustomJS"},{"id":"1591","type":"CustomJS"},{"id":"1594","type":"CustomJS"},{"id":"1595","type":"CustomJS"},{"id":"1598","type":"CustomJS"},{"id":"1599","type":"CustomJS"}]},"label":"on","width":100},"id":"1581","type":"Toggle"},{"attributes":{"args":{"other":{"id":"1277","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1280","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1699","type":"Selection"},"selection_policy":{"id":"1700","type":"UnionRenderers"}},"id":"1099","type":"AjaxDataSource"},{"attributes":{"height":30,"text":" Show Ticks","width":150},"id":"1582","type":"Div"},{"attributes":{"data_source":{"id":"1078","type":"AjaxDataSource"},"glyph":{"id":"1164","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1282","type":"CDSView"}},"id":"1281","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1795","type":"Selection"},"selection_policy":{"id":"1796","type":"UnionRenderers"}},"id":"1100","type":"AjaxDataSource"},{"attributes":{"active":true,"callback":{"id":"1565","type":"CustomJS"},"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1588","type":"CustomJS"},{"id":"1589","type":"CustomJS"},{"id":"1592","type":"CustomJS"},{"id":"1593","type":"CustomJS"},{"id":"1596","type":"CustomJS"},{"id":"1597","type":"CustomJS"},{"id":"1600","type":"CustomJS"},{"id":"1601","type":"CustomJS"}]},"label":"on","width":100},"id":"1583","type":"Toggle"},{"attributes":{"source":{"id":"1078","type":"AjaxDataSource"}},"id":"1282","type":"CDSView"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1835","type":"Selection"},"selection_policy":{"id":"1836","type":"UnionRenderers"}},"id":"1101","type":"AjaxDataSource"},{"attributes":{"height":30,"text":" Show Axes","width":150},"id":"1584","type":"Div"},{"attributes":{"data_source":{"id":"1078","type":"AjaxDataSource"},"glyph":{"id":"1165","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1284","type":"CDSView"}},"id":"1283","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1701","type":"Selection"},"selection_policy":{"id":"1702","type":"UnionRenderers"}},"id":"1102","type":"AjaxDataSource"},{"attributes":{"active":true,"callback":{"id":"1565","type":"CustomJS"},"height":30,"icon":null,"js_property_callbacks":{"change:active":[{"id":"1602","type":"CustomJS"},{"id":"1603","type":"CustomJS"},{"id":"1604","type":"CustomJS"},{"id":"1605","type":"CustomJS"}]},"label":"on","width":100},"id":"1585","type":"Toggle"},{"attributes":{"source":{"id":"1078","type":"AjaxDataSource"}},"id":"1284","type":"CDSView"},{"attributes":{"callback":null},"id":"1030","type":"DataRange1d"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1703","type":"Selection"},"selection_policy":{"id":"1704","type":"UnionRenderers"}},"id":"1103","type":"AjaxDataSource"},{"attributes":{"height":30,"text":" Save 4k figure (PNG): ","width":150},"id":"1606","type":"Div"},{"attributes":{"data_source":{"id":"1079","type":"AjaxDataSource"},"glyph":{"id":"1166","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1286","type":"CDSView"},"visible":false},"id":"1285","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1010","type":"LinearAxis"}},"code":"other.axis_label_text_alpha = this.active"},"id":"1586","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1797","type":"Selection"},"selection_policy":{"id":"1798","type":"UnionRenderers"}},"id":"1104","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1079","type":"AjaxDataSource"}},"id":"1286","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1010","type":"LinearAxis"}},"code":"other.major_label_text_alpha = this.active"},"id":"1587","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1837","type":"Selection"},"selection_policy":{"id":"1838","type":"UnionRenderers"}},"id":"1105","type":"AjaxDataSource"},{"attributes":{"args":{"other":{"id":"1010","type":"LinearAxis"}},"code":"other.major_tick_line_alpha = this.active"},"id":"1588","type":"CustomJS"},{"attributes":{"data_source":{"id":"1079","type":"AjaxDataSource"},"glyph":{"id":"1167","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1288","type":"CDSView"},"visible":false},"id":"1287","type":"GlyphRenderer"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1705","type":"Selection"},"selection_policy":{"id":"1706","type":"UnionRenderers"}},"id":"1106","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1079","type":"AjaxDataSource"}},"id":"1288","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1010","type":"LinearAxis"}},"code":"other.minor_tick_line_alpha = this.active"},"id":"1589","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1707","type":"Selection"},"selection_policy":{"id":"1708","type":"UnionRenderers"}},"id":"1107","type":"AjaxDataSource"},{"attributes":{"args":{"other":{"id":"1015","type":"LinearAxis"}},"code":"other.axis_label_text_alpha = this.active"},"id":"1590","type":"CustomJS"},{"attributes":{"args":{"other":{"id":"1285","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1289","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1799","type":"Selection"},"selection_policy":{"id":"1800","type":"UnionRenderers"}},"id":"1108","type":"AjaxDataSource"},{"attributes":{"args":{"other":{"id":"1287","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1290","type":"CustomJS"},{"attributes":{"args":{"other":{"id":"1015","type":"LinearAxis"}},"code":"other.major_label_text_alpha = this.active"},"id":"1591","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"i_low":[],"i_max":[],"i_upp":[]},"selected":{"id":"1839","type":"Selection"},"selection_policy":{"id":"1840","type":"UnionRenderers"}},"id":"1109","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1082","type":"AjaxDataSource"},"glyph":{"id":"1168","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1292","type":"CDSView"}},"id":"1291","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1015","type":"LinearAxis"}},"code":"other.major_tick_line_alpha = this.active"},"id":"1592","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"Intensity":[],"mz":[]},"selected":{"id":"1709","type":"Selection"},"selection_policy":{"id":"1710","type":"UnionRenderers"}},"id":"1110","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1082","type":"AjaxDataSource"}},"id":"1292","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1015","type":"LinearAxis"}},"code":"other.minor_tick_line_alpha = this.active"},"id":"1593","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"xs":[],"ys":[]},"selected":{"id":"1711","type":"Selection"},"selection_policy":{"id":"1712","type":"UnionRenderers"}},"id":"1111","type":"AjaxDataSource"},{"attributes":{"data_source":{"id":"1082","type":"AjaxDataSource"},"glyph":{"id":"1169","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1294","type":"CDSView"}},"id":"1293","type":"GlyphRenderer"},{"attributes":{"args":{"other":{"id":"1058","type":"LinearAxis"}},"code":"other.axis_label_text_alpha = this.active"},"id":"1594","type":"CustomJS"},{"attributes":{"adapter":null,"callback":null,"data":{"charge":[],"max_int":[],"x_low":[],"x_max":[],"x_upp":[]},"selected":{"id":"1801","type":"Selection"},"selection_policy":{"id":"1802","type":"UnionRenderers"}},"id":"1112","type":"AjaxDataSource"},{"attributes":{"source":{"id":"1082","type":"AjaxDataSource"}},"id":"1294","type":"CDSView"},{"attributes":{"args":{"other":{"id":"1058","type":"LinearAxis"}},"code":"other.major_label_text_alpha = this.active"},"id":"1595","type":"CustomJS"},{"attributes":{},"id":"1703","type":"Selection"},{"attributes":{"columns":[{"id":"1512","type":"TableColumn"},{"id":"1514","type":"TableColumn"},{"id":"1517","type":"TableColumn"},{"id":"1520","type":"TableColumn"},{"id":"1523","type":"TableColumn"}],"height":280,"index_header":"Index","name":"Complex table","source":{"id":"1511","type":"AjaxDataSource"},"view":{"id":"1526","type":"CDSView"},"width":651},"id":"1525","type":"DataTable"},{"attributes":{},"id":"1665","type":"BasicTickFormatter"},{"attributes":{"data_source":{"id":"1083","type":"AjaxDataSource"},"glyph":{"id":"1170","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1296","type":"CDSView"},"visible":false},"id":"1295","type":"GlyphRenderer"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#e377c2"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1186","type":"MultiLine"},{"attributes":{"source":{"id":"1511","type":"AjaxDataSource"}},"id":"1526","type":"CDSView"},{"attributes":{},"id":"1778","type":"UnionRenderers"},{"attributes":{},"id":"1667","type":"BasicTickFormatter"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#e377c2"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1187","type":"MultiLine"},{"attributes":{"source":{"id":"1083","type":"AjaxDataSource"}},"id":"1296","type":"CDSView"},{"attributes":{"callback":null,"title":"Name ","value":"Subunit 1","width":75},"id":"1527","type":"TextInput"},{"attributes":{},"id":"1779","type":"Selection"},{"attributes":{"data_source":{"id":"1083","type":"AjaxDataSource"},"glyph":{"id":"1171","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1298","type":"CDSView"},"visible":false},"id":"1297","type":"GlyphRenderer"},{"attributes":{"text":""},"id":"1670","type":"Title"},{"attributes":{"line_color":{"value":"#7f7f7f"},"name":"Series 8","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1188","type":"MultiLine"},{"attributes":{},"id":"1780","type":"UnionRenderers"},{"attributes":{"source":{"id":"1083","type":"AjaxDataSource"}},"id":"1298","type":"CDSView"},{"attributes":{"line_color":{"value":"#7f7f7f"},"line_width":{"value":4},"name":"Series 8","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1189","type":"MultiLine"},{"attributes":{"callback":null,"title":"Mass ","value":"1000.0","width":75},"id":"1528","type":"TextInput"},{"attributes":{},"id":"1671","type":"Selection"},{"attributes":{},"id":"1781","type":"Selection"},{"attributes":{},"id":"1672","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1295","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1299","type":"CustomJS"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#7f7f7f"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1190","type":"MultiLine"},{"attributes":{"callback":null,"title":"Min:","value":"0","width":75},"id":"1529","type":"TextInput"},{"attributes":{},"id":"1782","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#7f7f7f"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1191","type":"MultiLine"},{"attributes":{"args":{"other":{"id":"1297","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1300","type":"CustomJS"},{"attributes":{},"id":"1673","type":"Selection"},{"attributes":{},"id":"1783","type":"Selection"},{"attributes":{"data_source":{"id":"1086","type":"AjaxDataSource"},"glyph":{"id":"1172","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1302","type":"CDSView"}},"id":"1301","type":"GlyphRenderer"},{"attributes":{"callback":null,"title":"Max:","value":"1","width":75},"id":"1530","type":"TextInput"},{"attributes":{},"id":"1674","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#bcbd22"},"name":"Series 9","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1192","type":"MultiLine"},{"attributes":{},"id":"1784","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#bcbd22"},"line_width":{"value":4},"name":"Series 9","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1193","type":"MultiLine"},{"attributes":{},"id":"1675","type":"Selection"},{"attributes":{"source":{"id":"1086","type":"AjaxDataSource"}},"id":"1302","type":"CDSView"},{"attributes":{"callback":null,"title":"Stride:","value":"1","width":75},"id":"1531","type":"TextInput"},{"attributes":{},"id":"1785","type":"Selection"},{"attributes":{"data_source":{"id":"1086","type":"AjaxDataSource"},"glyph":{"id":"1173","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1304","type":"CDSView"}},"id":"1303","type":"GlyphRenderer"},{"attributes":{},"id":"1676","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#bcbd22"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1194","type":"MultiLine"},{"attributes":{},"id":"1786","type":"UnionRenderers"},{"attributes":{},"id":"1677","type":"Selection"},{"attributes":{"source":{"id":"1086","type":"AjaxDataSource"}},"id":"1304","type":"CDSView"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#bcbd22"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1195","type":"MultiLine"},{"attributes":{},"id":"1787","type":"Selection"},{"attributes":{"args":{"SU_act":{"id":"1511","type":"AjaxDataSource"},"SU_mass":{"id":"1528","type":"TextInput"},"SU_max":{"id":"1530","type":"TextInput"},"SU_min":{"id":"1529","type":"TextInput"},"SU_name":{"id":"1527","type":"TextInput"},"SU_stride":{"id":"1531","type":"TextInput"}},"code":"complexes=SU_act.data\n\ncomplexes['name'].push(SU_name.value)\ncomplexes['mass'].push(SU_mass.value)\ncomplexes['min'].push(SU_min.value)\ncomplexes['max'].push(SU_max.value)\ncomplexes['stride'].push(SU_stride.value)\n\nSU_act.change.emit()"},"id":"1532","type":"CustomJS"},{"attributes":{"data_source":{"id":"1087","type":"AjaxDataSource"},"glyph":{"id":"1174","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1306","type":"CDSView"},"visible":false},"id":"1305","type":"GlyphRenderer"},{"attributes":{},"id":"1678","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#17becf"},"name":"Series 10","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1196","type":"MultiLine"},{"attributes":{},"id":"1788","type":"UnionRenderers"},{"attributes":{"button_type":"success","callback":null,"height":30,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1532","type":"CustomJS"}]},"label":"Add subunit","width":108},"id":"1534","type":"Button"},{"attributes":{"args":{"SU_act":{"id":"1511","type":"AjaxDataSource"}},"code":"inds=[]\nfor(i in SU_act.selected.indices){\n\tinds.push(SU_act.selected.indices[i])\n}\ncomplexes=SU_act.data\n// if(inds.length==0){\n// \tinds.push(complexes['name'].length-1)\n// }\nfor (var i = inds.length - 1; i &gt;= 0; i--) {\n\tcomplexes['name'].splice(inds[i],1);\n\tcomplexes['mass'].splice(inds[i],1);\n\tcomplexes['min'].splice(inds[i],1);\n\tcomplexes['max'].splice(inds[i],1);\n\tcomplexes['stride'].splice(inds[i],1);\n}\nSU_act.change.emit()"},"id":"1533","type":"CustomJS"},{"attributes":{"line_color":{"value":"#17becf"},"line_width":{"value":4},"name":"Series 10","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1197","type":"MultiLine"},{"attributes":{},"id":"1679","type":"Selection"},{"attributes":{"source":{"id":"1087","type":"AjaxDataSource"}},"id":"1306","type":"CDSView"},{"attributes":{},"id":"1789","type":"Selection"},{"attributes":{"button_type":"danger","callback":null,"height":30,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1533","type":"CustomJS"}]},"label":"Del. subunit","width":108},"id":"1535","type":"Button"},{"attributes":{},"id":"1680","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1087","type":"AjaxDataSource"},"glyph":{"id":"1175","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1308","type":"CDSView"},"visible":false},"id":"1307","type":"GlyphRenderer"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#17becf"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1198","type":"MultiLine"},{"attributes":{"height":20},"id":"1536","type":"Spacer"},{"attributes":{},"id":"1790","type":"UnionRenderers"},{"attributes":{"source":{"id":"1087","type":"AjaxDataSource"}},"id":"1308","type":"CDSView"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#17becf"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1199","type":"MultiLine"},{"attributes":{},"id":"1681","type":"Selection"},{"attributes":{"callback":null,"height":280,"value":"Add comments on spectrum...","width":363},"id":"1537","type":"TextAreaInput"},{"attributes":{},"id":"1791","type":"Selection"},{"attributes":{},"id":"1682","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1305","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1309","type":"CustomJS"},{"attributes":{"line_color":{"value":"#aec7e8"},"name":"Series 11","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1200","type":"MultiLine"},{"attributes":{"adapter":null,"callback":null,"data":{"mass":[],"mass_diff":[],"stoichiometry":[]},"selected":{"id":"1771","type":"Selection"},"selection_policy":{"id":"1772","type":"UnionRenderers"}},"id":"1538","type":"AjaxDataSource"},{"attributes":{},"id":"1792","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#aec7e8"},"line_width":{"value":4},"name":"Series 11","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1201","type":"MultiLine"},{"attributes":{"args":{"other":{"id":"1307","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1310","type":"CustomJS"},{"attributes":{},"id":"1683","type":"Selection"},{"attributes":{},"id":"1793","type":"Selection"},{"attributes":{"data_source":{"id":"1090","type":"AjaxDataSource"},"glyph":{"id":"1176","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1312","type":"CDSView"}},"id":"1311","type":"GlyphRenderer"},{"attributes":{},"id":"1684","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#aec7e8"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1202","type":"MultiLine"},{"attributes":{},"id":"1794","type":"UnionRenderers"},{"attributes":{"callback":null,"value":"1000.0","width":80},"id":"1539","type":"TextInput"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#aec7e8"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1203","type":"MultiLine"},{"attributes":{},"id":"1685","type":"Selection"},{"attributes":{"source":{"id":"1090","type":"AjaxDataSource"}},"id":"1312","type":"CDSView"},{"attributes":{"editor":{"id":"1880","type":"StringEditor"},"field":"stoichiometry","formatter":{"id":"1879","type":"StringFormatter"},"title":"Stoichiometry"},"id":"1540","type":"TableColumn"},{"attributes":{},"id":"1795","type":"Selection"},{"attributes":{"data_source":{"id":"1090","type":"AjaxDataSource"},"glyph":{"id":"1177","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1314","type":"CDSView"}},"id":"1313","type":"GlyphRenderer"},{"attributes":{},"id":"1686","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#ffbb78"},"name":"Series 12","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1204","type":"MultiLine"},{"attributes":{},"id":"1796","type":"UnionRenderers"},{"attributes":{"format":"0,0.00"},"id":"1541","type":"NumberFormatter"},{"attributes":{"source":{"id":"1090","type":"AjaxDataSource"}},"id":"1314","type":"CDSView"},{"attributes":{"line_color":{"value":"#ffbb78"},"line_width":{"value":4},"name":"Series 12","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1205","type":"MultiLine"},{"attributes":{},"id":"1687","type":"Selection"},{"attributes":{"editor":{"id":"1881","type":"StringEditor"},"field":"mass","formatter":{"id":"1541","type":"NumberFormatter"},"title":"Mass of Combination"},"id":"1542","type":"TableColumn"},{"attributes":{},"id":"1797","type":"Selection"},{"attributes":{"data_source":{"id":"1091","type":"AjaxDataSource"},"glyph":{"id":"1178","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1316","type":"CDSView"},"visible":false},"id":"1315","type":"GlyphRenderer"},{"attributes":{},"id":"1688","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#ffbb78"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1206","type":"MultiLine"},{"attributes":{},"id":"1798","type":"UnionRenderers"},{"attributes":{"format":"0,0.00"},"id":"1544","type":"NumberFormatter"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#ffbb78"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1207","type":"MultiLine"},{"attributes":{},"id":"1689","type":"Selection"},{"attributes":{"source":{"id":"1091","type":"AjaxDataSource"}},"id":"1316","type":"CDSView"},{"attributes":{"editor":{"id":"1882","type":"StringEditor"},"field":"mass_diff","formatter":{"id":"1544","type":"NumberFormatter"},"title":"Difference to Measured Mass"},"id":"1545","type":"TableColumn"},{"attributes":{},"id":"1799","type":"Selection"},{"attributes":{"data_source":{"id":"1091","type":"AjaxDataSource"},"glyph":{"id":"1179","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1318","type":"CDSView"},"visible":false},"id":"1317","type":"GlyphRenderer"},{"attributes":{},"id":"1690","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#98df8a"},"name":"Series 13","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1208","type":"MultiLine"},{"attributes":{},"id":"1800","type":"UnionRenderers"},{"attributes":{"source":{"id":"1091","type":"AjaxDataSource"}},"id":"1318","type":"CDSView"},{"attributes":{"line_color":{"value":"#98df8a"},"line_width":{"value":4},"name":"Series 13","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1209","type":"MultiLine"},{"attributes":{},"id":"1691","type":"Selection"},{"attributes":{},"id":"1801","type":"Selection"},{"attributes":{"callback":{"id":"1547","type":"CustomJS"},"height":30,"icon":null,"label":"Load/Save Tables","menu":[["Save Peaks Table","save_peaks"],["Save Masses Table","save_masses"],null,["Load SU table","load_SU"],["Save SU table","save_SU"],null,["Save Matching","save_mm"]],"width":180},"id":"1548","type":"Dropdown"},{"attributes":{"args":{"SU_act":{"id":"1511","type":"AjaxDataSource"},"aser_data":{"id":"1153","type":"AjaxDataSource"},"series_masses":{"id":"1152","type":"AjaxDataSource"},"stoich":{"id":"1538","type":"AjaxDataSource"}},"code":"function table_to_csv(source){\n    const columns = ['name', 'mass', 'min', 'max', 'stride']\n    const nrows = source.get_length()\n    const lines = ['Name,Mass,Minimum #,Maximum #,stride']\n\n    for (let i = 0; i &lt; nrows; i++) {\n        let row = [];\n        for (let j = 0; j &lt; columns.length; j++) {\n            const column = columns[j]\n            row.push(source.data[column][i].toString())\n        }\n        lines.push(row.join(','))\n    }\n    return lines.join('\\n').concat('\\n')\n}\n\nfunction peak_table_to_csv(source){\n    const columns = ['x_low', 'x_upp', 'x_max','max_int', 'charge']\n    const nrows = source.get_length()\n    const lines = ['Lower m/z ,Upper m/z,mz of Max,Intensity of Maximum,Charge']\n\n    for (let i = 0; i &lt; nrows; i++) {\n        let row = [];\n        for (let j = 0; j &lt; columns.length; j++) {\n            const column = columns[j]\n            row.push(source.data[column][i].toString())\n        }\n        lines.push(row.join(','))\n    }\n    return lines.join('\\n').concat('\\n')\n}\n\nfunction masses_table_to_csv(source){\n    const columns = ['Series', 'Mass', 'Uncertainty']\n    const nrows = source.get_length()\n    const lines = ['Series,Mass,Uncertainty']\n\n    for (let i = 0; i &lt; nrows; i++) {\n        let row = [];\n        for (let j = 0; j &lt; columns.length; j++) {\n            const column = columns[j]\n            row.push(source.data[column][i].toString())\n        }\n        lines.push(row.join(','))\n    }\n    return lines.join('\\n').concat('\\n')\n}\n\nfunction table_to_csv2(source, source2){\n    const columns = ['name', 'mass', 'min', 'max', 'stride']\n    const nrows = source.get_length()\n    const lines = ['Name,Mass,Minimum #,Maximum #,stride']\n\n    const columns2 = ['stoichiometry', 'mass', 'mass_diff']\n    const nrows2 = source.get_length()\n\n    for (let i = 0; i &lt; nrows; i++) {\n        let row = [];\n        for (let j = 0; j &lt; columns.length; j++) {\n            const column = columns[j]\n            row.push(source.data[column][i].toString())\n        }\n        lines.push(row.join(','))\n    }\n    lines.push('\\nStoichiometry,Mass of SU Combination,Different to Measured Mass')\n    for (let i = 0; i &lt; nrows2; i++) {\n        let row = [];\n        for (let j = 0; j &lt; columns2.length; j++) {\n            const column = columns2[j]\n            row.push(source2.data[column][i].toString())\n        }\n        lines.push(row.join(','))\n    }\n    return lines.join('\\n').concat('\\n')\n}\n\nconsole.log(cb_obj.value)\nvar act = cb_obj.value;\n\nif(act == \"load_SU\"){\n    var input = document.createElement('input');\n    input.type = 'file';\n    input.onchange = e =&gt; {\n        // getting a hold of the file reference\n        var file = e.target.files[0];\n\n        // setting up the reader\n        var reader = new FileReader();\n        reader.readAsText(file,'UTF-8');\n\n        // here we tell the reader what to do when it's done reading...\n        reader.onload = readerEvent =&gt; {\n            var content = readerEvent.target.result; // this is the content!\n            var lines = content.split('\\n')\n            for(i=1; i &lt; lines.length; i++){\n                line = lines[i].split(',')\n                if (line.length == 5){\n                    console.log(line[0])\n                    SU_act.data['name'].push(line[0])\n                    SU_act.data['mass'].push(parseFloat(line[1]))\n                    SU_act.data['min'].push(parseInt(line[2]))\n                    SU_act.data['max'].push(parseInt(line[3]))\n                    SU_act.data['stride'].push(parseInt(line[4]))\n                }\n            }\n        SU_act.change.emit()\n        }\n    }\n    input.click();\n}\n\nif(act == \"save_SU\"){\n   const filename = 'subunit_table.csv'\n    const filetext = table_to_csv(SU_act)\n\n    const blob = new Blob([filetext], { type: 'text/csv;charset=utf-8;' })\n\n    //addresses IE\n    if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(blob, filename)\n    } else {\n        const link = document.createElement('a')\n        link.href = URL.createObjectURL(blob)\n        link.download = filename\n        link.target = '_blank'\n        link.style.visibility = 'hidden'\n        link.dispatchEvent(new MouseEvent('click'))\n    } \n}\n\nif(act == \"save_peaks\"){\n   const filename = 'peak_table.csv'\n    const filetext = peak_table_to_csv(aser_data)\n\n    const blob = new Blob([filetext], { type: 'text/csv;charset=utf-8;' })\n\n    //addresses IE\n    if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(blob, filename)\n    } else {\n        const link = document.createElement('a')\n        link.href = URL.createObjectURL(blob)\n        link.download = filename\n        link.target = '_blank'\n        link.style.visibility = 'hidden'\n        link.dispatchEvent(new MouseEvent('click'))\n    } \n}\n\nif(act == \"save_masses\"){\n   const filename = 'masses_table.csv'\n    const filetext = masses_table_to_csv(series_masses)\n\n    const blob = new Blob([filetext], { type: 'text/csv;charset=utf-8;' })\n\n    //addresses IE\n    if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(blob, filename)\n    } else {\n        const link = document.createElement('a')\n        link.href = URL.createObjectURL(blob)\n        link.download = filename\n        link.target = '_blank'\n        link.style.visibility = 'hidden'\n        link.dispatchEvent(new MouseEvent('click'))\n    } \n}\n\nif(act == \"save_mm\"){\n    const filename = 'mass_matching_results.csv'\n    const filetext = table_to_csv2(SU_act, stoich)\n    const blob = new Blob([filetext], { type: 'text/csv;charset=utf-8;' })\n\n    //addresses IE\n    if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(blob, filename)\n    } else {\n        const link = document.createElement('a')\n        link.href = URL.createObjectURL(blob)\n        link.download = filename\n        link.target = '_blank'\n        link.style.visibility = 'hidden'\n        link.dispatchEvent(new MouseEvent('click'))\n    }\n}\n\n"},"id":"1547","type":"CustomJS"},{"attributes":{"args":{"other":{"id":"1315","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1319","type":"CustomJS"},{"attributes":{},"id":"1692","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#98df8a"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1210","type":"MultiLine"},{"attributes":{"columns":[{"id":"1540","type":"TableColumn"},{"id":"1542","type":"TableColumn"},{"id":"1545","type":"TableColumn"}],"height":280,"index_position":null,"name":"Complex table","source":{"id":"1538","type":"AjaxDataSource"},"view":{"id":"1550","type":"CDSView"},"width":534},"id":"1549","type":"DataTable"},{"attributes":{},"id":"1802","type":"UnionRenderers"},{"attributes":{"below":[{"id":"1038","type":"LinearAxis"}],"center":[{"id":"1042","type":"Grid"},{"id":"1047","type":"Grid"}],"left":[{"id":"1043","type":"LinearAxis"}],"plot_height":768,"plot_width":1366,"title":{"id":"1884","type":"Title"},"toolbar":{"id":"1049","type":"Toolbar"},"x_range":{"id":"1030","type":"DataRange1d"},"x_scale":{"id":"1034","type":"LinearScale"},"y_range":{"id":"1032","type":"DataRange1d"},"y_scale":{"id":"1036","type":"LinearScale"}},"id":"1029","subtype":"Figure","type":"Plot"},{"attributes":{"args":{"other":{"id":"1317","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1320","type":"CustomJS"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#98df8a"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1211","type":"MultiLine"},{"attributes":{},"id":"1693","type":"Selection"},{"attributes":{"source":{"id":"1538","type":"AjaxDataSource"}},"id":"1550","type":"CDSView"},{"attributes":{},"id":"1803","type":"Selection"},{"attributes":{"data_source":{"id":"1094","type":"AjaxDataSource"},"glyph":{"id":"1180","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1322","type":"CDSView"}},"id":"1321","type":"GlyphRenderer"},{"attributes":{},"id":"1694","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#ff9896"},"name":"Series 14","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1212","type":"MultiLine"},{"attributes":{},"id":"1804","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#ff9896"},"line_width":{"value":4},"name":"Series 14","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1213","type":"MultiLine"},{"attributes":{},"id":"1695","type":"Selection"},{"attributes":{"source":{"id":"1094","type":"AjaxDataSource"}},"id":"1322","type":"CDSView"},{"attributes":{},"id":"1805","type":"Selection"},{"attributes":{"button_type":"success","callback":null,"height":30,"icon":null,"js_event_callbacks":{"button_click":[{"id":"1551","type":"CustomJS"}]},"label":"Mass Matching","width":84},"id":"1552","type":"Button"},{"attributes":{"args":{"SU_act":{"id":"1511","type":"AjaxDataSource"},"diff_match":{"id":"1539","type":"TextInput"},"ser_match":{"id":"1255","type":"Select"},"series_masses":{"id":"1152","type":"AjaxDataSource"},"stoich":{"id":"1538","type":"AjaxDataSource"}},"code":"SUs = SU_act.data;\nvar masses = series_masses.data\nvar act = ser_match.value\nconst opt=ser_match.options\nif(opt.length &gt; 0){\n\tind = []\n\n\tn_comb = 1\n\n\ti_act=0\n\t/// Find correct series index for calculing peak prediction\n\tfor (i_ms=0; i_ms &lt; masses['Mass'].length; i_ms++){\n\t    if (masses['Series'][i_ms] == act){\n\t        i_act=i_ms\n\t    }\n\t}\n\n\tvar com_table= {'stoichiometry':[], 'mass':[], 'mass_diff':[]}\n\n\n\tfor (var i =  0; i &lt; SUs[\"min\"].length; i++) {\n\t\tn_comb *=  (Math.floor((SUs[\"max\"][i]-SUs[\"min\"][i])/SUs[\"stride\"][i]) + 1)\n\t\tind.push(Number(SUs[\"min\"][i]))\n\t}\n\tfor(i=0; i &lt; n_comb; i++){\n\t\tfor(j=0; j &lt; SUs[\"min\"].length; j++){\n\t\t\tif( (ind[j] + Number(SUs[\"stride\"][j])) &lt;= Number(SUs[\"max\"][j])){\n\t\t\t\tind[j] = ind[j] + Number(SUs[\"stride\"][j])\n\t\t\t\tcomb_mass=0.0\n\t\t\t\tfor(k=0; k &lt; SUs[\"min\"].length; k++){\n\t\t\t\t\tcomb_mass = comb_mass + SUs[\"mass\"][k]*ind[k]\n\t\t\t\t}\n\t\t\t\tdiff = comb_mass - masses['Mass'][i_act]\n\t\t\t\tif (diff*diff &lt; diff_match.value*diff_match.value){\n\t\t\t\t\tcom_table['mass'].push(comb_mass)\n\t\t\t\t\tcom_table['mass_diff'].push(diff)\n\t\t\t\t\tsotich_string=''\n\t\t\t\t\tfor(k=0; k &lt; SUs[\"min\"].length; k++){\n\t\t\t\t\t\tsotich_string= sotich_string + SUs[\"name\"][k] + ': ' + ind[k] + '   '\n\t\t\t\t\t} \n\t\t\t\t\tcom_table['stoichiometry'].push(sotich_string)\n\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tind[j] = Number(SUs[\"min\"][j])\n\t\t\t}\n\t\t}\n\t}\n\tstoich.data = com_table\n}\nelse{\n\twindow.alert(\"Please define peak series first.\")\n}"},"id":"1551","type":"CustomJS"},{"attributes":{"data_source":{"id":"1094","type":"AjaxDataSource"},"glyph":{"id":"1181","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1324","type":"CDSView"}},"id":"1323","type":"GlyphRenderer"},{"attributes":{},"id":"1696","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#ff9896"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1214","type":"MultiLine"},{"attributes":{"callback":null,"end":100000.0,"height":30,"js_property_callbacks":{"change:value":[{"id":"1564","type":"CustomJS"}]},"name":"cropping_slider","start":0.0,"step":100,"value":[0.0,100000.0],"width":150},"id":"1553","type":"RangeSlider"},{"attributes":{},"id":"1806","type":"UnionRenderers"},{"attributes":{"source":{"id":"1094","type":"AjaxDataSource"}},"id":"1324","type":"CDSView"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#ff9896"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1215","type":"MultiLine"},{"attributes":{},"id":"1697","type":"Selection"},{"attributes":{"callback":null,"end":50,"height":30,"js_property_callbacks":{"change:value":[{"id":"1564","type":"CustomJS"}]},"name":"gau_sigma","start":0,"value":0.0,"width":150},"id":"1554","type":"Slider"},{"attributes":{},"id":"1807","type":"Selection"},{"attributes":{"data_source":{"id":"1095","type":"AjaxDataSource"},"glyph":{"id":"1182","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1326","type":"CDSView"},"visible":false},"id":"1325","type":"GlyphRenderer"},{"attributes":{},"id":"1698","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#c5b0d5"},"name":"Series 15","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1216","type":"MultiLine"},{"attributes":{"callback":null,"end":10,"height":30,"js_property_callbacks":{"change:value":[{"id":"1564","type":"CustomJS"}]},"name":"gau_rep","start":0,"value":1,"width":150},"id":"1555","type":"Slider"},{"attributes":{},"id":"1808","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#c5b0d5"},"line_width":{"value":4},"name":"Series 15","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1217","type":"MultiLine"},{"attributes":{},"id":"1699","type":"Selection"},{"attributes":{"source":{"id":"1095","type":"AjaxDataSource"}},"id":"1326","type":"CDSView"},{"attributes":{"callback":null,"end":100,"height":30,"js_property_callbacks":{"change:value":[{"id":"1564","type":"CustomJS"}]},"name":"intensity_threshold","start":0,"step":0.1,"value":0.0,"width":150},"id":"1556","type":"Slider"},{"attributes":{},"id":"1809","type":"Selection"},{"attributes":{"data_source":{"id":"1095","type":"AjaxDataSource"},"glyph":{"id":"1183","type":"MultiLine"},"hover_glyph":null,"muted_glyph":null,"view":{"id":"1328","type":"CDSView"},"visible":false},"id":"1327","type":"GlyphRenderer"},{"attributes":{},"id":"1700","type":"UnionRenderers"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#c5b0d5"},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1218","type":"MultiLine"},{"attributes":{"callback":null,"end":100,"height":30,"js_property_callbacks":{"change:value":[{"id":"1564","type":"CustomJS"}]},"name":"sub_value","start":0,"value":0.0,"width":150},"id":"1557","type":"Slider"},{"attributes":{},"id":"1810","type":"UnionRenderers"},{"attributes":{"background_fill_color":{"value":null},"below":[{"id":"1010","type":"LinearAxis"}],"border_fill_color":{"value":null},"center":[{"id":"1014","type":"Grid"},{"id":"1019","type":"Grid"},{"id":"1071","type":"Legend"}],"left":[{"id":"1015","type":"LinearAxis"}],"plot_height":768,"plot_width":1366,"renderers":[{"id":"1267","type":"GlyphRenderer"},{"id":"1271","type":"GlyphRenderer"},{"id":"1275","type":"GlyphRenderer"},{"id":"1281","type":"GlyphRenderer"},{"id":"1285","type":"GlyphRenderer"},{"id":"1291","type":"GlyphRenderer"},{"id":"1295","type":"GlyphRenderer"},{"id":"1301","type":"GlyphRenderer"},{"id":"1305","type":"GlyphRenderer"},{"id":"1311","type":"GlyphRenderer"},{"id":"1315","type":"GlyphRenderer"},{"id":"1321","type":"GlyphRenderer"},{"id":"1325","type":"GlyphRenderer"},{"id":"1331","type":"GlyphRenderer"},{"id":"1335","type":"GlyphRenderer"},{"id":"1341","type":"GlyphRenderer"},{"id":"1345","type":"GlyphRenderer"},{"id":"1351","type":"GlyphRenderer"},{"id":"1355","type":"GlyphRenderer"},{"id":"1361","type":"GlyphRenderer"},{"id":"1365","type":"GlyphRenderer"},{"id":"1371","type":"GlyphRenderer"},{"id":"1375","type":"GlyphRenderer"},{"id":"1381","type":"GlyphRenderer"},{"id":"1385","type":"GlyphRenderer"},{"id":"1391","type":"GlyphRenderer"},{"id":"1395","type":"GlyphRenderer"},{"id":"1401","type":"GlyphRenderer"},{"id":"1405","type":"GlyphRenderer"},{"id":"1411","type":"GlyphRenderer"},{"id":"1415","type":"GlyphRenderer"},{"id":"1421","type":"GlyphRenderer"},{"id":"1425","type":"GlyphRenderer"},{"id":"1431","type":"GlyphRenderer"},{"id":"1435","type":"GlyphRenderer"},{"id":"1441","type":"GlyphRenderer"},{"id":"1445","type":"GlyphRenderer"},{"id":"1451","type":"GlyphRenderer"},{"id":"1455","type":"GlyphRenderer"},{"id":"1461","type":"GlyphRenderer"},{"id":"1465","type":"GlyphRenderer"},{"id":"1471","type":"GlyphRenderer"},{"id":"1473","type":"GlyphRenderer"},{"id":"1480","type":"GlyphRenderer"}],"title":{"id":"1670","type":"Title"},"toolbar":{"id":"1024","type":"Toolbar"},"x_range":{"id":"1002","type":"DataRange1d"},"x_scale":{"id":"1006","type":"LinearScale"},"y_range":{"id":"1004","type":"DataRange1d"},"y_scale":{"id":"1008","type":"LinearScale"}},"id":"1001","subtype":"Figure","type":"Plot"},{"attributes":{"source":{"id":"1095","type":"AjaxDataSource"}},"id":"1328","type":"CDSView"},{"attributes":{"line_alpha":{"value":0.5},"line_color":{"value":"#c5b0d5"},"line_width":{"value":4},"xs":{"field":"xs"},"ys":{"field":"ys"}},"id":"1219","type":"MultiLine"},{"attributes":{"line_color":{"value":"#c49c94"},"line_width":{"value":4},"name":"Series 16","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1221","type":"MultiLine"},{"attributes":{},"id":"1701","type":"Selection"},{"attributes":{},"id":"1811","type":"Selection"},{"attributes":{"height":30,"text":" Range mz:","width":150},"id":"1558","type":"Div"},{"attributes":{"args":{"other":{"id":"1325","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1329","type":"CustomJS"},{"attributes":{},"id":"1702","type":"UnionRenderers"},{"attributes":{"line_color":{"value":"#c49c94"},"name":"Series 16","xs":{"field":"mz"},"ys":{"field":"Intensity"}},"id":"1220","type":"MultiLine"},{"attributes":{},"id":"1812","type":"UnionRenderers"},{"attributes":{"args":{"other":{"id":"1327","type":"GlyphRenderer"}},"code":"other.visible = this.active"},"id":"1330","type":"CustomJS"}],"root_ids":["1662"]},"title":"Bokeh Application","version":"1.4.0"}}
        </script>
        <script type="text/javascript">
          (function() {
            var fn = function() {
              Bokeh.safely(function() {
                (function(root) {
                  function embed_document(root) {
                    
                  var docs_json = document.getElementById('3975').textContent;
                  var render_items = [{"docid":"d90f497b-6390-4ec2-8c83-9d8f3e44d109","roots":{"1662":"df3dcdf3-96ef-4686-8589-f3eed2984ddf"}}];
                  root.Bokeh.embed.embed_items(docs_json, render_items);
                
                  }
                  if (root.Bokeh !== undefined) {
                    embed_document(root);
                  } else {
                    var attempts = 0;
                    var timer = setInterval(function(root) {
                      if (root.Bokeh !== undefined) {
                        clearInterval(timer);
                        embed_document(root);
                      } else {
                        attempts++;
                        if (attempts > 100) {
                          clearInterval(timer);
                          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                        }
                      }
                    }, 10, root)
                  }
                })(window);
              });
            };
            if (document.readyState != "loading") fn();
            else document.addEventListener("DOMContentLoaded", fn);
          })();
        </script>
    
  </body>
  
</html>
